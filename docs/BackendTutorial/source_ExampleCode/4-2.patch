diff -Naur Chapter4_1/Cpu0InstrInfo.td Chapter4_2/Cpu0InstrInfo.td
--- Chapter4_1/Cpu0InstrInfo.td	2013-06-26 12:36:34.793595199 +0800
+++ Chapter4_2/Cpu0InstrInfo.td	2013-06-26 12:36:34.789595199 +0800
@@ -212,3 +212,14 @@
 
 def : Pat<(i32 immSExt16:$in),
           (ADDiu ZERO, imm:$in)>;
+
+def : Pat<(not CPURegs:$in),
+          (XOR CPURegs:$in, (ADDiu ZERO, 1))>;
+
+// setcc patterns
+multiclass SeteqPats<RegisterClass RC, Instruction XOROp> {
+  def : Pat<(seteq RC:$lhs, RC:$rhs),
+            (XOROp (XOROp RC:$lhs, RC:$rhs), (ADDiu ZERO, 1))>;
+}
+
+defm : SeteqPats<CPURegs, XOR>;
