

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Run backend &mdash; Tutorial: Creating an LLVM Backend for the Cpu0 Architecture</title>
    
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '3.3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/theme_extras.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="top" title="Tutorial: Creating an LLVM Backend for the Cpu0 Architecture" href="index.html" />
    <link rel="next" title="Backend Optimization" href="optimize.html" />
    <link rel="prev" title="ELF Support" href="elf.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="index.html">
          <span>Tutorial: Creating an LLVM Backend for the Cpu0 Architecture</span></a></h1>
        <h2 class="heading"><span>Run backend</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="elf.html">ELF Support</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="optimize.html">Backend Optimization</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="run-backend">
<span id="sec-runbackend"></span><h1>Run backend<a class="headerlink" href="#run-backend" title="Permalink to this headline">¶</a></h1>
<p>This chapter will add LLVM AsmParser support first.
With AsmParser support, we can hand code the assembly language in C/C++ file
and translate it into obj (elf format).
We can write a C++ main
function as well as the boot code by assembly hand code, and translate this
main()+bootcode() into obj file.
Combined with llvm-objdump support in last chapter,
this main()+bootcode() elf can be translated into hex file format which
include the disassemble code as comment.
Furthermore, we can design the Cpu0 with Verilog language tool and run the Cpu0
backend on PC by feed the hex file and see the Cpu0 instructions execution
result.</p>
<div class="section" id="asmparser-support">
<h2>AsmParser support<a class="headerlink" href="#asmparser-support" title="Permalink to this headline">¶</a></h2>
<p>Run Chapter9_1/ with ch10_1.cpp will get the following error message.</p>
<p class="rubric">LLVMBackendTutorialExampleCode/InputFiles/ch10_1.cpp</p>
<div class="highlight-c++"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">asm</span><span class="p">(</span><span class="s">&quot;ld	$2, 8($sp)&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;st	$0, 4($sp)&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;addiu $3,	$ZERO, 0&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;add $3, $1, $2&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;sub $3, $2, $3&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;mul $2, $1, $3&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;div $3, $2&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;divu $2, $3&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;and $2, $1, $3&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;or $3, $1, $2&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;xor $1, $2, $3&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;mult $4, $3&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;multu $3, $2&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;mfhi $3&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;mflo $2&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;mthi $2&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;mtlo $2&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;sra $2, $2, 2&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;rol $2, $1, 3&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;ror $3, $3, 4&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;shl $2, $2, 2&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;shr $2, $3, 5&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;cmp $sw, $2, $3&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;jeq $sw, 20&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;jne $sw, 16&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;jlt $sw, -20&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;jle $sw, -16&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;jgt $sw, -4&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;jge $sw, -12&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;swi 0x00000400&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;jsub 0x000010000&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;ret $lr&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;jalr $t9&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;li $3, 0x00700000&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;la $3, 0x00800000($6)&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;la $3, 0x00900000&quot;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-bash"><pre>JonathantekiiMac:InputFiles Jonathan$ clang -c ch10_1.cpp -emit-llvm -o
ch10_1.bc
JonathantekiiMac:InputFiles Jonathan$ /Users/Jonathan/llvm/test/cmake_debug_
build/bin/Debug/llc -march=cpu0 -relocation-model=pic -filetype=obj ch10_1.bc
-o ch10_1.cpu0.o
LLVM ERROR: Inline asm not supported by this streamer because we don't have
an asm parser for this target</pre>
</div>
<p>Since we didn&#8217;t implement cpu0 assembly, it has the error message as above.
The cpu0 can translate LLVM IR into assembly and obj directly, but it cannot
translate hand code assembly into obj.
Directory AsmParser handle the assembly to obj translation.
The Chapter10_1/ include AsmParser implementation as follows,</p>
<p class="rubric">LLVMBackendTutorialExampleCode/Chapter10_1/AsmParser/Cpu0AsmParser.cpp</p>
<div class="highlight-c++"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>   1
   2
   3
   4
   5
   6
   7
   8
   9
  10
  11
  12
  13
  14
  15
  16
  17
  18
  19
  20
  21
  22
  23
  24
  25
  26
  27
  28
  29
  30
  31
  32
  33
  34
  35
  36
  37
  38
  39
  40
  41
  42
  43
  44
  45
  46
  47
  48
  49
  50
  51
  52
  53
  54
  55
  56
  57
  58
  59
  60
  61
  62
  63
  64
  65
  66
  67
  68
  69
  70
  71
  72
  73
  74
  75
  76
  77
  78
  79
  80
  81
  82
  83
  84
  85
  86
  87
  88
  89
  90
  91
  92
  93
  94
  95
  96
  97
  98
  99
 100
 101
 102
 103
 104
 105
 106
 107
 108
 109
 110
 111
 112
 113
 114
 115
 116
 117
 118
 119
 120
 121
 122
 123
 124
 125
 126
 127
 128
 129
 130
 131
 132
 133
 134
 135
 136
 137
 138
 139
 140
 141
 142
 143
 144
 145
 146
 147
 148
 149
 150
 151
 152
 153
 154
 155
 156
 157
 158
 159
 160
 161
 162
 163
 164
 165
 166
 167
 168
 169
 170
 171
 172
 173
 174
 175
 176
 177
 178
 179
 180
 181
 182
 183
 184
 185
 186
 187
 188
 189
 190
 191
 192
 193
 194
 195
 196
 197
 198
 199
 200
 201
 202
 203
 204
 205
 206
 207
 208
 209
 210
 211
 212
 213
 214
 215
 216
 217
 218
 219
 220
 221
 222
 223
 224
 225
 226
 227
 228
 229
 230
 231
 232
 233
 234
 235
 236
 237
 238
 239
 240
 241
 242
 243
 244
 245
 246
 247
 248
 249
 250
 251
 252
 253
 254
 255
 256
 257
 258
 259
 260
 261
 262
 263
 264
 265
 266
 267
 268
 269
 270
 271
 272
 273
 274
 275
 276
 277
 278
 279
 280
 281
 282
 283
 284
 285
 286
 287
 288
 289
 290
 291
 292
 293
 294
 295
 296
 297
 298
 299
 300
 301
 302
 303
 304
 305
 306
 307
 308
 309
 310
 311
 312
 313
 314
 315
 316
 317
 318
 319
 320
 321
 322
 323
 324
 325
 326
 327
 328
 329
 330
 331
 332
 333
 334
 335
 336
 337
 338
 339
 340
 341
 342
 343
 344
 345
 346
 347
 348
 349
 350
 351
 352
 353
 354
 355
 356
 357
 358
 359
 360
 361
 362
 363
 364
 365
 366
 367
 368
 369
 370
 371
 372
 373
 374
 375
 376
 377
 378
 379
 380
 381
 382
 383
 384
 385
 386
 387
 388
 389
 390
 391
 392
 393
 394
 395
 396
 397
 398
 399
 400
 401
 402
 403
 404
 405
 406
 407
 408
 409
 410
 411
 412
 413
 414
 415
 416
 417
 418
 419
 420
 421
 422
 423
 424
 425
 426
 427
 428
 429
 430
 431
 432
 433
 434
 435
 436
 437
 438
 439
 440
 441
 442
 443
 444
 445
 446
 447
 448
 449
 450
 451
 452
 453
 454
 455
 456
 457
 458
 459
 460
 461
 462
 463
 464
 465
 466
 467
 468
 469
 470
 471
 472
 473
 474
 475
 476
 477
 478
 479
 480
 481
 482
 483
 484
 485
 486
 487
 488
 489
 490
 491
 492
 493
 494
 495
 496
 497
 498
 499
 500
 501
 502
 503
 504
 505
 506
 507
 508
 509
 510
 511
 512
 513
 514
 515
 516
 517
 518
 519
 520
 521
 522
 523
 524
 525
 526
 527
 528
 529
 530
 531
 532
 533
 534
 535
 536
 537
 538
 539
 540
 541
 542
 543
 544
 545
 546
 547
 548
 549
 550
 551
 552
 553
 554
 555
 556
 557
 558
 559
 560
 561
 562
 563
 564
 565
 566
 567
 568
 569
 570
 571
 572
 573
 574
 575
 576
 577
 578
 579
 580
 581
 582
 583
 584
 585
 586
 587
 588
 589
 590
 591
 592
 593
 594
 595
 596
 597
 598
 599
 600
 601
 602
 603
 604
 605
 606
 607
 608
 609
 610
 611
 612
 613
 614
 615
 616
 617
 618
 619
 620
 621
 622
 623
 624
 625
 626
 627
 628
 629
 630
 631
 632
 633
 634
 635
 636
 637
 638
 639
 640
 641
 642
 643
 644
 645
 646
 647
 648
 649
 650
 651
 652
 653
 654
 655
 656
 657
 658
 659
 660
 661
 662
 663
 664
 665
 666
 667
 668
 669
 670
 671
 672
 673
 674
 675
 676
 677
 678
 679
 680
 681
 682
 683
 684
 685
 686
 687
 688
 689
 690
 691
 692
 693
 694
 695
 696
 697
 698
 699
 700
 701
 702
 703
 704
 705
 706
 707
 708
 709
 710
 711
 712
 713
 714
 715
 716
 717
 718
 719
 720
 721
 722
 723
 724
 725
 726
 727
 728
 729
 730
 731
 732
 733
 734
 735
 736
 737
 738
 739
 740
 741
 742
 743
 744
 745
 746
 747
 748
 749
 750
 751
 752
 753
 754
 755
 756
 757
 758
 759
 760
 761
 762
 763
 764
 765
 766
 767
 768
 769
 770
 771
 772
 773
 774
 775
 776
 777
 778
 779
 780
 781
 782
 783
 784
 785
 786
 787
 788
 789
 790
 791
 792
 793
 794
 795
 796
 797
 798
 799
 800
 801
 802
 803
 804
 805
 806
 807
 808
 809
 810
 811
 812
 813
 814
 815
 816
 817
 818
 819
 820
 821
 822
 823
 824
 825
 826
 827
 828
 829
 830
 831
 832
 833
 834
 835
 836
 837
 838
 839
 840
 841
 842
 843
 844
 845
 846
 847
 848
 849
 850
 851
 852
 853
 854
 855
 856
 857
 858
 859
 860
 861
 862
 863
 864
 865
 866
 867
 868
 869
 870
 871
 872
 873
 874
 875
 876
 877
 878
 879
 880
 881
 882
 883
 884
 885
 886
 887
 888
 889
 890
 891
 892
 893
 894
 895
 896
 897
 898
 899
 900
 901
 902
 903
 904
 905
 906
 907
 908
 909
 910
 911
 912
 913
 914
 915
 916
 917
 918
 919
 920
 921
 922
 923
 924
 925
 926
 927
 928
 929
 930
 931
 932
 933
 934
 935
 936
 937
 938
 939
 940
 941
 942
 943
 944
 945
 946
 947
 948
 949
 950
 951
 952
 953
 954
 955
 956
 957
 958
 959
 960
 961
 962
 963
 964
 965
 966
 967
 968
 969
 970
 971
 972
 973
 974
 975
 976
 977
 978
 979
 980
 981
 982
 983
 984
 985
 986
 987
 988
 989
 990
 991
 992
 993
 994
 995
 996
 997
 998
 999
1000
1001
1002
1003
1004
1005
1006
1007
1008
1009
1010
1011
1012
1013
1014
1015
1016
1017
1018
1019
1020
1021
1022
1023
1024
1025
1026
1027
1028
1029
1030
1031
1032
1033
1034
1035
1036
1037
1038
1039
1040
1041
1042
1043
1044
1045
1046
1047
1048
1049
1050
1051
1052
1053
1054
1055
1056
1057
1058
1059
1060
1061
1062
1063</pre></div></td><td class="code"><div class="highlight"><pre><span class="c1">//===-- Cpu0AsmParser.cpp - Parse Cpu0 assembly to MCInst instructions ----===//</span>
<span class="c1">//</span>
<span class="c1">//                     The LLVM Compiler Infrastructure</span>
<span class="c1">//</span>
<span class="c1">// This file is distributed under the University of Illinois Open Source</span>
<span class="c1">// License. See LICENSE.TXT for details.</span>
<span class="c1">//</span>
<span class="c1">//===----------------------------------------------------------------------===//</span>

<span class="cp">#include &quot;MCTargetDesc/Cpu0MCTargetDesc.h&quot;</span>
<span class="cp">#include &quot;Cpu0RegisterInfo.h&quot;</span>
<span class="cp">#include &quot;llvm/ADT/StringSwitch.h&quot;</span>
<span class="cp">#include &quot;llvm/MC/MCContext.h&quot;</span>
<span class="cp">#include &quot;llvm/MC/MCExpr.h&quot;</span>
<span class="cp">#include &quot;llvm/MC/MCInst.h&quot;</span>
<span class="cp">#include &quot;llvm/MC/MCStreamer.h&quot;</span>
<span class="cp">#include &quot;llvm/MC/MCSubtargetInfo.h&quot;</span>
<span class="cp">#include &quot;llvm/MC/MCSymbol.h&quot;</span>
<span class="cp">#include &quot;llvm/MC/MCParser/MCAsmLexer.h&quot;</span>
<span class="cp">#include &quot;llvm/MC/MCParser/MCParsedAsmOperand.h&quot;</span>
<span class="cp">#include &quot;llvm/MC/MCTargetAsmParser.h&quot;</span>
<span class="cp">#include &quot;llvm/Support/TargetRegistry.h&quot;</span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">llvm</span><span class="p">;</span>

<span class="k">namespace</span> <span class="p">{</span>
<span class="k">class</span> <span class="nc">Cpu0AssemblerOptions</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">Cpu0AssemblerOptions</span><span class="p">()</span><span class="o">:</span>
    <span class="n">aTReg</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">reorder</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span> <span class="n">macro</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">}</span>

  <span class="kt">bool</span> <span class="n">isReorder</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">reorder</span><span class="p">;}</span>
  <span class="kt">void</span> <span class="n">setReorder</span><span class="p">()</span> <span class="p">{</span><span class="n">reorder</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;}</span>
  <span class="kt">void</span> <span class="n">setNoreorder</span><span class="p">()</span> <span class="p">{</span><span class="n">reorder</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;}</span>

  <span class="kt">bool</span> <span class="n">isMacro</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">macro</span><span class="p">;}</span>
  <span class="kt">void</span> <span class="n">setMacro</span><span class="p">()</span> <span class="p">{</span><span class="n">macro</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;}</span>
  <span class="kt">void</span> <span class="n">setNomacro</span><span class="p">()</span> <span class="p">{</span><span class="n">macro</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;}</span>

<span class="k">private</span><span class="o">:</span>
  <span class="kt">unsigned</span> <span class="n">aTReg</span><span class="p">;</span>
  <span class="kt">bool</span> <span class="n">reorder</span><span class="p">;</span>
  <span class="kt">bool</span> <span class="n">macro</span><span class="p">;</span>
<span class="p">};</span>
<span class="p">}</span>

<span class="k">namespace</span> <span class="p">{</span>
<span class="k">class</span> <span class="nc">Cpu0AsmParser</span> <span class="o">:</span> <span class="k">public</span> <span class="n">MCTargetAsmParser</span> <span class="p">{</span>
  <span class="n">MCSubtargetInfo</span> <span class="o">&amp;</span><span class="n">STI</span><span class="p">;</span>
  <span class="n">MCAsmParser</span> <span class="o">&amp;</span><span class="n">Parser</span><span class="p">;</span>
  <span class="n">Cpu0AssemblerOptions</span> <span class="n">Options</span><span class="p">;</span>


<span class="cp">#define GET_ASSEMBLER_HEADER</span>
<span class="cp">#include &quot;Cpu0GenAsmMatcher.inc&quot;</span>

  <span class="kt">bool</span> <span class="n">MatchAndEmitInstruction</span><span class="p">(</span><span class="n">SMLoc</span> <span class="n">IDLoc</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="o">&amp;</span><span class="n">Opcode</span><span class="p">,</span>
                               <span class="n">SmallVectorImpl</span><span class="o">&lt;</span><span class="n">MCParsedAsmOperand</span><span class="o">*&gt;</span> <span class="o">&amp;</span><span class="n">Operands</span><span class="p">,</span>
                               <span class="n">MCStreamer</span> <span class="o">&amp;</span><span class="n">Out</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="o">&amp;</span><span class="n">ErrorInfo</span><span class="p">,</span>
                               <span class="kt">bool</span> <span class="n">MatchingInlineAsm</span><span class="p">);</span>

  <span class="kt">bool</span> <span class="n">ParseRegister</span><span class="p">(</span><span class="kt">unsigned</span> <span class="o">&amp;</span><span class="n">RegNo</span><span class="p">,</span> <span class="n">SMLoc</span> <span class="o">&amp;</span><span class="n">StartLoc</span><span class="p">,</span> <span class="n">SMLoc</span> <span class="o">&amp;</span><span class="n">EndLoc</span><span class="p">);</span>

  <span class="kt">bool</span> <span class="n">ParseInstruction</span><span class="p">(</span><span class="n">ParseInstructionInfo</span> <span class="o">&amp;</span><span class="n">Info</span><span class="p">,</span> <span class="n">StringRef</span> <span class="n">Name</span><span class="p">,</span>
                        <span class="n">SMLoc</span> <span class="n">NameLoc</span><span class="p">,</span>
                        <span class="n">SmallVectorImpl</span><span class="o">&lt;</span><span class="n">MCParsedAsmOperand</span><span class="o">*&gt;</span> <span class="o">&amp;</span><span class="n">Operands</span><span class="p">);</span>

  <span class="kt">bool</span> <span class="n">parseMathOperation</span><span class="p">(</span><span class="n">StringRef</span> <span class="n">Name</span><span class="p">,</span> <span class="n">SMLoc</span> <span class="n">NameLoc</span><span class="p">,</span>
                        <span class="n">SmallVectorImpl</span><span class="o">&lt;</span><span class="n">MCParsedAsmOperand</span><span class="o">*&gt;</span> <span class="o">&amp;</span><span class="n">Operands</span><span class="p">);</span>

  <span class="kt">bool</span> <span class="n">ParseDirective</span><span class="p">(</span><span class="n">AsmToken</span> <span class="n">DirectiveID</span><span class="p">);</span>

  <span class="n">Cpu0AsmParser</span><span class="o">::</span><span class="n">OperandMatchResultTy</span>
  <span class="n">parseMemOperand</span><span class="p">(</span><span class="n">SmallVectorImpl</span><span class="o">&lt;</span><span class="n">MCParsedAsmOperand</span><span class="o">*&gt;&amp;</span><span class="p">);</span>

  <span class="kt">bool</span> <span class="n">ParseOperand</span><span class="p">(</span><span class="n">SmallVectorImpl</span><span class="o">&lt;</span><span class="n">MCParsedAsmOperand</span><span class="o">*&gt;</span> <span class="o">&amp;</span><span class="p">,</span>
                    <span class="n">StringRef</span> <span class="n">Mnemonic</span><span class="p">);</span>

  <span class="kt">int</span> <span class="n">tryParseRegister</span><span class="p">(</span><span class="n">StringRef</span> <span class="n">Mnemonic</span><span class="p">);</span>

  <span class="kt">bool</span> <span class="n">tryParseRegisterOperand</span><span class="p">(</span><span class="n">SmallVectorImpl</span><span class="o">&lt;</span><span class="n">MCParsedAsmOperand</span><span class="o">*&gt;</span> <span class="o">&amp;</span><span class="n">Operands</span><span class="p">,</span>
                               <span class="n">StringRef</span> <span class="n">Mnemonic</span><span class="p">);</span>

  <span class="kt">bool</span> <span class="n">needsExpansion</span><span class="p">(</span><span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">Inst</span><span class="p">);</span>

  <span class="kt">void</span> <span class="n">expandInstruction</span><span class="p">(</span><span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">Inst</span><span class="p">,</span> <span class="n">SMLoc</span> <span class="n">IDLoc</span><span class="p">,</span>
                         <span class="n">SmallVectorImpl</span><span class="o">&lt;</span><span class="n">MCInst</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">Instructions</span><span class="p">);</span>
  <span class="kt">void</span> <span class="n">expandLoadImm</span><span class="p">(</span><span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">Inst</span><span class="p">,</span> <span class="n">SMLoc</span> <span class="n">IDLoc</span><span class="p">,</span>
                     <span class="n">SmallVectorImpl</span><span class="o">&lt;</span><span class="n">MCInst</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">Instructions</span><span class="p">);</span>
  <span class="kt">void</span> <span class="n">expandLoadAddressImm</span><span class="p">(</span><span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">Inst</span><span class="p">,</span> <span class="n">SMLoc</span> <span class="n">IDLoc</span><span class="p">,</span>
                            <span class="n">SmallVectorImpl</span><span class="o">&lt;</span><span class="n">MCInst</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">Instructions</span><span class="p">);</span>
  <span class="kt">void</span> <span class="n">expandLoadAddressReg</span><span class="p">(</span><span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">Inst</span><span class="p">,</span> <span class="n">SMLoc</span> <span class="n">IDLoc</span><span class="p">,</span>
                            <span class="n">SmallVectorImpl</span><span class="o">&lt;</span><span class="n">MCInst</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">Instructions</span><span class="p">);</span>
  <span class="kt">bool</span> <span class="n">reportParseError</span><span class="p">(</span><span class="n">StringRef</span> <span class="n">ErrorMsg</span><span class="p">);</span>

  <span class="kt">bool</span> <span class="n">parseMemOffset</span><span class="p">(</span><span class="k">const</span> <span class="n">MCExpr</span> <span class="o">*&amp;</span><span class="n">Res</span><span class="p">);</span>
  <span class="kt">bool</span> <span class="n">parseRelocOperand</span><span class="p">(</span><span class="k">const</span> <span class="n">MCExpr</span> <span class="o">*&amp;</span><span class="n">Res</span><span class="p">);</span>

  <span class="kt">bool</span> <span class="n">parseDirectiveSet</span><span class="p">();</span>

  <span class="kt">bool</span> <span class="n">parseSetAtDirective</span><span class="p">();</span>
  <span class="kt">bool</span> <span class="n">parseSetNoAtDirective</span><span class="p">();</span>
  <span class="kt">bool</span> <span class="n">parseSetMacroDirective</span><span class="p">();</span>
  <span class="kt">bool</span> <span class="n">parseSetNoMacroDirective</span><span class="p">();</span>
  <span class="kt">bool</span> <span class="n">parseSetReorderDirective</span><span class="p">();</span>
  <span class="kt">bool</span> <span class="n">parseSetNoReorderDirective</span><span class="p">();</span>

  <span class="n">MCSymbolRefExpr</span><span class="o">::</span><span class="n">VariantKind</span> <span class="n">getVariantKind</span><span class="p">(</span><span class="n">StringRef</span> <span class="n">Symbol</span><span class="p">);</span>

  <span class="kt">int</span> <span class="n">matchRegisterName</span><span class="p">(</span><span class="n">StringRef</span> <span class="n">Symbol</span><span class="p">);</span>

  <span class="kt">int</span> <span class="n">matchRegisterByNumber</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">RegNum</span><span class="p">,</span> <span class="n">StringRef</span> <span class="n">Mnemonic</span><span class="p">);</span>

  <span class="kt">unsigned</span> <span class="n">getReg</span><span class="p">(</span><span class="kt">int</span> <span class="n">RC</span><span class="p">,</span><span class="kt">int</span> <span class="n">RegNo</span><span class="p">);</span>

<span class="k">public</span><span class="o">:</span>
  <span class="n">Cpu0AsmParser</span><span class="p">(</span><span class="n">MCSubtargetInfo</span> <span class="o">&amp;</span><span class="n">sti</span><span class="p">,</span> <span class="n">MCAsmParser</span> <span class="o">&amp;</span><span class="n">parser</span><span class="p">)</span>
    <span class="o">:</span> <span class="n">MCTargetAsmParser</span><span class="p">(),</span> <span class="n">STI</span><span class="p">(</span><span class="n">sti</span><span class="p">),</span> <span class="n">Parser</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Initialize the set of available features.</span>
    <span class="n">setAvailableFeatures</span><span class="p">(</span><span class="n">ComputeAvailableFeatures</span><span class="p">(</span><span class="n">STI</span><span class="p">.</span><span class="n">getFeatureBits</span><span class="p">()));</span>
  <span class="p">}</span>

  <span class="n">MCAsmParser</span> <span class="o">&amp;</span><span class="n">getParser</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Parser</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">MCAsmLexer</span> <span class="o">&amp;</span><span class="n">getLexer</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Parser</span><span class="p">.</span><span class="n">getLexer</span><span class="p">();</span> <span class="p">}</span>

<span class="p">};</span>
<span class="p">}</span>

<span class="k">namespace</span> <span class="p">{</span>

<span class="c1">/// Cpu0Operand - Instances of this class represent a parsed Cpu0 machine</span>
<span class="c1">/// instruction.</span>
<span class="k">class</span> <span class="nc">Cpu0Operand</span> <span class="o">:</span> <span class="k">public</span> <span class="n">MCParsedAsmOperand</span> <span class="p">{</span>

  <span class="k">enum</span> <span class="n">KindTy</span> <span class="p">{</span>
    <span class="n">k_CondCode</span><span class="p">,</span>
    <span class="n">k_CoprocNum</span><span class="p">,</span>
    <span class="n">k_Immediate</span><span class="p">,</span>
    <span class="n">k_Memory</span><span class="p">,</span>
    <span class="n">k_PostIndexRegister</span><span class="p">,</span>
    <span class="n">k_Register</span><span class="p">,</span>
    <span class="n">k_Token</span>
  <span class="p">}</span> <span class="n">Kind</span><span class="p">;</span>

  <span class="n">Cpu0Operand</span><span class="p">(</span><span class="n">KindTy</span> <span class="n">K</span><span class="p">)</span> <span class="o">:</span> <span class="n">MCParsedAsmOperand</span><span class="p">(),</span> <span class="n">Kind</span><span class="p">(</span><span class="n">K</span><span class="p">)</span> <span class="p">{}</span>

  <span class="k">union</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="p">{</span>
      <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">Data</span><span class="p">;</span>
      <span class="kt">unsigned</span> <span class="n">Length</span><span class="p">;</span>
    <span class="p">}</span> <span class="n">Tok</span><span class="p">;</span>

    <span class="k">struct</span> <span class="p">{</span>
      <span class="kt">unsigned</span> <span class="n">RegNum</span><span class="p">;</span>
    <span class="p">}</span> <span class="n">Reg</span><span class="p">;</span>

    <span class="k">struct</span> <span class="p">{</span>
      <span class="k">const</span> <span class="n">MCExpr</span> <span class="o">*</span><span class="n">Val</span><span class="p">;</span>
    <span class="p">}</span> <span class="n">Imm</span><span class="p">;</span>

    <span class="k">struct</span> <span class="p">{</span>
      <span class="kt">unsigned</span> <span class="n">Base</span><span class="p">;</span>
      <span class="k">const</span> <span class="n">MCExpr</span> <span class="o">*</span><span class="n">Off</span><span class="p">;</span>
    <span class="p">}</span> <span class="n">Mem</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="n">SMLoc</span> <span class="n">StartLoc</span><span class="p">,</span> <span class="n">EndLoc</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">addRegOperands</span><span class="p">(</span><span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">Inst</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">N</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="s">&quot;Invalid number of operands!&quot;</span><span class="p">);</span>
    <span class="n">Inst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">getReg</span><span class="p">()));</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="n">addExpr</span><span class="p">(</span><span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">Inst</span><span class="p">,</span> <span class="k">const</span> <span class="n">MCExpr</span> <span class="o">*</span><span class="n">Expr</span><span class="p">)</span> <span class="k">const</span><span class="p">{</span>
    <span class="c1">// Add as immediate when possible.  Null MCExpr = 0.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Expr</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
      <span class="n">Inst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateImm</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">const</span> <span class="n">MCConstantExpr</span> <span class="o">*</span><span class="n">CE</span> <span class="o">=</span> <span class="n">dyn_cast</span><span class="o">&lt;</span><span class="n">MCConstantExpr</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Expr</span><span class="p">))</span>
      <span class="n">Inst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateImm</span><span class="p">(</span><span class="n">CE</span><span class="o">-&gt;</span><span class="n">getValue</span><span class="p">()));</span>
    <span class="k">else</span>
      <span class="n">Inst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateExpr</span><span class="p">(</span><span class="n">Expr</span><span class="p">));</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="n">addImmOperands</span><span class="p">(</span><span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">Inst</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">N</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="s">&quot;Invalid number of operands!&quot;</span><span class="p">);</span>
    <span class="k">const</span> <span class="n">MCExpr</span> <span class="o">*</span><span class="n">Expr</span> <span class="o">=</span> <span class="n">getImm</span><span class="p">();</span>
    <span class="n">addExpr</span><span class="p">(</span><span class="n">Inst</span><span class="p">,</span><span class="n">Expr</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="n">addMemOperands</span><span class="p">(</span><span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">Inst</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">N</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">N</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="s">&quot;Invalid number of operands!&quot;</span><span class="p">);</span>

    <span class="n">Inst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">getMemBase</span><span class="p">()));</span>

    <span class="k">const</span> <span class="n">MCExpr</span> <span class="o">*</span><span class="n">Expr</span> <span class="o">=</span> <span class="n">getMemOff</span><span class="p">();</span>
    <span class="n">addExpr</span><span class="p">(</span><span class="n">Inst</span><span class="p">,</span><span class="n">Expr</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kt">bool</span> <span class="n">isReg</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Kind</span> <span class="o">==</span> <span class="n">k_Register</span><span class="p">;</span> <span class="p">}</span>
  <span class="kt">bool</span> <span class="n">isImm</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Kind</span> <span class="o">==</span> <span class="n">k_Immediate</span><span class="p">;</span> <span class="p">}</span>
  <span class="kt">bool</span> <span class="n">isToken</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Kind</span> <span class="o">==</span> <span class="n">k_Token</span><span class="p">;</span> <span class="p">}</span>
  <span class="kt">bool</span> <span class="n">isMem</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Kind</span> <span class="o">==</span> <span class="n">k_Memory</span><span class="p">;</span> <span class="p">}</span>

  <span class="n">StringRef</span> <span class="n">getToken</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">Kind</span> <span class="o">==</span> <span class="n">k_Token</span> <span class="o">&amp;&amp;</span> <span class="s">&quot;Invalid access!&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">StringRef</span><span class="p">(</span><span class="n">Tok</span><span class="p">.</span><span class="n">Data</span><span class="p">,</span> <span class="n">Tok</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kt">unsigned</span> <span class="n">getReg</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
    <span class="n">assert</span><span class="p">((</span><span class="n">Kind</span> <span class="o">==</span> <span class="n">k_Register</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="s">&quot;Invalid access!&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">Reg</span><span class="p">.</span><span class="n">RegNum</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">const</span> <span class="n">MCExpr</span> <span class="o">*</span><span class="n">getImm</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
    <span class="n">assert</span><span class="p">((</span><span class="n">Kind</span> <span class="o">==</span> <span class="n">k_Immediate</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="s">&quot;Invalid access!&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">Imm</span><span class="p">.</span><span class="n">Val</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kt">unsigned</span> <span class="n">getMemBase</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
    <span class="n">assert</span><span class="p">((</span><span class="n">Kind</span> <span class="o">==</span> <span class="n">k_Memory</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="s">&quot;Invalid access!&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">Mem</span><span class="p">.</span><span class="n">Base</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">const</span> <span class="n">MCExpr</span> <span class="o">*</span><span class="n">getMemOff</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
    <span class="n">assert</span><span class="p">((</span><span class="n">Kind</span> <span class="o">==</span> <span class="n">k_Memory</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="s">&quot;Invalid access!&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">Mem</span><span class="p">.</span><span class="n">Off</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">static</span> <span class="n">Cpu0Operand</span> <span class="o">*</span><span class="n">CreateToken</span><span class="p">(</span><span class="n">StringRef</span> <span class="n">Str</span><span class="p">,</span> <span class="n">SMLoc</span> <span class="n">S</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Cpu0Operand</span> <span class="o">*</span><span class="n">Op</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Cpu0Operand</span><span class="p">(</span><span class="n">k_Token</span><span class="p">);</span>
    <span class="n">Op</span><span class="o">-&gt;</span><span class="n">Tok</span><span class="p">.</span><span class="n">Data</span> <span class="o">=</span> <span class="n">Str</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
    <span class="n">Op</span><span class="o">-&gt;</span><span class="n">Tok</span><span class="p">.</span><span class="n">Length</span> <span class="o">=</span> <span class="n">Str</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
    <span class="n">Op</span><span class="o">-&gt;</span><span class="n">StartLoc</span> <span class="o">=</span> <span class="n">S</span><span class="p">;</span>
    <span class="n">Op</span><span class="o">-&gt;</span><span class="n">EndLoc</span> <span class="o">=</span> <span class="n">S</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">Op</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">static</span> <span class="n">Cpu0Operand</span> <span class="o">*</span><span class="n">CreateReg</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">RegNum</span><span class="p">,</span> <span class="n">SMLoc</span> <span class="n">S</span><span class="p">,</span> <span class="n">SMLoc</span> <span class="n">E</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Cpu0Operand</span> <span class="o">*</span><span class="n">Op</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Cpu0Operand</span><span class="p">(</span><span class="n">k_Register</span><span class="p">);</span>
    <span class="n">Op</span><span class="o">-&gt;</span><span class="n">Reg</span><span class="p">.</span><span class="n">RegNum</span> <span class="o">=</span> <span class="n">RegNum</span><span class="p">;</span>
    <span class="n">Op</span><span class="o">-&gt;</span><span class="n">StartLoc</span> <span class="o">=</span> <span class="n">S</span><span class="p">;</span>
    <span class="n">Op</span><span class="o">-&gt;</span><span class="n">EndLoc</span> <span class="o">=</span> <span class="n">E</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">Op</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">static</span> <span class="n">Cpu0Operand</span> <span class="o">*</span><span class="n">CreateImm</span><span class="p">(</span><span class="k">const</span> <span class="n">MCExpr</span> <span class="o">*</span><span class="n">Val</span><span class="p">,</span> <span class="n">SMLoc</span> <span class="n">S</span><span class="p">,</span> <span class="n">SMLoc</span> <span class="n">E</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Cpu0Operand</span> <span class="o">*</span><span class="n">Op</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Cpu0Operand</span><span class="p">(</span><span class="n">k_Immediate</span><span class="p">);</span>
    <span class="n">Op</span><span class="o">-&gt;</span><span class="n">Imm</span><span class="p">.</span><span class="n">Val</span> <span class="o">=</span> <span class="n">Val</span><span class="p">;</span>
    <span class="n">Op</span><span class="o">-&gt;</span><span class="n">StartLoc</span> <span class="o">=</span> <span class="n">S</span><span class="p">;</span>
    <span class="n">Op</span><span class="o">-&gt;</span><span class="n">EndLoc</span> <span class="o">=</span> <span class="n">E</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">Op</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">static</span> <span class="n">Cpu0Operand</span> <span class="o">*</span><span class="n">CreateMem</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">Base</span><span class="p">,</span> <span class="k">const</span> <span class="n">MCExpr</span> <span class="o">*</span><span class="n">Off</span><span class="p">,</span>
                                 <span class="n">SMLoc</span> <span class="n">S</span><span class="p">,</span> <span class="n">SMLoc</span> <span class="n">E</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Cpu0Operand</span> <span class="o">*</span><span class="n">Op</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Cpu0Operand</span><span class="p">(</span><span class="n">k_Memory</span><span class="p">);</span>
    <span class="n">Op</span><span class="o">-&gt;</span><span class="n">Mem</span><span class="p">.</span><span class="n">Base</span> <span class="o">=</span> <span class="n">Base</span><span class="p">;</span>
    <span class="n">Op</span><span class="o">-&gt;</span><span class="n">Mem</span><span class="p">.</span><span class="n">Off</span> <span class="o">=</span> <span class="n">Off</span><span class="p">;</span>
    <span class="n">Op</span><span class="o">-&gt;</span><span class="n">StartLoc</span> <span class="o">=</span> <span class="n">S</span><span class="p">;</span>
    <span class="n">Op</span><span class="o">-&gt;</span><span class="n">EndLoc</span> <span class="o">=</span> <span class="n">E</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">Op</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">/// getStartLoc - Get the location of the first token of this operand.</span>
  <span class="n">SMLoc</span> <span class="n">getStartLoc</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">StartLoc</span><span class="p">;</span> <span class="p">}</span>
  <span class="c1">/// getEndLoc - Get the location of the last token of this operand.</span>
  <span class="n">SMLoc</span> <span class="n">getEndLoc</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">EndLoc</span><span class="p">;</span> <span class="p">}</span>

  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">print</span><span class="p">(</span><span class="n">raw_ostream</span> <span class="o">&amp;</span><span class="n">OS</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="n">llvm_unreachable</span><span class="p">(</span><span class="s">&quot;unimplemented!&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">Cpu0AsmParser</span><span class="o">::</span><span class="n">needsExpansion</span><span class="p">(</span><span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">Inst</span><span class="p">)</span> <span class="p">{</span>

  <span class="k">switch</span><span class="p">(</span><span class="n">Inst</span><span class="p">.</span><span class="n">getOpcode</span><span class="p">())</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">Cpu0</span><span class="o">::</span><span class="nl">LoadImm32Reg:</span>
    <span class="k">case</span> <span class="n">Cpu0</span><span class="o">::</span><span class="nl">LoadAddr32Imm:</span>
    <span class="k">case</span> <span class="n">Cpu0</span><span class="o">::</span><span class="nl">LoadAddr32Reg:</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Cpu0AsmParser</span><span class="o">::</span><span class="n">expandInstruction</span><span class="p">(</span><span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">Inst</span><span class="p">,</span> <span class="n">SMLoc</span> <span class="n">IDLoc</span><span class="p">,</span>
                        <span class="n">SmallVectorImpl</span><span class="o">&lt;</span><span class="n">MCInst</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">Instructions</span><span class="p">){</span>
  <span class="k">switch</span><span class="p">(</span><span class="n">Inst</span><span class="p">.</span><span class="n">getOpcode</span><span class="p">())</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">Cpu0</span><span class="o">::</span><span class="nl">LoadImm32Reg:</span>
      <span class="k">return</span> <span class="n">expandLoadImm</span><span class="p">(</span><span class="n">Inst</span><span class="p">,</span> <span class="n">IDLoc</span><span class="p">,</span> <span class="n">Instructions</span><span class="p">);</span>
    <span class="k">case</span> <span class="n">Cpu0</span><span class="o">::</span><span class="nl">LoadAddr32Imm:</span>
      <span class="k">return</span> <span class="n">expandLoadAddressImm</span><span class="p">(</span><span class="n">Inst</span><span class="p">,</span><span class="n">IDLoc</span><span class="p">,</span><span class="n">Instructions</span><span class="p">);</span>
    <span class="k">case</span> <span class="n">Cpu0</span><span class="o">::</span><span class="nl">LoadAddr32Reg:</span>
      <span class="k">return</span> <span class="n">expandLoadAddressReg</span><span class="p">(</span><span class="n">Inst</span><span class="p">,</span><span class="n">IDLoc</span><span class="p">,</span><span class="n">Instructions</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Cpu0AsmParser</span><span class="o">::</span><span class="n">expandLoadImm</span><span class="p">(</span><span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">Inst</span><span class="p">,</span> <span class="n">SMLoc</span> <span class="n">IDLoc</span><span class="p">,</span>
                                  <span class="n">SmallVectorImpl</span><span class="o">&lt;</span><span class="n">MCInst</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">Instructions</span><span class="p">){</span>
  <span class="n">MCInst</span> <span class="n">tmpInst</span><span class="p">;</span>
  <span class="k">const</span> <span class="n">MCOperand</span> <span class="o">&amp;</span><span class="n">ImmOp</span> <span class="o">=</span> <span class="n">Inst</span><span class="p">.</span><span class="n">getOperand</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="n">assert</span><span class="p">(</span><span class="n">ImmOp</span><span class="p">.</span><span class="n">isImm</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="s">&quot;expected immediate operand kind&quot;</span><span class="p">);</span>
  <span class="k">const</span> <span class="n">MCOperand</span> <span class="o">&amp;</span><span class="n">RegOp</span> <span class="o">=</span> <span class="n">Inst</span><span class="p">.</span><span class="n">getOperand</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="n">assert</span><span class="p">(</span><span class="n">RegOp</span><span class="p">.</span><span class="n">isReg</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="s">&quot;expected register operand kind&quot;</span><span class="p">);</span>

  <span class="kt">int</span> <span class="n">ImmValue</span> <span class="o">=</span> <span class="n">ImmOp</span><span class="p">.</span><span class="n">getImm</span><span class="p">();</span>
  <span class="n">tmpInst</span><span class="p">.</span><span class="n">setLoc</span><span class="p">(</span><span class="n">IDLoc</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="o">-</span><span class="mi">32768</span> <span class="o">&lt;=</span> <span class="n">ImmValue</span> <span class="o">&amp;&amp;</span> <span class="n">ImmValue</span> <span class="o">&lt;=</span> <span class="mi">32767</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// for -32768 &lt;= j &lt; 32767.</span>
    <span class="c1">// li d,j =&gt; addiu d,$zero,j</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">setOpcode</span><span class="p">(</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">ADDiu</span><span class="p">);</span> <span class="c1">//TODO:no ADDiu64 in td files?</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">RegOp</span><span class="p">.</span><span class="n">getReg</span><span class="p">()));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span>
              <span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">ZERO</span><span class="p">));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateImm</span><span class="p">(</span><span class="n">ImmValue</span><span class="p">));</span>
    <span class="n">Instructions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">tmpInst</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// for any other value of j that is representable as a 32-bit integer.</span>
    <span class="c1">// li d,j =&gt; addiu d, $0, hi16(j)</span>
    <span class="c1">//           shl d, d, 16</span>
    <span class="c1">//           addiu at, $0, lo16(j)</span>
    <span class="c1">//           or d, d, at</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">setOpcode</span><span class="p">(</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">ADDiu</span><span class="p">);</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">RegOp</span><span class="p">.</span><span class="n">getReg</span><span class="p">()));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">ZERO</span><span class="p">));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateImm</span><span class="p">((</span><span class="n">ImmValue</span> <span class="o">&amp;</span> <span class="mh">0xffff0000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">));</span>
    <span class="n">Instructions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">tmpInst</span><span class="p">);</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">setOpcode</span><span class="p">(</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">SHL</span><span class="p">);</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">RegOp</span><span class="p">.</span><span class="n">getReg</span><span class="p">()));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">RegOp</span><span class="p">.</span><span class="n">getReg</span><span class="p">()));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateImm</span><span class="p">(</span><span class="mi">16</span><span class="p">));</span>
    <span class="n">Instructions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">tmpInst</span><span class="p">);</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">setOpcode</span><span class="p">(</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">ADDiu</span><span class="p">);</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">AT</span><span class="p">));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">ZERO</span><span class="p">));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateImm</span><span class="p">(</span><span class="n">ImmValue</span> <span class="o">&amp;</span> <span class="mh">0x0000ffff</span><span class="p">));</span>
    <span class="n">Instructions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">tmpInst</span><span class="p">);</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">setOpcode</span><span class="p">(</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">OR</span><span class="p">);</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">RegOp</span><span class="p">.</span><span class="n">getReg</span><span class="p">()));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">RegOp</span><span class="p">.</span><span class="n">getReg</span><span class="p">()));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">AT</span><span class="p">));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">setLoc</span><span class="p">(</span><span class="n">IDLoc</span><span class="p">);</span>
    <span class="n">Instructions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">tmpInst</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Cpu0AsmParser</span><span class="o">::</span><span class="n">expandLoadAddressReg</span><span class="p">(</span><span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">Inst</span><span class="p">,</span> <span class="n">SMLoc</span> <span class="n">IDLoc</span><span class="p">,</span>
                                         <span class="n">SmallVectorImpl</span><span class="o">&lt;</span><span class="n">MCInst</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">Instructions</span><span class="p">){</span>
  <span class="n">MCInst</span> <span class="n">tmpInst</span><span class="p">;</span>
  <span class="k">const</span> <span class="n">MCOperand</span> <span class="o">&amp;</span><span class="n">ImmOp</span> <span class="o">=</span> <span class="n">Inst</span><span class="p">.</span><span class="n">getOperand</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="n">assert</span><span class="p">(</span><span class="n">ImmOp</span><span class="p">.</span><span class="n">isImm</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="s">&quot;expected immediate operand kind&quot;</span><span class="p">);</span>
  <span class="k">const</span> <span class="n">MCOperand</span> <span class="o">&amp;</span><span class="n">SrcRegOp</span> <span class="o">=</span> <span class="n">Inst</span><span class="p">.</span><span class="n">getOperand</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="n">assert</span><span class="p">(</span><span class="n">SrcRegOp</span><span class="p">.</span><span class="n">isReg</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="s">&quot;expected register operand kind&quot;</span><span class="p">);</span>
  <span class="k">const</span> <span class="n">MCOperand</span> <span class="o">&amp;</span><span class="n">DstRegOp</span> <span class="o">=</span> <span class="n">Inst</span><span class="p">.</span><span class="n">getOperand</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="n">assert</span><span class="p">(</span><span class="n">DstRegOp</span><span class="p">.</span><span class="n">isReg</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="s">&quot;expected register operand kind&quot;</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">ImmValue</span> <span class="o">=</span> <span class="n">ImmOp</span><span class="p">.</span><span class="n">getImm</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span> <span class="o">-</span><span class="mi">32768</span> <span class="o">&lt;=</span> <span class="n">ImmValue</span> <span class="o">&amp;&amp;</span> <span class="n">ImmValue</span> <span class="o">&lt;=</span> <span class="mi">32767</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// for -32768 &lt;= j &lt; 32767.</span>
    <span class="c1">//la d,j(s) =&gt; addiu d,s,j</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">setOpcode</span><span class="p">(</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">ADDiu</span><span class="p">);</span> <span class="c1">//TODO:no ADDiu64 in td files?</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">DstRegOp</span><span class="p">.</span><span class="n">getReg</span><span class="p">()));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">SrcRegOp</span><span class="p">.</span><span class="n">getReg</span><span class="p">()));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateImm</span><span class="p">(</span><span class="n">ImmValue</span><span class="p">));</span>
    <span class="n">Instructions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">tmpInst</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// for any other value of j that is representable as a 32-bit integer.</span>
    <span class="c1">// li d,j(s) =&gt; addiu d, $0, hi16(j)</span>
    <span class="c1">//           shl d, d, 16</span>
    <span class="c1">//           addiu at, $0, lo16(j)</span>
    <span class="c1">//           or d, d, at</span>
    <span class="c1">//           add d,d,s</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">setOpcode</span><span class="p">(</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">ADDiu</span><span class="p">);</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">DstRegOp</span><span class="p">.</span><span class="n">getReg</span><span class="p">()));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">ZERO</span><span class="p">));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateImm</span><span class="p">((</span><span class="n">ImmValue</span> <span class="o">&amp;</span> <span class="mh">0xffff0000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">));</span>
    <span class="n">Instructions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">tmpInst</span><span class="p">);</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">setOpcode</span><span class="p">(</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">SHL</span><span class="p">);</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">DstRegOp</span><span class="p">.</span><span class="n">getReg</span><span class="p">()));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">SrcRegOp</span><span class="p">.</span><span class="n">getReg</span><span class="p">()));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateImm</span><span class="p">(</span><span class="mi">16</span><span class="p">));</span>
    <span class="n">Instructions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">tmpInst</span><span class="p">);</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">setOpcode</span><span class="p">(</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">ADDiu</span><span class="p">);</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">AT</span><span class="p">));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">ZERO</span><span class="p">));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateImm</span><span class="p">(</span><span class="n">ImmValue</span> <span class="o">&amp;</span> <span class="mh">0x0000ffff</span><span class="p">));</span>
    <span class="n">Instructions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">tmpInst</span><span class="p">);</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">setOpcode</span><span class="p">(</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">OR</span><span class="p">);</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">DstRegOp</span><span class="p">.</span><span class="n">getReg</span><span class="p">()));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">SrcRegOp</span><span class="p">.</span><span class="n">getReg</span><span class="p">()));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">AT</span><span class="p">));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">setLoc</span><span class="p">(</span><span class="n">IDLoc</span><span class="p">);</span>
    <span class="n">Instructions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">tmpInst</span><span class="p">);</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">setOpcode</span><span class="p">(</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">ADD</span><span class="p">);</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">DstRegOp</span><span class="p">.</span><span class="n">getReg</span><span class="p">()));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">DstRegOp</span><span class="p">.</span><span class="n">getReg</span><span class="p">()));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">SrcRegOp</span><span class="p">.</span><span class="n">getReg</span><span class="p">()));</span>
    <span class="n">Instructions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">tmpInst</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Cpu0AsmParser</span><span class="o">::</span><span class="n">expandLoadAddressImm</span><span class="p">(</span><span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">Inst</span><span class="p">,</span> <span class="n">SMLoc</span> <span class="n">IDLoc</span><span class="p">,</span>
                                         <span class="n">SmallVectorImpl</span><span class="o">&lt;</span><span class="n">MCInst</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">Instructions</span><span class="p">){</span>
  <span class="n">MCInst</span> <span class="n">tmpInst</span><span class="p">;</span>
  <span class="k">const</span> <span class="n">MCOperand</span> <span class="o">&amp;</span><span class="n">ImmOp</span> <span class="o">=</span> <span class="n">Inst</span><span class="p">.</span><span class="n">getOperand</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="n">assert</span><span class="p">(</span><span class="n">ImmOp</span><span class="p">.</span><span class="n">isImm</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="s">&quot;expected immediate operand kind&quot;</span><span class="p">);</span>
  <span class="k">const</span> <span class="n">MCOperand</span> <span class="o">&amp;</span><span class="n">RegOp</span> <span class="o">=</span> <span class="n">Inst</span><span class="p">.</span><span class="n">getOperand</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="n">assert</span><span class="p">(</span><span class="n">RegOp</span><span class="p">.</span><span class="n">isReg</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="s">&quot;expected register operand kind&quot;</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">ImmValue</span> <span class="o">=</span> <span class="n">ImmOp</span><span class="p">.</span><span class="n">getImm</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span> <span class="o">-</span><span class="mi">32768</span> <span class="o">&lt;=</span> <span class="n">ImmValue</span> <span class="o">&amp;&amp;</span> <span class="n">ImmValue</span> <span class="o">&lt;=</span> <span class="mi">32767</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// for -32768 &lt;= j &lt; 32767.</span>
    <span class="c1">//la d,j =&gt; addiu d,$zero,j</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">setOpcode</span><span class="p">(</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">ADDiu</span><span class="p">);</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">RegOp</span><span class="p">.</span><span class="n">getReg</span><span class="p">()));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span>
              <span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">ZERO</span><span class="p">));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateImm</span><span class="p">(</span><span class="n">ImmValue</span><span class="p">));</span>
    <span class="n">Instructions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">tmpInst</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// for any other value of j that is representable as a 32-bit integer.</span>
    <span class="c1">// la d,j =&gt; addiu d, $0, hi16(j)</span>
    <span class="c1">//           shl d, d, 16</span>
    <span class="c1">//           addiu at, $0, lo16(j)</span>
    <span class="c1">//           or d, d, at</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">setOpcode</span><span class="p">(</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">ADDiu</span><span class="p">);</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">RegOp</span><span class="p">.</span><span class="n">getReg</span><span class="p">()));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">ZERO</span><span class="p">));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateImm</span><span class="p">((</span><span class="n">ImmValue</span> <span class="o">&amp;</span> <span class="mh">0xffff0000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">));</span>
    <span class="n">Instructions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">tmpInst</span><span class="p">);</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">setOpcode</span><span class="p">(</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">SHL</span><span class="p">);</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">RegOp</span><span class="p">.</span><span class="n">getReg</span><span class="p">()));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">RegOp</span><span class="p">.</span><span class="n">getReg</span><span class="p">()));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateImm</span><span class="p">(</span><span class="mi">16</span><span class="p">));</span>
    <span class="n">Instructions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">tmpInst</span><span class="p">);</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">setOpcode</span><span class="p">(</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">ADDiu</span><span class="p">);</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">AT</span><span class="p">));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">ZERO</span><span class="p">));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateImm</span><span class="p">(</span><span class="n">ImmValue</span> <span class="o">&amp;</span> <span class="mh">0x0000ffff</span><span class="p">));</span>
    <span class="n">Instructions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">tmpInst</span><span class="p">);</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">setOpcode</span><span class="p">(</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">OR</span><span class="p">);</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">RegOp</span><span class="p">.</span><span class="n">getReg</span><span class="p">()));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">RegOp</span><span class="p">.</span><span class="n">getReg</span><span class="p">()));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">AT</span><span class="p">));</span>
    <span class="n">tmpInst</span><span class="p">.</span><span class="n">setLoc</span><span class="p">(</span><span class="n">IDLoc</span><span class="p">);</span>
    <span class="n">Instructions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">tmpInst</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">Cpu0AsmParser</span><span class="o">::</span>
<span class="n">MatchAndEmitInstruction</span><span class="p">(</span><span class="n">SMLoc</span> <span class="n">IDLoc</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="o">&amp;</span><span class="n">Opcode</span><span class="p">,</span>
                        <span class="n">SmallVectorImpl</span><span class="o">&lt;</span><span class="n">MCParsedAsmOperand</span><span class="o">*&gt;</span> <span class="o">&amp;</span><span class="n">Operands</span><span class="p">,</span>
                        <span class="n">MCStreamer</span> <span class="o">&amp;</span><span class="n">Out</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="o">&amp;</span><span class="n">ErrorInfo</span><span class="p">,</span>
                        <span class="kt">bool</span> <span class="n">MatchingInlineAsm</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">MCInst</span> <span class="n">Inst</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="n">MatchResult</span> <span class="o">=</span> <span class="n">MatchInstructionImpl</span><span class="p">(</span><span class="n">Operands</span><span class="p">,</span> <span class="n">Inst</span><span class="p">,</span> <span class="n">ErrorInfo</span><span class="p">,</span>
                                              <span class="n">MatchingInlineAsm</span><span class="p">);</span>

  <span class="k">switch</span> <span class="p">(</span><span class="n">MatchResult</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">default</span><span class="o">:</span> <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="nl">Match_Success:</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">needsExpansion</span><span class="p">(</span><span class="n">Inst</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">SmallVector</span><span class="o">&lt;</span><span class="n">MCInst</span><span class="p">,</span> <span class="mi">4</span><span class="o">&gt;</span> <span class="n">Instructions</span><span class="p">;</span>
      <span class="n">expandInstruction</span><span class="p">(</span><span class="n">Inst</span><span class="p">,</span> <span class="n">IDLoc</span><span class="p">,</span> <span class="n">Instructions</span><span class="p">);</span>
      <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">i</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">Instructions</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">Out</span><span class="p">.</span><span class="n">EmitInstruction</span><span class="p">(</span><span class="n">Instructions</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">Inst</span><span class="p">.</span><span class="n">setLoc</span><span class="p">(</span><span class="n">IDLoc</span><span class="p">);</span>
        <span class="n">Out</span><span class="p">.</span><span class="n">EmitInstruction</span><span class="p">(</span><span class="n">Inst</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">case</span> <span class="nl">Match_MissingFeature:</span>
    <span class="n">Error</span><span class="p">(</span><span class="n">IDLoc</span><span class="p">,</span> <span class="s">&quot;instruction requires a CPU feature not currently enabled&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="k">case</span> <span class="nl">Match_InvalidOperand:</span> <span class="p">{</span>
    <span class="n">SMLoc</span> <span class="n">ErrorLoc</span> <span class="o">=</span> <span class="n">IDLoc</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ErrorInfo</span> <span class="o">!=</span> <span class="o">~</span><span class="mi">0U</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">ErrorInfo</span> <span class="o">&gt;=</span> <span class="n">Operands</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">Error</span><span class="p">(</span><span class="n">IDLoc</span><span class="p">,</span> <span class="s">&quot;too few operands for instruction&quot;</span><span class="p">);</span>

      <span class="n">ErrorLoc</span> <span class="o">=</span> <span class="p">((</span><span class="n">Cpu0Operand</span><span class="o">*</span><span class="p">)</span><span class="n">Operands</span><span class="p">[</span><span class="n">ErrorInfo</span><span class="p">])</span><span class="o">-&gt;</span><span class="n">getStartLoc</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">ErrorLoc</span> <span class="o">==</span> <span class="n">SMLoc</span><span class="p">())</span> <span class="n">ErrorLoc</span> <span class="o">=</span> <span class="n">IDLoc</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">Error</span><span class="p">(</span><span class="n">ErrorLoc</span><span class="p">,</span> <span class="s">&quot;invalid operand for instruction&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">case</span> <span class="nl">Match_MnemonicFail:</span>
    <span class="k">return</span> <span class="n">Error</span><span class="p">(</span><span class="n">IDLoc</span><span class="p">,</span> <span class="s">&quot;invalid instruction&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">Cpu0AsmParser</span><span class="o">::</span><span class="n">matchRegisterName</span><span class="p">(</span><span class="n">StringRef</span> <span class="n">Name</span><span class="p">)</span> <span class="p">{</span>

   <span class="kt">int</span> <span class="n">CC</span><span class="p">;</span>
    <span class="n">CC</span> <span class="o">=</span> <span class="n">StringSwitch</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Name</span><span class="p">)</span>
      <span class="p">.</span><span class="n">Case</span><span class="p">(</span><span class="s">&quot;zero&quot;</span><span class="p">,</span>  <span class="n">Cpu0</span><span class="o">::</span><span class="n">ZERO</span><span class="p">)</span>
      <span class="p">.</span><span class="n">Case</span><span class="p">(</span><span class="s">&quot;at&quot;</span><span class="p">,</span>  <span class="n">Cpu0</span><span class="o">::</span><span class="n">AT</span><span class="p">)</span>
      <span class="p">.</span><span class="n">Case</span><span class="p">(</span><span class="s">&quot;v0&quot;</span><span class="p">,</span>  <span class="n">Cpu0</span><span class="o">::</span><span class="n">V0</span><span class="p">)</span>
      <span class="p">.</span><span class="n">Case</span><span class="p">(</span><span class="s">&quot;v1&quot;</span><span class="p">,</span>  <span class="n">Cpu0</span><span class="o">::</span><span class="n">V1</span><span class="p">)</span>
      <span class="p">.</span><span class="n">Case</span><span class="p">(</span><span class="s">&quot;a0&quot;</span><span class="p">,</span>  <span class="n">Cpu0</span><span class="o">::</span><span class="n">A0</span><span class="p">)</span>
      <span class="p">.</span><span class="n">Case</span><span class="p">(</span><span class="s">&quot;a1&quot;</span><span class="p">,</span>  <span class="n">Cpu0</span><span class="o">::</span><span class="n">A1</span><span class="p">)</span>
      <span class="p">.</span><span class="n">Case</span><span class="p">(</span><span class="s">&quot;t9&quot;</span><span class="p">,</span>  <span class="n">Cpu0</span><span class="o">::</span><span class="n">T9</span><span class="p">)</span>
      <span class="p">.</span><span class="n">Case</span><span class="p">(</span><span class="s">&quot;s0&quot;</span><span class="p">,</span>  <span class="n">Cpu0</span><span class="o">::</span><span class="n">S0</span><span class="p">)</span>
      <span class="p">.</span><span class="n">Case</span><span class="p">(</span><span class="s">&quot;s1&quot;</span><span class="p">,</span>  <span class="n">Cpu0</span><span class="o">::</span><span class="n">S1</span><span class="p">)</span>
      <span class="p">.</span><span class="n">Case</span><span class="p">(</span><span class="s">&quot;s2&quot;</span><span class="p">,</span>  <span class="n">Cpu0</span><span class="o">::</span><span class="n">S2</span><span class="p">)</span>
      <span class="p">.</span><span class="n">Case</span><span class="p">(</span><span class="s">&quot;gp&quot;</span><span class="p">,</span>  <span class="n">Cpu0</span><span class="o">::</span><span class="n">GP</span><span class="p">)</span>
      <span class="p">.</span><span class="n">Case</span><span class="p">(</span><span class="s">&quot;fp&quot;</span><span class="p">,</span>  <span class="n">Cpu0</span><span class="o">::</span><span class="n">FP</span><span class="p">)</span>
      <span class="p">.</span><span class="n">Case</span><span class="p">(</span><span class="s">&quot;sw&quot;</span><span class="p">,</span>  <span class="n">Cpu0</span><span class="o">::</span><span class="n">SW</span><span class="p">)</span>
      <span class="p">.</span><span class="n">Case</span><span class="p">(</span><span class="s">&quot;sp&quot;</span><span class="p">,</span>  <span class="n">Cpu0</span><span class="o">::</span><span class="n">SP</span><span class="p">)</span>
      <span class="p">.</span><span class="n">Case</span><span class="p">(</span><span class="s">&quot;lr&quot;</span><span class="p">,</span>  <span class="n">Cpu0</span><span class="o">::</span><span class="n">LR</span><span class="p">)</span>
      <span class="p">.</span><span class="n">Case</span><span class="p">(</span><span class="s">&quot;pc&quot;</span><span class="p">,</span>  <span class="n">Cpu0</span><span class="o">::</span><span class="n">PC</span><span class="p">)</span>
      <span class="p">.</span><span class="n">Default</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">CC</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">CC</span><span class="p">;</span>

  <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">unsigned</span> <span class="n">Cpu0AsmParser</span><span class="o">::</span><span class="n">getReg</span><span class="p">(</span><span class="kt">int</span> <span class="n">RC</span><span class="p">,</span><span class="kt">int</span> <span class="n">RegNo</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="o">*</span><span class="p">(</span><span class="n">getContext</span><span class="p">().</span><span class="n">getRegisterInfo</span><span class="p">().</span><span class="n">getRegClass</span><span class="p">(</span><span class="n">RC</span><span class="p">).</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="n">RegNo</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">Cpu0AsmParser</span><span class="o">::</span><span class="n">matchRegisterByNumber</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">RegNum</span><span class="p">,</span> <span class="n">StringRef</span> <span class="n">Mnemonic</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">RegNum</span> <span class="o">&gt;</span> <span class="mi">15</span><span class="p">)</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">getReg</span><span class="p">(</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">CPURegsRegClassID</span><span class="p">,</span> <span class="n">RegNum</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">Cpu0AsmParser</span><span class="o">::</span><span class="n">tryParseRegister</span><span class="p">(</span><span class="n">StringRef</span> <span class="n">Mnemonic</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">const</span> <span class="n">AsmToken</span> <span class="o">&amp;</span><span class="n">Tok</span> <span class="o">=</span> <span class="n">Parser</span><span class="p">.</span><span class="n">getTok</span><span class="p">();</span>
  <span class="kt">int</span> <span class="n">RegNum</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">Tok</span><span class="p">.</span><span class="n">is</span><span class="p">(</span><span class="n">AsmToken</span><span class="o">::</span><span class="n">Identifier</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">lowerCase</span> <span class="o">=</span> <span class="n">Tok</span><span class="p">.</span><span class="n">getString</span><span class="p">().</span><span class="n">lower</span><span class="p">();</span>
    <span class="n">RegNum</span> <span class="o">=</span> <span class="n">matchRegisterName</span><span class="p">(</span><span class="n">lowerCase</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">Tok</span><span class="p">.</span><span class="n">is</span><span class="p">(</span><span class="n">AsmToken</span><span class="o">::</span><span class="n">Integer</span><span class="p">))</span>
    <span class="n">RegNum</span> <span class="o">=</span> <span class="n">matchRegisterByNumber</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Tok</span><span class="p">.</span><span class="n">getIntVal</span><span class="p">()),</span>
                                   <span class="n">Mnemonic</span><span class="p">.</span><span class="n">lower</span><span class="p">());</span>
    <span class="k">else</span>
      <span class="k">return</span> <span class="n">RegNum</span><span class="p">;</span>  <span class="c1">//error</span>
  <span class="k">return</span> <span class="n">RegNum</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">Cpu0AsmParser</span><span class="o">::</span>
  <span class="n">tryParseRegisterOperand</span><span class="p">(</span><span class="n">SmallVectorImpl</span><span class="o">&lt;</span><span class="n">MCParsedAsmOperand</span><span class="o">*&gt;</span> <span class="o">&amp;</span><span class="n">Operands</span><span class="p">,</span>
                          <span class="n">StringRef</span> <span class="n">Mnemonic</span><span class="p">){</span>

  <span class="n">SMLoc</span> <span class="n">S</span> <span class="o">=</span> <span class="n">Parser</span><span class="p">.</span><span class="n">getTok</span><span class="p">().</span><span class="n">getLoc</span><span class="p">();</span>
  <span class="kt">int</span> <span class="n">RegNo</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

    <span class="n">RegNo</span> <span class="o">=</span> <span class="n">tryParseRegister</span><span class="p">(</span><span class="n">Mnemonic</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">RegNo</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>

  <span class="n">Operands</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Cpu0Operand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">RegNo</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span>
      <span class="n">Parser</span><span class="p">.</span><span class="n">getTok</span><span class="p">().</span><span class="n">getLoc</span><span class="p">()));</span>
  <span class="n">Parser</span><span class="p">.</span><span class="n">Lex</span><span class="p">();</span> <span class="c1">// Eat register token.</span>
  <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">Cpu0AsmParser</span><span class="o">::</span><span class="n">ParseOperand</span><span class="p">(</span><span class="n">SmallVectorImpl</span><span class="o">&lt;</span><span class="n">MCParsedAsmOperand</span><span class="o">*&gt;&amp;</span><span class="n">Operands</span><span class="p">,</span>
                                 <span class="n">StringRef</span> <span class="n">Mnemonic</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Check if the current operand has a custom associated parser, if so, try to</span>
  <span class="c1">// custom parse the operand, or fallback to the general approach.</span>
  <span class="n">OperandMatchResultTy</span> <span class="n">ResTy</span> <span class="o">=</span> <span class="n">MatchOperandParserImpl</span><span class="p">(</span><span class="n">Operands</span><span class="p">,</span> <span class="n">Mnemonic</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">ResTy</span> <span class="o">==</span> <span class="n">MatchOperand_Success</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="c1">// If there wasn&#39;t a custom match, try the generic matcher below. Otherwise,</span>
  <span class="c1">// there was a match, but an error occurred, in which case, just return that</span>
  <span class="c1">// the operand parsing failed.</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">ResTy</span> <span class="o">==</span> <span class="n">MatchOperand_ParseFail</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>

  <span class="k">switch</span> <span class="p">(</span><span class="n">getLexer</span><span class="p">().</span><span class="n">getKind</span><span class="p">())</span> <span class="p">{</span>
  <span class="k">default</span><span class="o">:</span>
    <span class="n">Error</span><span class="p">(</span><span class="n">Parser</span><span class="p">.</span><span class="n">getTok</span><span class="p">().</span><span class="n">getLoc</span><span class="p">(),</span> <span class="s">&quot;unexpected token in operand&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="k">case</span> <span class="n">AsmToken</span><span class="o">::</span><span class="nl">Dollar:</span> <span class="p">{</span>
    <span class="c1">// parse register</span>
    <span class="n">SMLoc</span> <span class="n">S</span> <span class="o">=</span> <span class="n">Parser</span><span class="p">.</span><span class="n">getTok</span><span class="p">().</span><span class="n">getLoc</span><span class="p">();</span>
    <span class="n">Parser</span><span class="p">.</span><span class="n">Lex</span><span class="p">();</span> <span class="c1">// Eat dollar token.</span>
    <span class="c1">// parse register operand</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">tryParseRegisterOperand</span><span class="p">(</span><span class="n">Operands</span><span class="p">,</span> <span class="n">Mnemonic</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">getLexer</span><span class="p">().</span><span class="n">is</span><span class="p">(</span><span class="n">AsmToken</span><span class="o">::</span><span class="n">LParen</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// check if it is indexed addressing operand</span>
        <span class="n">Operands</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Cpu0Operand</span><span class="o">::</span><span class="n">CreateToken</span><span class="p">(</span><span class="s">&quot;(&quot;</span><span class="p">,</span> <span class="n">S</span><span class="p">));</span>
        <span class="n">Parser</span><span class="p">.</span><span class="n">Lex</span><span class="p">();</span> <span class="c1">// eat parenthesis</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">getLexer</span><span class="p">().</span><span class="n">isNot</span><span class="p">(</span><span class="n">AsmToken</span><span class="o">::</span><span class="n">Dollar</span><span class="p">))</span>
          <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>

        <span class="n">Parser</span><span class="p">.</span><span class="n">Lex</span><span class="p">();</span> <span class="c1">// eat dollar</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">tryParseRegisterOperand</span><span class="p">(</span><span class="n">Operands</span><span class="p">,</span> <span class="n">Mnemonic</span><span class="p">))</span>
          <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">getLexer</span><span class="p">().</span><span class="n">is</span><span class="p">(</span><span class="n">AsmToken</span><span class="o">::</span><span class="n">RParen</span><span class="p">))</span>
          <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>

        <span class="n">S</span> <span class="o">=</span> <span class="n">Parser</span><span class="p">.</span><span class="n">getTok</span><span class="p">().</span><span class="n">getLoc</span><span class="p">();</span>
        <span class="n">Operands</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Cpu0Operand</span><span class="o">::</span><span class="n">CreateToken</span><span class="p">(</span><span class="s">&quot;)&quot;</span><span class="p">,</span> <span class="n">S</span><span class="p">));</span>
        <span class="n">Parser</span><span class="p">.</span><span class="n">Lex</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// maybe it is a symbol reference</span>
    <span class="n">StringRef</span> <span class="n">Identifier</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Parser</span><span class="p">.</span><span class="n">parseIdentifier</span><span class="p">(</span><span class="n">Identifier</span><span class="p">))</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>

    <span class="n">SMLoc</span> <span class="n">E</span> <span class="o">=</span> <span class="n">SMLoc</span><span class="o">::</span><span class="n">getFromPointer</span><span class="p">(</span><span class="n">Parser</span><span class="p">.</span><span class="n">getTok</span><span class="p">().</span><span class="n">getLoc</span><span class="p">().</span><span class="n">getPointer</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>

    <span class="n">MCSymbol</span> <span class="o">*</span><span class="n">Sym</span> <span class="o">=</span> <span class="n">getContext</span><span class="p">().</span><span class="n">GetOrCreateSymbol</span><span class="p">(</span><span class="s">&quot;$&quot;</span> <span class="o">+</span> <span class="n">Identifier</span><span class="p">);</span>

    <span class="c1">// Otherwise create a symbol ref.</span>
    <span class="k">const</span> <span class="n">MCExpr</span> <span class="o">*</span><span class="n">Res</span> <span class="o">=</span> <span class="n">MCSymbolRefExpr</span><span class="o">::</span><span class="n">Create</span><span class="p">(</span><span class="n">Sym</span><span class="p">,</span> <span class="n">MCSymbolRefExpr</span><span class="o">::</span><span class="n">VK_None</span><span class="p">,</span>
                                                <span class="n">getContext</span><span class="p">());</span>

    <span class="n">Operands</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Cpu0Operand</span><span class="o">::</span><span class="n">CreateImm</span><span class="p">(</span><span class="n">Res</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="p">));</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">case</span> <span class="n">AsmToken</span><span class="o">::</span><span class="nl">Identifier:</span>
  <span class="k">case</span> <span class="n">AsmToken</span><span class="o">::</span><span class="nl">LParen:</span>
  <span class="k">case</span> <span class="n">AsmToken</span><span class="o">::</span><span class="nl">Minus:</span>
  <span class="k">case</span> <span class="n">AsmToken</span><span class="o">::</span><span class="nl">Plus:</span>
  <span class="k">case</span> <span class="n">AsmToken</span><span class="o">::</span><span class="nl">Integer:</span>
  <span class="k">case</span> <span class="n">AsmToken</span><span class="o">::</span><span class="nl">String:</span> <span class="p">{</span>
     <span class="c1">// quoted label names</span>
    <span class="k">const</span> <span class="n">MCExpr</span> <span class="o">*</span><span class="n">IdVal</span><span class="p">;</span>
    <span class="n">SMLoc</span> <span class="n">S</span> <span class="o">=</span> <span class="n">Parser</span><span class="p">.</span><span class="n">getTok</span><span class="p">().</span><span class="n">getLoc</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">getParser</span><span class="p">().</span><span class="n">parseExpression</span><span class="p">(</span><span class="n">IdVal</span><span class="p">))</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="n">SMLoc</span> <span class="n">E</span> <span class="o">=</span> <span class="n">SMLoc</span><span class="o">::</span><span class="n">getFromPointer</span><span class="p">(</span><span class="n">Parser</span><span class="p">.</span><span class="n">getTok</span><span class="p">().</span><span class="n">getLoc</span><span class="p">().</span><span class="n">getPointer</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">Operands</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Cpu0Operand</span><span class="o">::</span><span class="n">CreateImm</span><span class="p">(</span><span class="n">IdVal</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="p">));</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">case</span> <span class="n">AsmToken</span><span class="o">::</span><span class="nl">Percent:</span> <span class="p">{</span>
    <span class="c1">// it is a symbol reference or constant expression</span>
    <span class="k">const</span> <span class="n">MCExpr</span> <span class="o">*</span><span class="n">IdVal</span><span class="p">;</span>
    <span class="n">SMLoc</span> <span class="n">S</span> <span class="o">=</span> <span class="n">Parser</span><span class="p">.</span><span class="n">getTok</span><span class="p">().</span><span class="n">getLoc</span><span class="p">();</span> <span class="c1">// start location of the operand</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">parseRelocOperand</span><span class="p">(</span><span class="n">IdVal</span><span class="p">))</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>

    <span class="n">SMLoc</span> <span class="n">E</span> <span class="o">=</span> <span class="n">SMLoc</span><span class="o">::</span><span class="n">getFromPointer</span><span class="p">(</span><span class="n">Parser</span><span class="p">.</span><span class="n">getTok</span><span class="p">().</span><span class="n">getLoc</span><span class="p">().</span><span class="n">getPointer</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>

    <span class="n">Operands</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Cpu0Operand</span><span class="o">::</span><span class="n">CreateImm</span><span class="p">(</span><span class="n">IdVal</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="p">));</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span> <span class="c1">// case AsmToken::Percent</span>
  <span class="p">}</span> <span class="c1">// switch(getLexer().getKind())</span>
  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">Cpu0AsmParser</span><span class="o">::</span><span class="n">parseRelocOperand</span><span class="p">(</span><span class="k">const</span> <span class="n">MCExpr</span> <span class="o">*&amp;</span><span class="n">Res</span><span class="p">)</span> <span class="p">{</span>

  <span class="n">Parser</span><span class="p">.</span><span class="n">Lex</span><span class="p">();</span> <span class="c1">// eat % token</span>
  <span class="k">const</span> <span class="n">AsmToken</span> <span class="o">&amp;</span><span class="n">Tok</span> <span class="o">=</span> <span class="n">Parser</span><span class="p">.</span><span class="n">getTok</span><span class="p">();</span> <span class="c1">// get next token, operation</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Tok</span><span class="p">.</span><span class="n">isNot</span><span class="p">(</span><span class="n">AsmToken</span><span class="o">::</span><span class="n">Identifier</span><span class="p">))</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>

  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">Str</span> <span class="o">=</span> <span class="n">Tok</span><span class="p">.</span><span class="n">getIdentifier</span><span class="p">().</span><span class="n">str</span><span class="p">();</span>

  <span class="n">Parser</span><span class="p">.</span><span class="n">Lex</span><span class="p">();</span> <span class="c1">// eat identifier</span>
  <span class="c1">// now make expression from the rest of the operand</span>
  <span class="k">const</span> <span class="n">MCExpr</span> <span class="o">*</span><span class="n">IdVal</span><span class="p">;</span>
  <span class="n">SMLoc</span> <span class="n">EndLoc</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">getLexer</span><span class="p">().</span><span class="n">getKind</span><span class="p">()</span> <span class="o">==</span> <span class="n">AsmToken</span><span class="o">::</span><span class="n">LParen</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Parser</span><span class="p">.</span><span class="n">Lex</span><span class="p">();</span> <span class="c1">// eat &#39;(&#39; token</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">getLexer</span><span class="p">().</span><span class="n">getKind</span><span class="p">()</span> <span class="o">==</span> <span class="n">AsmToken</span><span class="o">::</span><span class="n">Percent</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Parser</span><span class="p">.</span><span class="n">Lex</span><span class="p">();</span> <span class="c1">// eat % token</span>
        <span class="k">const</span> <span class="n">AsmToken</span> <span class="o">&amp;</span><span class="n">nextTok</span> <span class="o">=</span> <span class="n">Parser</span><span class="p">.</span><span class="n">getTok</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">nextTok</span><span class="p">.</span><span class="n">isNot</span><span class="p">(</span><span class="n">AsmToken</span><span class="o">::</span><span class="n">Identifier</span><span class="p">))</span>
          <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="n">Str</span> <span class="o">+=</span> <span class="s">&quot;(%&quot;</span><span class="p">;</span>
        <span class="n">Str</span> <span class="o">+=</span> <span class="n">nextTok</span><span class="p">.</span><span class="n">getIdentifier</span><span class="p">();</span>
        <span class="n">Parser</span><span class="p">.</span><span class="n">Lex</span><span class="p">();</span> <span class="c1">// eat identifier</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">getLexer</span><span class="p">().</span><span class="n">getKind</span><span class="p">()</span> <span class="o">!=</span> <span class="n">AsmToken</span><span class="o">::</span><span class="n">LParen</span><span class="p">)</span>
          <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">getParser</span><span class="p">().</span><span class="n">parseParenExpression</span><span class="p">(</span><span class="n">IdVal</span><span class="p">,</span><span class="n">EndLoc</span><span class="p">))</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">getLexer</span><span class="p">().</span><span class="n">getKind</span><span class="p">()</span> <span class="o">==</span> <span class="n">AsmToken</span><span class="o">::</span><span class="n">RParen</span><span class="p">)</span>
      <span class="n">Parser</span><span class="p">.</span><span class="n">Lex</span><span class="p">();</span> <span class="c1">// eat &#39;)&#39; token</span>

  <span class="p">}</span> <span class="k">else</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span> <span class="c1">// parenthesis must follow reloc operand</span>

  <span class="c1">// Check the type of the expression</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">const</span> <span class="n">MCConstantExpr</span> <span class="o">*</span><span class="n">MCE</span> <span class="o">=</span> <span class="n">dyn_cast</span><span class="o">&lt;</span><span class="n">MCConstantExpr</span><span class="o">&gt;</span><span class="p">(</span><span class="n">IdVal</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// it&#39;s a constant, evaluate lo or hi value</span>
    <span class="kt">int</span> <span class="n">Val</span> <span class="o">=</span> <span class="n">MCE</span><span class="o">-&gt;</span><span class="n">getValue</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Str</span> <span class="o">==</span> <span class="s">&quot;lo&quot;</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Val</span> <span class="o">=</span> <span class="n">Val</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">Str</span> <span class="o">==</span> <span class="s">&quot;hi&quot;</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Val</span> <span class="o">=</span> <span class="p">(</span><span class="n">Val</span> <span class="o">&amp;</span> <span class="mh">0xffff0000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">Res</span> <span class="o">=</span> <span class="n">MCConstantExpr</span><span class="o">::</span><span class="n">Create</span><span class="p">(</span><span class="n">Val</span><span class="p">,</span> <span class="n">getContext</span><span class="p">());</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">const</span> <span class="n">MCSymbolRefExpr</span> <span class="o">*</span><span class="n">MSRE</span> <span class="o">=</span> <span class="n">dyn_cast</span><span class="o">&lt;</span><span class="n">MCSymbolRefExpr</span><span class="o">&gt;</span><span class="p">(</span><span class="n">IdVal</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// it&#39;s a symbol, create symbolic expression from symbol</span>
    <span class="n">StringRef</span> <span class="n">Symbol</span> <span class="o">=</span> <span class="n">MSRE</span><span class="o">-&gt;</span><span class="n">getSymbol</span><span class="p">().</span><span class="n">getName</span><span class="p">();</span>
    <span class="n">MCSymbolRefExpr</span><span class="o">::</span><span class="n">VariantKind</span> <span class="n">VK</span> <span class="o">=</span> <span class="n">getVariantKind</span><span class="p">(</span><span class="n">Str</span><span class="p">);</span>
    <span class="n">Res</span> <span class="o">=</span> <span class="n">MCSymbolRefExpr</span><span class="o">::</span><span class="n">Create</span><span class="p">(</span><span class="n">Symbol</span><span class="p">,</span><span class="n">VK</span><span class="p">,</span><span class="n">getContext</span><span class="p">());</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">Cpu0AsmParser</span><span class="o">::</span><span class="n">ParseRegister</span><span class="p">(</span><span class="kt">unsigned</span> <span class="o">&amp;</span><span class="n">RegNo</span><span class="p">,</span> <span class="n">SMLoc</span> <span class="o">&amp;</span><span class="n">StartLoc</span><span class="p">,</span>
                                  <span class="n">SMLoc</span> <span class="o">&amp;</span><span class="n">EndLoc</span><span class="p">)</span> <span class="p">{</span>

  <span class="n">StartLoc</span> <span class="o">=</span> <span class="n">Parser</span><span class="p">.</span><span class="n">getTok</span><span class="p">().</span><span class="n">getLoc</span><span class="p">();</span>
  <span class="n">RegNo</span> <span class="o">=</span> <span class="n">tryParseRegister</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
  <span class="n">EndLoc</span> <span class="o">=</span> <span class="n">Parser</span><span class="p">.</span><span class="n">getTok</span><span class="p">().</span><span class="n">getLoc</span><span class="p">();</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">RegNo</span> <span class="o">==</span> <span class="p">(</span><span class="kt">unsigned</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">Cpu0AsmParser</span><span class="o">::</span><span class="n">parseMemOffset</span><span class="p">(</span><span class="k">const</span> <span class="n">MCExpr</span> <span class="o">*&amp;</span><span class="n">Res</span><span class="p">)</span> <span class="p">{</span>

  <span class="n">SMLoc</span> <span class="n">S</span><span class="p">;</span>

  <span class="k">switch</span><span class="p">(</span><span class="n">getLexer</span><span class="p">().</span><span class="n">getKind</span><span class="p">())</span> <span class="p">{</span>
  <span class="k">default</span><span class="o">:</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="k">case</span> <span class="n">AsmToken</span><span class="o">::</span><span class="nl">Integer:</span>
  <span class="k">case</span> <span class="n">AsmToken</span><span class="o">::</span><span class="nl">Minus:</span>
  <span class="k">case</span> <span class="n">AsmToken</span><span class="o">::</span><span class="nl">Plus:</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">getParser</span><span class="p">().</span><span class="n">parseExpression</span><span class="p">(</span><span class="n">Res</span><span class="p">));</span>
  <span class="k">case</span> <span class="n">AsmToken</span><span class="o">::</span><span class="nl">Percent:</span>
    <span class="k">return</span> <span class="n">parseRelocOperand</span><span class="p">(</span><span class="n">Res</span><span class="p">);</span>
  <span class="k">case</span> <span class="n">AsmToken</span><span class="o">::</span><span class="nl">LParen:</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>  <span class="c1">// it&#39;s probably assuming 0</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// eg, 12($sp) or 12(la)</span>
<span class="n">Cpu0AsmParser</span><span class="o">::</span><span class="n">OperandMatchResultTy</span> <span class="n">Cpu0AsmParser</span><span class="o">::</span><span class="n">parseMemOperand</span><span class="p">(</span>
               <span class="n">SmallVectorImpl</span><span class="o">&lt;</span><span class="n">MCParsedAsmOperand</span><span class="o">*&gt;&amp;</span><span class="n">Operands</span><span class="p">)</span> <span class="p">{</span>

  <span class="k">const</span> <span class="n">MCExpr</span> <span class="o">*</span><span class="n">IdVal</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">SMLoc</span> <span class="n">S</span><span class="p">;</span>
  <span class="c1">// first operand is the offset</span>
  <span class="n">S</span> <span class="o">=</span> <span class="n">Parser</span><span class="p">.</span><span class="n">getTok</span><span class="p">().</span><span class="n">getLoc</span><span class="p">();</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">parseMemOffset</span><span class="p">(</span><span class="n">IdVal</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">MatchOperand_ParseFail</span><span class="p">;</span>

  <span class="k">const</span> <span class="n">AsmToken</span> <span class="o">&amp;</span><span class="n">Tok</span> <span class="o">=</span> <span class="n">Parser</span><span class="p">.</span><span class="n">getTok</span><span class="p">();</span> <span class="c1">// get next token</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Tok</span><span class="p">.</span><span class="n">isNot</span><span class="p">(</span><span class="n">AsmToken</span><span class="o">::</span><span class="n">LParen</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">Cpu0Operand</span> <span class="o">*</span><span class="n">Mnemonic</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">Cpu0Operand</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">Operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Mnemonic</span><span class="o">-&gt;</span><span class="n">getToken</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;la&quot;</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">SMLoc</span> <span class="n">E</span> <span class="o">=</span> <span class="n">SMLoc</span><span class="o">::</span><span class="n">getFromPointer</span><span class="p">(</span><span class="n">Parser</span><span class="p">.</span><span class="n">getTok</span><span class="p">().</span><span class="n">getLoc</span><span class="p">().</span><span class="n">getPointer</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
      <span class="n">Operands</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Cpu0Operand</span><span class="o">::</span><span class="n">CreateImm</span><span class="p">(</span><span class="n">IdVal</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="p">));</span>
      <span class="k">return</span> <span class="n">MatchOperand_Success</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">Error</span><span class="p">(</span><span class="n">Parser</span><span class="p">.</span><span class="n">getTok</span><span class="p">().</span><span class="n">getLoc</span><span class="p">(),</span> <span class="s">&quot;&#39;(&#39; expected&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">MatchOperand_ParseFail</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">Parser</span><span class="p">.</span><span class="n">Lex</span><span class="p">();</span> <span class="c1">// Eat &#39;(&#39; token.</span>

  <span class="k">const</span> <span class="n">AsmToken</span> <span class="o">&amp;</span><span class="n">Tok1</span> <span class="o">=</span> <span class="n">Parser</span><span class="p">.</span><span class="n">getTok</span><span class="p">();</span> <span class="c1">// get next token</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Tok1</span><span class="p">.</span><span class="n">is</span><span class="p">(</span><span class="n">AsmToken</span><span class="o">::</span><span class="n">Dollar</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">Parser</span><span class="p">.</span><span class="n">Lex</span><span class="p">();</span> <span class="c1">// Eat &#39;$&#39; token.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tryParseRegisterOperand</span><span class="p">(</span><span class="n">Operands</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">Error</span><span class="p">(</span><span class="n">Parser</span><span class="p">.</span><span class="n">getTok</span><span class="p">().</span><span class="n">getLoc</span><span class="p">(),</span> <span class="s">&quot;unexpected token in operand&quot;</span><span class="p">);</span>
      <span class="k">return</span> <span class="n">MatchOperand_ParseFail</span><span class="p">;</span>
    <span class="p">}</span>

  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">Error</span><span class="p">(</span><span class="n">Parser</span><span class="p">.</span><span class="n">getTok</span><span class="p">().</span><span class="n">getLoc</span><span class="p">(),</span> <span class="s">&quot;unexpected token in operand&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">MatchOperand_ParseFail</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">const</span> <span class="n">AsmToken</span> <span class="o">&amp;</span><span class="n">Tok2</span> <span class="o">=</span> <span class="n">Parser</span><span class="p">.</span><span class="n">getTok</span><span class="p">();</span> <span class="c1">// get next token</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Tok2</span><span class="p">.</span><span class="n">isNot</span><span class="p">(</span><span class="n">AsmToken</span><span class="o">::</span><span class="n">RParen</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">Error</span><span class="p">(</span><span class="n">Parser</span><span class="p">.</span><span class="n">getTok</span><span class="p">().</span><span class="n">getLoc</span><span class="p">(),</span> <span class="s">&quot;&#39;)&#39; expected&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">MatchOperand_ParseFail</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">SMLoc</span> <span class="n">E</span> <span class="o">=</span> <span class="n">SMLoc</span><span class="o">::</span><span class="n">getFromPointer</span><span class="p">(</span><span class="n">Parser</span><span class="p">.</span><span class="n">getTok</span><span class="p">().</span><span class="n">getLoc</span><span class="p">().</span><span class="n">getPointer</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>

  <span class="n">Parser</span><span class="p">.</span><span class="n">Lex</span><span class="p">();</span> <span class="c1">// Eat &#39;)&#39; token.</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">IdVal</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">IdVal</span> <span class="o">=</span> <span class="n">MCConstantExpr</span><span class="o">::</span><span class="n">Create</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">getContext</span><span class="p">());</span>

  <span class="c1">// now replace register operand with the mem operand</span>
  <span class="n">Cpu0Operand</span><span class="o">*</span> <span class="n">op</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">Cpu0Operand</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">Operands</span><span class="p">.</span><span class="n">back</span><span class="p">());</span>
  <span class="kt">int</span> <span class="n">RegNo</span> <span class="o">=</span> <span class="n">op</span><span class="o">-&gt;</span><span class="n">getReg</span><span class="p">();</span>
  <span class="c1">// remove register from operands</span>
  <span class="n">Operands</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
  <span class="c1">// and add memory operand</span>
  <span class="n">Operands</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Cpu0Operand</span><span class="o">::</span><span class="n">CreateMem</span><span class="p">(</span><span class="n">RegNo</span><span class="p">,</span> <span class="n">IdVal</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="p">));</span>
  <span class="k">delete</span> <span class="n">op</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">MatchOperand_Success</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">MCSymbolRefExpr</span><span class="o">::</span><span class="n">VariantKind</span> <span class="n">Cpu0AsmParser</span><span class="o">::</span><span class="n">getVariantKind</span><span class="p">(</span><span class="n">StringRef</span> <span class="n">Symbol</span><span class="p">)</span> <span class="p">{</span>

  <span class="n">MCSymbolRefExpr</span><span class="o">::</span><span class="n">VariantKind</span> <span class="n">VK</span>
                   <span class="o">=</span> <span class="n">StringSwitch</span><span class="o">&lt;</span><span class="n">MCSymbolRefExpr</span><span class="o">::</span><span class="n">VariantKind</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Symbol</span><span class="p">)</span>
    <span class="p">.</span><span class="n">Case</span><span class="p">(</span><span class="s">&quot;hi&quot;</span><span class="p">,</span>          <span class="n">MCSymbolRefExpr</span><span class="o">::</span><span class="n">VK_Cpu0_ABS_HI</span><span class="p">)</span>
    <span class="p">.</span><span class="n">Case</span><span class="p">(</span><span class="s">&quot;lo&quot;</span><span class="p">,</span>          <span class="n">MCSymbolRefExpr</span><span class="o">::</span><span class="n">VK_Cpu0_ABS_LO</span><span class="p">)</span>
    <span class="p">.</span><span class="n">Case</span><span class="p">(</span><span class="s">&quot;gp_rel&quot;</span><span class="p">,</span>      <span class="n">MCSymbolRefExpr</span><span class="o">::</span><span class="n">VK_Cpu0_GPREL</span><span class="p">)</span>
    <span class="p">.</span><span class="n">Case</span><span class="p">(</span><span class="s">&quot;call24&quot;</span><span class="p">,</span>      <span class="n">MCSymbolRefExpr</span><span class="o">::</span><span class="n">VK_Cpu0_GOT_CALL</span><span class="p">)</span>
    <span class="p">.</span><span class="n">Case</span><span class="p">(</span><span class="s">&quot;got&quot;</span><span class="p">,</span>         <span class="n">MCSymbolRefExpr</span><span class="o">::</span><span class="n">VK_Cpu0_GOT</span><span class="p">)</span>
    <span class="p">.</span><span class="n">Case</span><span class="p">(</span><span class="s">&quot;tlsgd&quot;</span><span class="p">,</span>       <span class="n">MCSymbolRefExpr</span><span class="o">::</span><span class="n">VK_Cpu0_TLSGD</span><span class="p">)</span>
    <span class="p">.</span><span class="n">Case</span><span class="p">(</span><span class="s">&quot;tlsldm&quot;</span><span class="p">,</span>      <span class="n">MCSymbolRefExpr</span><span class="o">::</span><span class="n">VK_Cpu0_TLSLDM</span><span class="p">)</span>
    <span class="p">.</span><span class="n">Case</span><span class="p">(</span><span class="s">&quot;dtprel_hi&quot;</span><span class="p">,</span>   <span class="n">MCSymbolRefExpr</span><span class="o">::</span><span class="n">VK_Cpu0_DTPREL_HI</span><span class="p">)</span>
    <span class="p">.</span><span class="n">Case</span><span class="p">(</span><span class="s">&quot;dtprel_lo&quot;</span><span class="p">,</span>   <span class="n">MCSymbolRefExpr</span><span class="o">::</span><span class="n">VK_Cpu0_DTPREL_LO</span><span class="p">)</span>
    <span class="p">.</span><span class="n">Case</span><span class="p">(</span><span class="s">&quot;gottprel&quot;</span><span class="p">,</span>    <span class="n">MCSymbolRefExpr</span><span class="o">::</span><span class="n">VK_Cpu0_GOTTPREL</span><span class="p">)</span>
    <span class="p">.</span><span class="n">Case</span><span class="p">(</span><span class="s">&quot;tprel_hi&quot;</span><span class="p">,</span>    <span class="n">MCSymbolRefExpr</span><span class="o">::</span><span class="n">VK_Cpu0_TPREL_HI</span><span class="p">)</span>
    <span class="p">.</span><span class="n">Case</span><span class="p">(</span><span class="s">&quot;tprel_lo&quot;</span><span class="p">,</span>    <span class="n">MCSymbolRefExpr</span><span class="o">::</span><span class="n">VK_Cpu0_TPREL_LO</span><span class="p">)</span>
    <span class="p">.</span><span class="n">Case</span><span class="p">(</span><span class="s">&quot;got_disp&quot;</span><span class="p">,</span>    <span class="n">MCSymbolRefExpr</span><span class="o">::</span><span class="n">VK_Cpu0_GOT_DISP</span><span class="p">)</span>
    <span class="p">.</span><span class="n">Case</span><span class="p">(</span><span class="s">&quot;got_page&quot;</span><span class="p">,</span>    <span class="n">MCSymbolRefExpr</span><span class="o">::</span><span class="n">VK_Cpu0_GOT_PAGE</span><span class="p">)</span>
    <span class="p">.</span><span class="n">Case</span><span class="p">(</span><span class="s">&quot;got_ofst&quot;</span><span class="p">,</span>    <span class="n">MCSymbolRefExpr</span><span class="o">::</span><span class="n">VK_Cpu0_GOT_OFST</span><span class="p">)</span>
    <span class="p">.</span><span class="n">Case</span><span class="p">(</span><span class="s">&quot;hi(%neg(%gp_rel&quot;</span><span class="p">,</span>    <span class="n">MCSymbolRefExpr</span><span class="o">::</span><span class="n">VK_Cpu0_GPOFF_HI</span><span class="p">)</span>
    <span class="p">.</span><span class="n">Case</span><span class="p">(</span><span class="s">&quot;lo(%neg(%gp_rel&quot;</span><span class="p">,</span>    <span class="n">MCSymbolRefExpr</span><span class="o">::</span><span class="n">VK_Cpu0_GPOFF_LO</span><span class="p">)</span>
    <span class="p">.</span><span class="n">Default</span><span class="p">(</span><span class="n">MCSymbolRefExpr</span><span class="o">::</span><span class="n">VK_None</span><span class="p">);</span>

  <span class="k">return</span> <span class="n">VK</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">Cpu0AsmParser</span><span class="o">::</span>
<span class="n">parseMathOperation</span><span class="p">(</span><span class="n">StringRef</span> <span class="n">Name</span><span class="p">,</span> <span class="n">SMLoc</span> <span class="n">NameLoc</span><span class="p">,</span>
                   <span class="n">SmallVectorImpl</span><span class="o">&lt;</span><span class="n">MCParsedAsmOperand</span><span class="o">*&gt;</span> <span class="o">&amp;</span><span class="n">Operands</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// split the format</span>
  <span class="n">size_t</span> <span class="n">Start</span> <span class="o">=</span> <span class="n">Name</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="sc">&#39;.&#39;</span><span class="p">),</span> <span class="n">Next</span> <span class="o">=</span> <span class="n">Name</span><span class="p">.</span><span class="n">rfind</span><span class="p">(</span><span class="sc">&#39;.&#39;</span><span class="p">);</span>
  <span class="n">StringRef</span> <span class="n">Format1</span> <span class="o">=</span> <span class="n">Name</span><span class="p">.</span><span class="n">slice</span><span class="p">(</span><span class="n">Start</span><span class="p">,</span> <span class="n">Next</span><span class="p">);</span>
  <span class="c1">// and add the first format to the operands</span>
  <span class="n">Operands</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Cpu0Operand</span><span class="o">::</span><span class="n">CreateToken</span><span class="p">(</span><span class="n">Format1</span><span class="p">,</span> <span class="n">NameLoc</span><span class="p">));</span>
  <span class="c1">// now for the second format</span>
  <span class="n">StringRef</span> <span class="n">Format2</span> <span class="o">=</span> <span class="n">Name</span><span class="p">.</span><span class="n">slice</span><span class="p">(</span><span class="n">Next</span><span class="p">,</span> <span class="n">StringRef</span><span class="o">::</span><span class="n">npos</span><span class="p">);</span>
  <span class="n">Operands</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Cpu0Operand</span><span class="o">::</span><span class="n">CreateToken</span><span class="p">(</span><span class="n">Format2</span><span class="p">,</span> <span class="n">NameLoc</span><span class="p">));</span>

  <span class="c1">// set the format for the first register</span>
<span class="c1">//  setFpFormat(Format1);</span>

  <span class="c1">// Read the remaining operands.</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">getLexer</span><span class="p">().</span><span class="n">isNot</span><span class="p">(</span><span class="n">AsmToken</span><span class="o">::</span><span class="n">EndOfStatement</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// Read the first operand.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ParseOperand</span><span class="p">(</span><span class="n">Operands</span><span class="p">,</span> <span class="n">Name</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">SMLoc</span> <span class="n">Loc</span> <span class="o">=</span> <span class="n">getLexer</span><span class="p">().</span><span class="n">getLoc</span><span class="p">();</span>
      <span class="n">Parser</span><span class="p">.</span><span class="n">eatToEndOfStatement</span><span class="p">();</span>
      <span class="k">return</span> <span class="n">Error</span><span class="p">(</span><span class="n">Loc</span><span class="p">,</span> <span class="s">&quot;unexpected token in argument list&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">getLexer</span><span class="p">().</span><span class="n">isNot</span><span class="p">(</span><span class="n">AsmToken</span><span class="o">::</span><span class="n">Comma</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">SMLoc</span> <span class="n">Loc</span> <span class="o">=</span> <span class="n">getLexer</span><span class="p">().</span><span class="n">getLoc</span><span class="p">();</span>
      <span class="n">Parser</span><span class="p">.</span><span class="n">eatToEndOfStatement</span><span class="p">();</span>
      <span class="k">return</span> <span class="n">Error</span><span class="p">(</span><span class="n">Loc</span><span class="p">,</span> <span class="s">&quot;unexpected token in argument list&quot;</span><span class="p">);</span>

    <span class="p">}</span>
    <span class="n">Parser</span><span class="p">.</span><span class="n">Lex</span><span class="p">();</span>  <span class="c1">// Eat the comma.</span>

    <span class="c1">// Parse and remember the operand.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ParseOperand</span><span class="p">(</span><span class="n">Operands</span><span class="p">,</span> <span class="n">Name</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">SMLoc</span> <span class="n">Loc</span> <span class="o">=</span> <span class="n">getLexer</span><span class="p">().</span><span class="n">getLoc</span><span class="p">();</span>
      <span class="n">Parser</span><span class="p">.</span><span class="n">eatToEndOfStatement</span><span class="p">();</span>
      <span class="k">return</span> <span class="n">Error</span><span class="p">(</span><span class="n">Loc</span><span class="p">,</span> <span class="s">&quot;unexpected token in argument list&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">getLexer</span><span class="p">().</span><span class="n">isNot</span><span class="p">(</span><span class="n">AsmToken</span><span class="o">::</span><span class="n">EndOfStatement</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">SMLoc</span> <span class="n">Loc</span> <span class="o">=</span> <span class="n">getLexer</span><span class="p">().</span><span class="n">getLoc</span><span class="p">();</span>
    <span class="n">Parser</span><span class="p">.</span><span class="n">eatToEndOfStatement</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">Error</span><span class="p">(</span><span class="n">Loc</span><span class="p">,</span> <span class="s">&quot;unexpected token in argument list&quot;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">Parser</span><span class="p">.</span><span class="n">Lex</span><span class="p">();</span> <span class="c1">// Consume the EndOfStatement</span>
  <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">Cpu0AsmParser</span><span class="o">::</span>
<span class="n">ParseInstruction</span><span class="p">(</span><span class="n">ParseInstructionInfo</span> <span class="o">&amp;</span><span class="n">Info</span><span class="p">,</span> <span class="n">StringRef</span> <span class="n">Name</span><span class="p">,</span> <span class="n">SMLoc</span> <span class="n">NameLoc</span><span class="p">,</span>
                 <span class="n">SmallVectorImpl</span><span class="o">&lt;</span><span class="n">MCParsedAsmOperand</span><span class="o">*&gt;</span> <span class="o">&amp;</span><span class="n">Operands</span><span class="p">)</span> <span class="p">{</span>

  <span class="c1">// Create the leading tokens for the mnemonic, split by &#39;.&#39; characters.</span>
  <span class="n">size_t</span> <span class="n">Start</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Next</span> <span class="o">=</span> <span class="n">Name</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="sc">&#39;.&#39;</span><span class="p">);</span>
  <span class="n">StringRef</span> <span class="n">Mnemonic</span> <span class="o">=</span> <span class="n">Name</span><span class="p">.</span><span class="n">slice</span><span class="p">(</span><span class="n">Start</span><span class="p">,</span> <span class="n">Next</span><span class="p">);</span>

  <span class="n">Operands</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Cpu0Operand</span><span class="o">::</span><span class="n">CreateToken</span><span class="p">(</span><span class="n">Mnemonic</span><span class="p">,</span> <span class="n">NameLoc</span><span class="p">));</span>

  <span class="c1">// Read the remaining operands.</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">getLexer</span><span class="p">().</span><span class="n">isNot</span><span class="p">(</span><span class="n">AsmToken</span><span class="o">::</span><span class="n">EndOfStatement</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// Read the first operand.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ParseOperand</span><span class="p">(</span><span class="n">Operands</span><span class="p">,</span> <span class="n">Name</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">SMLoc</span> <span class="n">Loc</span> <span class="o">=</span> <span class="n">getLexer</span><span class="p">().</span><span class="n">getLoc</span><span class="p">();</span>
      <span class="n">Parser</span><span class="p">.</span><span class="n">eatToEndOfStatement</span><span class="p">();</span>
      <span class="k">return</span> <span class="n">Error</span><span class="p">(</span><span class="n">Loc</span><span class="p">,</span> <span class="s">&quot;unexpected token in argument list&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">getLexer</span><span class="p">().</span><span class="n">is</span><span class="p">(</span><span class="n">AsmToken</span><span class="o">::</span><span class="n">Comma</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
      <span class="n">Parser</span><span class="p">.</span><span class="n">Lex</span><span class="p">();</span>  <span class="c1">// Eat the comma.</span>

      <span class="c1">// Parse and remember the operand.</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">ParseOperand</span><span class="p">(</span><span class="n">Operands</span><span class="p">,</span> <span class="n">Name</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">SMLoc</span> <span class="n">Loc</span> <span class="o">=</span> <span class="n">getLexer</span><span class="p">().</span><span class="n">getLoc</span><span class="p">();</span>
        <span class="n">Parser</span><span class="p">.</span><span class="n">eatToEndOfStatement</span><span class="p">();</span>
        <span class="k">return</span> <span class="n">Error</span><span class="p">(</span><span class="n">Loc</span><span class="p">,</span> <span class="s">&quot;unexpected token in argument list&quot;</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">getLexer</span><span class="p">().</span><span class="n">isNot</span><span class="p">(</span><span class="n">AsmToken</span><span class="o">::</span><span class="n">EndOfStatement</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">SMLoc</span> <span class="n">Loc</span> <span class="o">=</span> <span class="n">getLexer</span><span class="p">().</span><span class="n">getLoc</span><span class="p">();</span>
    <span class="n">Parser</span><span class="p">.</span><span class="n">eatToEndOfStatement</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">Error</span><span class="p">(</span><span class="n">Loc</span><span class="p">,</span> <span class="s">&quot;unexpected token in argument list&quot;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">Parser</span><span class="p">.</span><span class="n">Lex</span><span class="p">();</span> <span class="c1">// Consume the EndOfStatement</span>
  <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">Cpu0AsmParser</span><span class="o">::</span><span class="n">reportParseError</span><span class="p">(</span><span class="n">StringRef</span> <span class="n">ErrorMsg</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">SMLoc</span> <span class="n">Loc</span> <span class="o">=</span> <span class="n">getLexer</span><span class="p">().</span><span class="n">getLoc</span><span class="p">();</span>
   <span class="n">Parser</span><span class="p">.</span><span class="n">eatToEndOfStatement</span><span class="p">();</span>
   <span class="k">return</span> <span class="n">Error</span><span class="p">(</span><span class="n">Loc</span><span class="p">,</span> <span class="n">ErrorMsg</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">Cpu0AsmParser</span><span class="o">::</span><span class="n">parseSetReorderDirective</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Parser</span><span class="p">.</span><span class="n">Lex</span><span class="p">();</span>
  <span class="c1">// if this is not the end of the statement, report error</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">getLexer</span><span class="p">().</span><span class="n">isNot</span><span class="p">(</span><span class="n">AsmToken</span><span class="o">::</span><span class="n">EndOfStatement</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">reportParseError</span><span class="p">(</span><span class="s">&quot;unexpected token in statement&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">Options</span><span class="p">.</span><span class="n">setReorder</span><span class="p">();</span>
  <span class="n">Parser</span><span class="p">.</span><span class="n">Lex</span><span class="p">();</span> <span class="c1">// Consume the EndOfStatement</span>
  <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">Cpu0AsmParser</span><span class="o">::</span><span class="n">parseSetNoReorderDirective</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">Parser</span><span class="p">.</span><span class="n">Lex</span><span class="p">();</span>
    <span class="c1">// if this is not the end of the statement, report error</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">getLexer</span><span class="p">().</span><span class="n">isNot</span><span class="p">(</span><span class="n">AsmToken</span><span class="o">::</span><span class="n">EndOfStatement</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">reportParseError</span><span class="p">(</span><span class="s">&quot;unexpected token in statement&quot;</span><span class="p">);</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">Options</span><span class="p">.</span><span class="n">setNoreorder</span><span class="p">();</span>
    <span class="n">Parser</span><span class="p">.</span><span class="n">Lex</span><span class="p">();</span> <span class="c1">// Consume the EndOfStatement</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">Cpu0AsmParser</span><span class="o">::</span><span class="n">parseSetMacroDirective</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Parser</span><span class="p">.</span><span class="n">Lex</span><span class="p">();</span>
  <span class="c1">// if this is not the end of the statement, report error</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">getLexer</span><span class="p">().</span><span class="n">isNot</span><span class="p">(</span><span class="n">AsmToken</span><span class="o">::</span><span class="n">EndOfStatement</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">reportParseError</span><span class="p">(</span><span class="s">&quot;unexpected token in statement&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">Options</span><span class="p">.</span><span class="n">setMacro</span><span class="p">();</span>
  <span class="n">Parser</span><span class="p">.</span><span class="n">Lex</span><span class="p">();</span> <span class="c1">// Consume the EndOfStatement</span>
  <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">Cpu0AsmParser</span><span class="o">::</span><span class="n">parseSetNoMacroDirective</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Parser</span><span class="p">.</span><span class="n">Lex</span><span class="p">();</span>
  <span class="c1">// if this is not the end of the statement, report error</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">getLexer</span><span class="p">().</span><span class="n">isNot</span><span class="p">(</span><span class="n">AsmToken</span><span class="o">::</span><span class="n">EndOfStatement</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">reportParseError</span><span class="p">(</span><span class="s">&quot;`noreorder&#39; must be set before `nomacro&#39;&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Options</span><span class="p">.</span><span class="n">isReorder</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">reportParseError</span><span class="p">(</span><span class="s">&quot;`noreorder&#39; must be set before `nomacro&#39;&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">Options</span><span class="p">.</span><span class="n">setNomacro</span><span class="p">();</span>
  <span class="n">Parser</span><span class="p">.</span><span class="n">Lex</span><span class="p">();</span> <span class="c1">// Consume the EndOfStatement</span>
  <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">bool</span> <span class="n">Cpu0AsmParser</span><span class="o">::</span><span class="n">parseDirectiveSet</span><span class="p">()</span> <span class="p">{</span>

  <span class="c1">// get next token</span>
  <span class="k">const</span> <span class="n">AsmToken</span> <span class="o">&amp;</span><span class="n">Tok</span> <span class="o">=</span> <span class="n">Parser</span><span class="p">.</span><span class="n">getTok</span><span class="p">();</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">Tok</span><span class="p">.</span><span class="n">getString</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;reorder&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">parseSetReorderDirective</span><span class="p">();</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">Tok</span><span class="p">.</span><span class="n">getString</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;noreorder&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">parseSetNoReorderDirective</span><span class="p">();</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">Tok</span><span class="p">.</span><span class="n">getString</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;macro&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">parseSetMacroDirective</span><span class="p">();</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">Tok</span><span class="p">.</span><span class="n">getString</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;nomacro&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">parseSetNoMacroDirective</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">Cpu0AsmParser</span><span class="o">::</span><span class="n">ParseDirective</span><span class="p">(</span><span class="n">AsmToken</span> <span class="n">DirectiveID</span><span class="p">)</span> <span class="p">{</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">DirectiveID</span><span class="p">.</span><span class="n">getString</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;.ent&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ignore this directive for now</span>
    <span class="n">Parser</span><span class="p">.</span><span class="n">Lex</span><span class="p">();</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">DirectiveID</span><span class="p">.</span><span class="n">getString</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;.end&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ignore this directive for now</span>
    <span class="n">Parser</span><span class="p">.</span><span class="n">Lex</span><span class="p">();</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">DirectiveID</span><span class="p">.</span><span class="n">getString</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;.frame&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ignore this directive for now</span>
    <span class="n">Parser</span><span class="p">.</span><span class="n">eatToEndOfStatement</span><span class="p">();</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">DirectiveID</span><span class="p">.</span><span class="n">getString</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;.set&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">parseDirectiveSet</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">DirectiveID</span><span class="p">.</span><span class="n">getString</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;.fmask&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ignore this directive for now</span>
    <span class="n">Parser</span><span class="p">.</span><span class="n">eatToEndOfStatement</span><span class="p">();</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">DirectiveID</span><span class="p">.</span><span class="n">getString</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;.mask&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ignore this directive for now</span>
    <span class="n">Parser</span><span class="p">.</span><span class="n">eatToEndOfStatement</span><span class="p">();</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">DirectiveID</span><span class="p">.</span><span class="n">getString</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;.gpword&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ignore this directive for now</span>
    <span class="n">Parser</span><span class="p">.</span><span class="n">eatToEndOfStatement</span><span class="p">();</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="s">&quot;C&quot;</span> <span class="kt">void</span> <span class="n">LLVMInitializeCpu0AsmParser</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">RegisterMCAsmParser</span><span class="o">&lt;</span><span class="n">Cpu0AsmParser</span><span class="o">&gt;</span> <span class="n">X</span><span class="p">(</span><span class="n">TheCpu0Target</span><span class="p">);</span>
  <span class="n">RegisterMCAsmParser</span><span class="o">&lt;</span><span class="n">Cpu0AsmParser</span><span class="o">&gt;</span> <span class="n">Y</span><span class="p">(</span><span class="n">TheCpu0elTarget</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#define GET_REGISTER_MATCHER</span>
<span class="cp">#define GET_MATCHER_IMPLEMENTATION</span>
<span class="cp">#include &quot;Cpu0GenAsmMatcher.inc&quot;</span>
</pre></div>
</td></tr></table></div>
<p class="rubric">LLVMBackendTutorialExampleCode/Chapter10_1/AsmParser/CMakeLists.txt</p>
<div class="highlight-c++"><pre>include_directories( ${CMAKE_CURRENT_BINARY_DIR}/.. ${CMAKE_CURRENT_SOURCE_DIR}/.. )
add_llvm_library(LLVMCpu0AsmParser
  Cpu0AsmParser.cpp
  )

add_dependencies(LLVMCpu0AsmParser Cpu0CommonTableGen)
</pre>
</div>
<p class="rubric">LLVMBackendTutorialExampleCode/Chapter10_1/AsmParser/LLVMBuild.txt</p>
<div class="highlight-c++"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">;</span><span class="o">===-</span> <span class="p">.</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">Target</span><span class="o">/</span><span class="n">Mips</span><span class="o">/</span><span class="n">AsmParser</span><span class="o">/</span><span class="n">LLVMBuild</span><span class="p">.</span><span class="n">txt</span> <span class="o">----------------*-</span> <span class="n">Conf</span> <span class="o">-*--===</span><span class="p">;</span>
<span class="p">;</span>
<span class="p">;</span>                     <span class="n">The</span> <span class="n">LLVM</span> <span class="n">Compiler</span> <span class="n">Infrastructure</span>
<span class="p">;</span>
<span class="p">;</span> <span class="n">This</span> <span class="n">file</span> <span class="n">is</span> <span class="n">distributed</span> <span class="n">under</span> <span class="n">the</span> <span class="n">University</span> <span class="n">of</span> <span class="n">Illinois</span> <span class="n">Open</span> <span class="n">Source</span>
<span class="p">;</span> <span class="n">License</span><span class="p">.</span> <span class="n">See</span> <span class="n">LICENSE</span><span class="p">.</span><span class="n">TXT</span> <span class="k">for</span> <span class="n">details</span><span class="p">.</span>
<span class="p">;</span>
<span class="p">;</span><span class="o">===------------------------------------------------------------------------===</span><span class="p">;</span>
<span class="p">;</span>
<span class="p">;</span> <span class="n">This</span> <span class="n">is</span> <span class="n">an</span> <span class="n">LLVMBuild</span> <span class="n">description</span> <span class="n">file</span> <span class="k">for</span> <span class="n">the</span> <span class="n">components</span> <span class="n">in</span> <span class="k">this</span> <span class="n">subdirectory</span><span class="p">.</span>
<span class="p">;</span>
<span class="p">;</span> <span class="n">For</span> <span class="n">more</span> <span class="n">information</span> <span class="n">on</span> <span class="n">the</span> <span class="n">LLVMBuild</span> <span class="n">system</span><span class="p">,</span> <span class="n">please</span> <span class="nl">see:</span>
<span class="p">;</span>
<span class="p">;</span>   <span class="nl">http:</span><span class="c1">//llvm.org/docs/LLVMBuild.html</span>
<span class="p">;</span>
<span class="p">;</span><span class="o">===------------------------------------------------------------------------===</span><span class="p">;</span>

<span class="p">[</span><span class="n">component_0</span><span class="p">]</span>
<span class="n">type</span> <span class="o">=</span> <span class="n">Library</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">Cpu0AsmParser</span>
<span class="n">parent</span> <span class="o">=</span> <span class="n">Mips</span>
<span class="n">required_libraries</span> <span class="o">=</span> <span class="n">MC</span> <span class="n">MCParser</span> <span class="n">Support</span> <span class="n">MipsDesc</span> <span class="n">MipsInfo</span>
<span class="n">add_to_library_groups</span> <span class="o">=</span> <span class="n">Cpu0</span>
</pre></div>
</td></tr></table></div>
<p>The Cpu0AsmParser.cpp contains one thousand of code which do the assembly
language parsing. You can understand it with a little patient only.
To let directory AsmParser be built, modify CMakeLists.txt and LLVMBuild.txt as
follows,</p>
<p class="rubric">LLVMBackendTutorialExampleCode/Chapter10_1/CMakeLists.txt</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="n">tablegen</span><span class="p">(</span><span class="n">LLVM</span> <span class="n">Cpu0GenAsmMatcher</span><span class="p">.</span><span class="n">inc</span> <span class="o">-</span><span class="n">gen</span><span class="o">-</span><span class="k">asm</span><span class="o">-</span><span class="n">matcher</span><span class="p">)</span>
<span class="p">...</span>
<span class="n">add_subdirectory</span><span class="p">(</span><span class="n">AsmParser</span><span class="p">)</span>
</pre></div>
</div>
<p class="rubric">LLVMBackendTutorialExampleCode/Chapter10_1/LLVMBuild.txt</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="n">subdirectories</span> <span class="o">=</span> <span class="n">AsmParser</span> <span class="p">...</span>
<span class="p">...</span>
<span class="n">has_asmparser</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>The other files change as follows,</p>
<p class="rubric">LLVMBackendTutorialExampleCode/Chapter10_1/MCTargetDesc/Cpu0MCCodeEmitter.cpp</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="kt">unsigned</span> <span class="n">Cpu0MCCodeEmitter</span><span class="o">::</span>
<span class="n">getBranchTargetOpValue</span><span class="p">(</span><span class="k">const</span> <span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">MI</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">OpNo</span><span class="p">,</span>
             <span class="n">SmallVectorImpl</span><span class="o">&lt;</span><span class="n">MCFixup</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">Fixups</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="c1">// If the destination is an immediate, we have nothing to do.</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">MO</span><span class="p">.</span><span class="n">isImm</span><span class="p">())</span> <span class="k">return</span> <span class="n">MO</span><span class="p">.</span><span class="n">getImm</span><span class="p">();</span>
  <span class="p">...</span>
<span class="p">}</span>

<span class="c1">/// getJumpAbsoluteTargetOpValue - Return binary encoding of the jump</span>
<span class="c1">/// target operand. Such as SWI.</span>
<span class="kt">unsigned</span> <span class="n">Cpu0MCCodeEmitter</span><span class="o">::</span>
<span class="n">getJumpAbsoluteTargetOpValue</span><span class="p">(</span><span class="k">const</span> <span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">MI</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">OpNo</span><span class="p">,</span>
           <span class="n">SmallVectorImpl</span><span class="o">&lt;</span><span class="n">MCFixup</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">Fixups</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="c1">// If the destination is an immediate, we have nothing to do.</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">MO</span><span class="p">.</span><span class="n">isImm</span><span class="p">())</span> <span class="k">return</span> <span class="n">MO</span><span class="p">.</span><span class="n">getImm</span><span class="p">();</span>
  <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p class="rubric">LLVMBackendTutorialExampleCode/Chapter10_1/Cpu0.td</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="n">def</span> <span class="n">Cpu0AsmParser</span> <span class="o">:</span> <span class="n">AsmParser</span> <span class="p">{</span>
  <span class="n">let</span> <span class="n">ShouldEmitMatchRegisterName</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">def</span> <span class="n">Cpu0AsmParserVariant</span> <span class="o">:</span> <span class="n">AsmParserVariant</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">Variant</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="c1">// Recognize hard coded registers.</span>
  <span class="n">string</span> <span class="n">RegisterPrefix</span> <span class="o">=</span> <span class="s">&quot;$&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">def</span> <span class="n">Cpu0</span> <span class="o">:</span> <span class="n">Target</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="n">let</span> <span class="n">AssemblyParsers</span> <span class="o">=</span> <span class="p">[</span><span class="n">Cpu0AsmParser</span><span class="p">];</span>
  <span class="p">...</span>
  <span class="n">let</span> <span class="n">AssemblyParserVariants</span> <span class="o">=</span> <span class="p">[</span><span class="n">Cpu0AsmParserVariant</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p class="rubric">LLVMBackendTutorialExampleCode/Chapter10_1/Cpu0InstrFormats.td</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="c1">// Pseudo-instructions for alternate assembly syntax (never used by codegen).</span>
<span class="c1">// These are aliases that require C++ handling to convert to the target</span>
<span class="c1">// instruction, while InstAliases can be handled directly by tblgen.</span>
<span class="k">class</span> <span class="nc">Cpu0AsmPseudoInst</span><span class="o">&lt;</span><span class="n">dag</span> <span class="n">outs</span><span class="p">,</span> <span class="n">dag</span> <span class="n">ins</span><span class="p">,</span> <span class="n">string</span> <span class="n">asmstr</span><span class="o">&gt;:</span>
  <span class="n">Cpu0Inst</span><span class="o">&lt;</span><span class="n">outs</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="n">asmstr</span><span class="p">,</span> <span class="p">[],</span> <span class="n">IIPseudo</span><span class="p">,</span> <span class="n">Pseudo</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="n">let</span> <span class="n">isPseudo</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">let</span> <span class="n">Pattern</span> <span class="o">=</span> <span class="p">[];</span>
<span class="p">}</span>
</pre></div>
</div>
<p class="rubric">LLVMBackendTutorialExampleCode/Chapter10_1/Cpu0InstrInfo.td</p>
<div class="highlight-c++"><pre>// Cpu0InstrInfo.td
def Cpu0MemAsmOperand : AsmOperandClass {
  let Name = "Mem";
  let ParserMethod = "parseMemOperand";
}

// Address operand
def mem : Operand&lt;i32&gt; {
  ...
  let ParserMatchClass = Cpu0MemAsmOperand;
}
...
class CmpInstr&lt;...
   !strconcat(instr_asm, "\t$rc, $ra, $rb"), [], itin&gt; {
  ...
}
...
class CBranch&lt;...
       !strconcat(instr_asm, "\t$ra, $addr"), ...&gt; {
  ...
}
...
//===----------------------------------------------------------------------===//
// Pseudo Instruction definition
//===----------------------------------------------------------------------===//

class LoadImm32&lt; string instr_asm, Operand Od, RegisterClass RC&gt; :
  Cpu0AsmPseudoInst&lt;(outs RC:$ra), (ins Od:$imm32),
           !strconcat(instr_asm, "\t$ra, $imm32")&gt; ;
def LoadImm32Reg : LoadImm32&lt;"li", shamt, CPURegs&gt;;

class LoadAddress&lt;string instr_asm, Operand MemOpnd, RegisterClass RC&gt; :
  Cpu0AsmPseudoInst&lt;(outs RC:$ra), (ins MemOpnd:$addr),
           !strconcat(instr_asm, "\t$ra, $addr")&gt; ;
def LoadAddr32Reg : LoadAddress&lt;"la", mem, CPURegs&gt;;

class LoadAddressImm&lt;string instr_asm, Operand Od, RegisterClass RC&gt; :
  Cpu0AsmPseudoInst&lt;(outs RC:$ra), (ins Od:$imm32),
           !strconcat(instr_asm, "\t$ra, $imm32")&gt; ;
def LoadAddr32Imm : LoadAddressImm&lt;"la", shamt, CPURegs&gt;;</pre>
</div>
<p>Above define the <strong>ParserMethod = &#8220;parseMemOperand&#8221;</strong> and implement the
parseMemOperand() in Cpu0AsmParser.cpp to handle the <strong>&#8220;mem&#8221;</strong> operand which
used in ld and st. For example, ld $2, 4($sp), the <strong>mem</strong> operand is 4($sp).
Accompany with <strong>&#8220;let ParserMatchClass = Cpu0MemAsmOperand;&#8221;</strong>,
LLVM will call parseMemOperand() of Cpu0AsmParser.cpp when it meets the assembly
<strong>mem</strong> operand 4($sp). With above <strong>&#8220;let&#8221;</strong> assignment, TableGen will generate
the following structure and functions in Cpu0GenAsmMatcher.inc.</p>
<p class="rubric">cmake_debug_build/lib/Target/Cpu0/Cpu0GenAsmMatcher.inc</p>
<div class="highlight-c++"><div class="highlight"><pre>  <span class="k">enum</span> <span class="n">OperandMatchResultTy</span> <span class="p">{</span>
    <span class="n">MatchOperand_Success</span><span class="p">,</span>    <span class="c1">// operand matched successfully</span>
    <span class="n">MatchOperand_NoMatch</span><span class="p">,</span>    <span class="c1">// operand did not match</span>
    <span class="n">MatchOperand_ParseFail</span>   <span class="c1">// operand matched but had errors</span>
  <span class="p">};</span>
  <span class="n">OperandMatchResultTy</span> <span class="n">MatchOperandParserImpl</span><span class="p">(</span>
    <span class="n">SmallVectorImpl</span><span class="o">&lt;</span><span class="n">MCParsedAsmOperand</span><span class="o">*&gt;</span> <span class="o">&amp;</span><span class="n">Operands</span><span class="p">,</span>
    <span class="n">StringRef</span> <span class="n">Mnemonic</span><span class="p">);</span>
  <span class="n">OperandMatchResultTy</span> <span class="n">tryCustomParseOperand</span><span class="p">(</span>
    <span class="n">SmallVectorImpl</span><span class="o">&lt;</span><span class="n">MCParsedAsmOperand</span><span class="o">*&gt;</span> <span class="o">&amp;</span><span class="n">Operands</span><span class="p">,</span>
    <span class="kt">unsigned</span> <span class="n">MCK</span><span class="p">);</span>

<span class="n">Cpu0AsmParser</span><span class="o">::</span><span class="n">OperandMatchResultTy</span> <span class="n">Cpu0AsmParser</span><span class="o">::</span>
<span class="n">tryCustomParseOperand</span><span class="p">(</span><span class="n">SmallVectorImpl</span><span class="o">&lt;</span><span class="n">MCParsedAsmOperand</span><span class="o">*&gt;</span> <span class="o">&amp;</span><span class="n">Operands</span><span class="p">,</span>
            <span class="kt">unsigned</span> <span class="n">MCK</span><span class="p">)</span> <span class="p">{</span>

  <span class="k">switch</span><span class="p">(</span><span class="n">MCK</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">case</span> <span class="nl">MCK_Mem:</span>
    <span class="k">return</span> <span class="n">parseMemOperand</span><span class="p">(</span><span class="n">Operands</span><span class="p">);</span>
  <span class="k">default</span><span class="o">:</span>
    <span class="k">return</span> <span class="n">MatchOperand_NoMatch</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">MatchOperand_NoMatch</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Cpu0AsmParser</span><span class="o">::</span><span class="n">OperandMatchResultTy</span> <span class="n">Cpu0AsmParser</span><span class="o">::</span>
<span class="n">MatchOperandParserImpl</span><span class="p">(</span><span class="n">SmallVectorImpl</span><span class="o">&lt;</span><span class="n">MCParsedAsmOperand</span><span class="o">*&gt;</span> <span class="o">&amp;</span><span class="n">Operands</span><span class="p">,</span>
             <span class="n">StringRef</span> <span class="n">Mnemonic</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">...</span>
<span class="p">}</span>

<span class="c1">/// MatchClassKind - The kinds of classes which participate in</span>
<span class="c1">/// instruction matching.</span>
<span class="k">enum</span> <span class="n">MatchClassKind</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="n">MCK_Mem</span><span class="p">,</span> <span class="c1">// user defined class &#39;Cpu0MemAsmOperand&#39;</span>
  <span class="p">...</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Above 3 Pseudo Instruction definitions in Cpu0InstrInfo.td such as
LoadImm32Reg are handled by Cpu0AsmParser.cpp as follows,</p>
<p class="rubric">LLVMBackendTutorialExampleCode/Chapter10_1/AsmParser/Cpu0AsmParser.cpp</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="kt">bool</span> <span class="n">Cpu0AsmParser</span><span class="o">::</span><span class="n">needsExpansion</span><span class="p">(</span><span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">Inst</span><span class="p">)</span> <span class="p">{</span>

  <span class="k">switch</span><span class="p">(</span><span class="n">Inst</span><span class="p">.</span><span class="n">getOpcode</span><span class="p">())</span> <span class="p">{</span>
  <span class="k">case</span> <span class="n">Cpu0</span><span class="o">::</span><span class="nl">LoadImm32Reg:</span>
  <span class="k">case</span> <span class="n">Cpu0</span><span class="o">::</span><span class="nl">LoadAddr32Imm:</span>
  <span class="k">case</span> <span class="n">Cpu0</span><span class="o">::</span><span class="nl">LoadAddr32Reg:</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="k">default</span><span class="o">:</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Cpu0AsmParser</span><span class="o">::</span><span class="n">expandInstruction</span><span class="p">(</span><span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">Inst</span><span class="p">,</span> <span class="n">SMLoc</span> <span class="n">IDLoc</span><span class="p">,</span>
            <span class="n">SmallVectorImpl</span><span class="o">&lt;</span><span class="n">MCInst</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">Instructions</span><span class="p">){</span>
  <span class="k">switch</span><span class="p">(</span><span class="n">Inst</span><span class="p">.</span><span class="n">getOpcode</span><span class="p">())</span> <span class="p">{</span>
  <span class="k">case</span> <span class="n">Cpu0</span><span class="o">::</span><span class="nl">LoadImm32Reg:</span>
    <span class="k">return</span> <span class="n">expandLoadImm</span><span class="p">(</span><span class="n">Inst</span><span class="p">,</span> <span class="n">IDLoc</span><span class="p">,</span> <span class="n">Instructions</span><span class="p">);</span>
  <span class="k">case</span> <span class="n">Cpu0</span><span class="o">::</span><span class="nl">LoadAddr32Imm:</span>
    <span class="k">return</span> <span class="n">expandLoadAddressImm</span><span class="p">(</span><span class="n">Inst</span><span class="p">,</span><span class="n">IDLoc</span><span class="p">,</span><span class="n">Instructions</span><span class="p">);</span>
  <span class="k">case</span> <span class="n">Cpu0</span><span class="o">::</span><span class="nl">LoadAddr32Reg:</span>
    <span class="k">return</span> <span class="n">expandLoadAddressReg</span><span class="p">(</span><span class="n">Inst</span><span class="p">,</span><span class="n">IDLoc</span><span class="p">,</span><span class="n">Instructions</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">Cpu0AsmParser</span><span class="o">::</span>
<span class="n">MatchAndEmitInstruction</span><span class="p">(</span><span class="n">SMLoc</span> <span class="n">IDLoc</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="o">&amp;</span><span class="n">Opcode</span><span class="p">,</span>
            <span class="n">SmallVectorImpl</span><span class="o">&lt;</span><span class="n">MCParsedAsmOperand</span><span class="o">*&gt;</span> <span class="o">&amp;</span><span class="n">Operands</span><span class="p">,</span>
            <span class="n">MCStreamer</span> <span class="o">&amp;</span><span class="n">Out</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="o">&amp;</span><span class="n">ErrorInfo</span><span class="p">,</span>
            <span class="kt">bool</span> <span class="n">MatchingInlineAsm</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">MCInst</span> <span class="n">Inst</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="n">MatchResult</span> <span class="o">=</span> <span class="n">MatchInstructionImpl</span><span class="p">(</span><span class="n">Operands</span><span class="p">,</span> <span class="n">Inst</span><span class="p">,</span> <span class="n">ErrorInfo</span><span class="p">,</span>
                        <span class="n">MatchingInlineAsm</span><span class="p">);</span>

  <span class="k">switch</span> <span class="p">(</span><span class="n">MatchResult</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">default</span><span class="o">:</span> <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="nl">Match_Success:</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">needsExpansion</span><span class="p">(</span><span class="n">Inst</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">SmallVector</span><span class="o">&lt;</span><span class="n">MCInst</span><span class="p">,</span> <span class="mi">4</span><span class="o">&gt;</span> <span class="n">Instructions</span><span class="p">;</span>
    <span class="n">expandInstruction</span><span class="p">(</span><span class="n">Inst</span><span class="p">,</span> <span class="n">IDLoc</span><span class="p">,</span> <span class="n">Instructions</span><span class="p">);</span>
    <span class="p">...</span>
  <span class="p">}</span>
  <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Finally, remind the CPURegs as below must
follow the order of register number because AsmParser use this when do register
number encode.</p>
<p class="rubric">LLVMBackendTutorialExampleCode/Chapter10_1/Cpu0RegisterInfo.td</p>
<div class="highlight-c++"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47</pre></div></td><td class="code"><div class="highlight"><pre><span class="c1">//===----------------------------------------------------------------------===//</span>
<span class="c1">// The register string, such as &quot;9&quot; or &quot;gp&quot; will show on &quot;llvm-objdump -d&quot;</span>
<span class="n">let</span> <span class="n">Namespace</span> <span class="o">=</span> <span class="s">&quot;Cpu0&quot;</span> <span class="n">in</span> <span class="p">{</span>
  <span class="c1">// General Purpose Registers</span>
  <span class="n">def</span> <span class="n">ZERO</span> <span class="o">:</span> <span class="n">Cpu0GPRReg</span><span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;zero&quot;</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">DwarfRegNum</span><span class="o">&lt;</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="n">def</span> <span class="n">AT</span>   <span class="o">:</span> <span class="n">Cpu0GPRReg</span><span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;1&quot;</span><span class="o">&gt;</span><span class="p">,</span>   <span class="n">DwarfRegNum</span><span class="o">&lt;</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="n">def</span> <span class="n">V0</span>   <span class="o">:</span> <span class="n">Cpu0GPRReg</span><span class="o">&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&quot;2&quot;</span><span class="o">&gt;</span><span class="p">,</span>    <span class="n">DwarfRegNum</span><span class="o">&lt;</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="n">def</span> <span class="n">V1</span>   <span class="o">:</span> <span class="n">Cpu0GPRReg</span><span class="o">&lt;</span> <span class="mi">3</span><span class="p">,</span> <span class="s">&quot;3&quot;</span><span class="o">&gt;</span><span class="p">,</span>    <span class="n">DwarfRegNum</span><span class="o">&lt;</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="n">def</span> <span class="n">A0</span>   <span class="o">:</span> <span class="n">Cpu0GPRReg</span><span class="o">&lt;</span> <span class="mi">4</span><span class="p">,</span> <span class="s">&quot;4&quot;</span><span class="o">&gt;</span><span class="p">,</span>    <span class="n">DwarfRegNum</span><span class="o">&lt;</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="n">def</span> <span class="n">A1</span>   <span class="o">:</span> <span class="n">Cpu0GPRReg</span><span class="o">&lt;</span> <span class="mi">5</span><span class="p">,</span> <span class="s">&quot;5&quot;</span><span class="o">&gt;</span><span class="p">,</span>    <span class="n">DwarfRegNum</span><span class="o">&lt;</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="n">def</span> <span class="n">T9</span>   <span class="o">:</span> <span class="n">Cpu0GPRReg</span><span class="o">&lt;</span> <span class="mi">6</span><span class="p">,</span> <span class="s">&quot;t9&quot;</span><span class="o">&gt;</span><span class="p">,</span>   <span class="n">DwarfRegNum</span><span class="o">&lt;</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="n">def</span> <span class="n">S0</span>   <span class="o">:</span> <span class="n">Cpu0GPRReg</span><span class="o">&lt;</span> <span class="mi">7</span><span class="p">,</span> <span class="s">&quot;7&quot;</span><span class="o">&gt;</span><span class="p">,</span>    <span class="n">DwarfRegNum</span><span class="o">&lt;</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="n">def</span> <span class="n">S1</span>   <span class="o">:</span> <span class="n">Cpu0GPRReg</span><span class="o">&lt;</span> <span class="mi">8</span><span class="p">,</span> <span class="s">&quot;8&quot;</span><span class="o">&gt;</span><span class="p">,</span>    <span class="n">DwarfRegNum</span><span class="o">&lt;</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="n">def</span> <span class="n">S2</span>   <span class="o">:</span> <span class="n">Cpu0GPRReg</span><span class="o">&lt;</span> <span class="mi">9</span><span class="p">,</span> <span class="s">&quot;9&quot;</span><span class="o">&gt;</span><span class="p">,</span>    <span class="n">DwarfRegNum</span><span class="o">&lt;</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="n">def</span> <span class="n">GP</span>   <span class="o">:</span> <span class="n">Cpu0GPRReg</span><span class="o">&lt;</span> <span class="mi">10</span><span class="p">,</span> <span class="s">&quot;gp&quot;</span><span class="o">&gt;</span><span class="p">,</span>  <span class="n">DwarfRegNum</span><span class="o">&lt;</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="n">def</span> <span class="n">FP</span>   <span class="o">:</span> <span class="n">Cpu0GPRReg</span><span class="o">&lt;</span> <span class="mi">11</span><span class="p">,</span> <span class="s">&quot;fp&quot;</span><span class="o">&gt;</span><span class="p">,</span>  <span class="n">DwarfRegNum</span><span class="o">&lt;</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="n">def</span> <span class="n">SW</span>   <span class="o">:</span> <span class="n">Cpu0GPRReg</span><span class="o">&lt;</span> <span class="mi">12</span><span class="p">,</span> <span class="s">&quot;sw&quot;</span><span class="o">&gt;</span><span class="p">,</span>   <span class="n">DwarfRegNum</span><span class="o">&lt;</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="n">def</span> <span class="n">SP</span>   <span class="o">:</span> <span class="n">Cpu0GPRReg</span><span class="o">&lt;</span> <span class="mi">13</span><span class="p">,</span> <span class="s">&quot;sp&quot;</span><span class="o">&gt;</span><span class="p">,</span>   <span class="n">DwarfRegNum</span><span class="o">&lt;</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="n">def</span> <span class="n">LR</span>   <span class="o">:</span> <span class="n">Cpu0GPRReg</span><span class="o">&lt;</span> <span class="mi">14</span><span class="p">,</span> <span class="s">&quot;lr&quot;</span><span class="o">&gt;</span><span class="p">,</span>   <span class="n">DwarfRegNum</span><span class="o">&lt;</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="n">def</span> <span class="n">PC</span>   <span class="o">:</span> <span class="n">Cpu0GPRReg</span><span class="o">&lt;</span> <span class="mi">15</span><span class="p">,</span> <span class="s">&quot;pc&quot;</span><span class="o">&gt;</span><span class="p">,</span>   <span class="n">DwarfRegNum</span><span class="o">&lt;</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span><span class="o">&gt;</span><span class="p">;</span>
<span class="c1">//  def MAR  : Register&lt; 16, &quot;mar&quot;&gt;,  DwarfRegNum&lt;[16]&gt;;</span>
<span class="c1">//  def MDR  : Register&lt; 17, &quot;mdr&quot;&gt;,  DwarfRegNum&lt;[17]&gt;;</span>

  <span class="c1">// Hi/Lo registers</span>
  <span class="n">def</span> <span class="n">HI</span>   <span class="o">:</span> <span class="n">Register</span><span class="o">&lt;</span><span class="s">&quot;hi&quot;</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">DwarfRegNum</span><span class="o">&lt;</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="n">def</span> <span class="n">LO</span>   <span class="o">:</span> <span class="n">Register</span><span class="o">&lt;</span><span class="s">&quot;lo&quot;</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">DwarfRegNum</span><span class="o">&lt;</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//===----------------------------------------------------------------------===//</span>
<span class="c1">// Register Classes</span>
<span class="c1">//===----------------------------------------------------------------------===//</span>

<span class="n">def</span> <span class="n">CPURegs</span> <span class="o">:</span> <span class="n">RegisterClass</span><span class="o">&lt;</span><span class="s">&quot;Cpu0&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">i32</span><span class="p">],</span> <span class="mi">32</span><span class="p">,</span> <span class="p">(</span><span class="n">add</span>
  <span class="c1">// Reserved</span>
  <span class="n">ZERO</span><span class="p">,</span> <span class="n">AT</span><span class="p">,</span> 
  <span class="c1">// Return Values and Arguments</span>
  <span class="n">V0</span><span class="p">,</span> <span class="n">V1</span><span class="p">,</span> <span class="n">A0</span><span class="p">,</span> <span class="n">A1</span><span class="p">,</span> 
  <span class="c1">// Not preserved across procedure calls</span>
  <span class="n">T9</span><span class="p">,</span> 
  <span class="c1">// Callee save</span>
  <span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> 
  <span class="c1">// Reserved</span>
  <span class="n">GP</span><span class="p">,</span> <span class="n">FP</span><span class="p">,</span> 
  <span class="c1">// Not preserved across procedure calls</span>
  <span class="n">SW</span><span class="p">,</span> 
  <span class="c1">// Reserved</span>
  <span class="n">SP</span><span class="p">,</span> <span class="n">LR</span><span class="p">,</span> <span class="n">PC</span><span class="p">)</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>Run Chapter10_1/ with ch10_1.cpp to get the correct result as follows,</p>
<div class="highlight-bash"><div class="highlight"><pre>JonathantekiiMac:InputFiles Jonathan<span class="nv">$ </span>/Users/Jonathan/llvm/test/cmake_debug_
build/bin/Debug/llc -march<span class="o">=</span>cpu0 -relocation-model<span class="o">=</span>pic -filetype<span class="o">=</span>obj ch10_1.bc -o
ch10_1.cpu0.o
JonathantekiiMac:InputFiles Jonathan<span class="nv">$ </span>/Users/Jonathan/llvm/test/cmake_debug_
build/bin/Debug/llvm-objdump -d ch10_1.cpu0.o

ch10_1.cpu0.o:  file format ELF32-unknown

Disassembly of section .text:
.text:
     0: 00 2d 00 08                                   ld  <span class="nv">$2</span>, 8<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
     4: 01 0d 00 04                                   st  <span class="nv">$zero</span>, 4<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
     8: 09 30 00 00                                   addiu <span class="nv">$3</span>, <span class="nv">$zero</span>, 0
     c: 13 31 20 00                                   add <span class="nv">$3</span>, <span class="nv">$at</span>, <span class="nv">$2</span>
    10: 14 32 30 00                                   sub <span class="nv">$3</span>, <span class="nv">$2</span>, <span class="nv">$3</span>
    14: 15 21 30 00                                   mul <span class="nv">$2</span>, <span class="nv">$at</span>, <span class="nv">$3</span>
    18: 16 32 00 00                                   div <span class="nv">$3</span>, <span class="nv">$2</span>
    1c: 17 23 00 00                                   divu  <span class="nv">$2</span>, <span class="nv">$3</span>
    20: 18 21 30 00                                   and <span class="nv">$2</span>, <span class="nv">$at</span>, <span class="nv">$3</span>
    24: 19 31 20 00                                   or  <span class="nv">$3</span>, <span class="nv">$at</span>, <span class="nv">$2</span>
    28: 1a 12 30 00                                   xor <span class="nv">$at</span>, <span class="nv">$2</span>, <span class="nv">$3</span>
    2c: 50 43 00 00                                   mult  <span class="nv">$4</span>, <span class="nv">$3</span>
    30: 51 32 00 00                                   multu <span class="nv">$3</span>, <span class="nv">$2</span>
    34: 40 30 00 00                                   mfhi  <span class="nv">$3</span>
    38: 41 20 00 00                                   mflo  <span class="nv">$2</span>
    3c: 42 20 00 00                                   mthi  <span class="nv">$2</span>
    40: 43 20 00 00                                   mtlo  <span class="nv">$2</span>
    44: 1b 22 00 02                                   sra <span class="nv">$2</span>, <span class="nv">$2</span>, 2
    48: 1c 21 10 03                                   rol <span class="nv">$2</span>, <span class="nv">$at</span>, 3
    4c: 1d 33 10 04                                   ror <span class="nv">$3</span>, <span class="nv">$3</span>, 4
    50: 1e 22 00 02                                   shl <span class="nv">$2</span>, <span class="nv">$2</span>, 2
    54: 1f 23 00 05                                   shr <span class="nv">$2</span>, <span class="nv">$3</span>, 5
    58: 10 23 00 00                                   cmp <span class="nv">$zero</span>, <span class="nv">$2</span>, <span class="nv">$3</span>
    5c: 20 00 00 14                                   jeq <span class="nv">$zero</span>, 20
    60: 21 00 00 10                                   jne <span class="nv">$zero</span>, 16
    64: 22 ff ff ec                                   jlt <span class="nv">$zero</span>, -20
    68: 24 ff ff f0                                   jle <span class="nv">$zero</span>, -16
    6c: 23 ff ff <span class="nb">fc                                   </span>jgt <span class="nv">$zero</span>, -4
    70: 25 ff ff f4                                   jge <span class="nv">$zero</span>, -12
    74: 2a 00 04 00                                   swi 1024
    78: 2b 01 00 00                                   jsub  65536
    7c: 2c e0 00 00                                   ret <span class="nv">$lr</span>
    80: 2d e6 00 00                                   jalr  <span class="nv">$6</span>
    84: 09 30 00 70                                   addiu <span class="nv">$3</span>, <span class="nv">$zero</span>, 112
    88: 1e 33 00 10                                   shl <span class="nv">$3</span>, <span class="nv">$3</span>, 16
    8c: 09 10 00 00                                   addiu <span class="nv">$at</span>, <span class="nv">$zero</span>, 0
    90: 19 33 10 00                                   or  <span class="nv">$3</span>, <span class="nv">$3</span>, <span class="nv">$at</span>
    94: 09 30 00 80                                   addiu <span class="nv">$3</span>, <span class="nv">$zero</span>, 128
    98: 1e 36 00 10                                   shl <span class="nv">$3</span>, <span class="nv">$6</span>, 16
    9c: 09 10 00 00                                   addiu <span class="nv">$at</span>, <span class="nv">$zero</span>, 0
    a0: 19 36 10 00                                   or  <span class="nv">$3</span>, <span class="nv">$6</span>, <span class="nv">$at</span>
    a4: 13 33 60 00                                   add <span class="nv">$3</span>, <span class="nv">$3</span>, <span class="nv">$6</span>
    a8: 09 30 00 90                                   addiu <span class="nv">$3</span>, <span class="nv">$zero</span>, 144
    ac: 1e 33 00 10                                   shl <span class="nv">$3</span>, <span class="nv">$3</span>, 16
    b0: 09 10 00 00                                   addiu <span class="nv">$at</span>, <span class="nv">$zero</span>, 0
    b4: 19 33 10 00                                   or  <span class="nv">$3</span>, <span class="nv">$3</span>, <span class="nv">$at</span>
</pre></div>
</div>
<p>We replace cmp and jeg with explicit $sw in assembly and $zero in disassembly for
AsmParser support. It&#8217;s OK with just a little bad in readability and in assembly
programing than implicit representation.</p>
</div>
<div class="section" id="verilog-of-cpu0">
<h2>Verilog of CPU0<a class="headerlink" href="#verilog-of-cpu0" title="Permalink to this headline">¶</a></h2>
<p>Verilog language is an IEEE standard in IC design. There are a lot of book and
documents for this language. Web site <a class="footnote-reference" href="#id3" id="id1">[1]</a> has a pdf <a class="footnote-reference" href="#id4" id="id2">[2]</a> in this.
Example code LLVMBackendTutorialExampleCode/cpu0s_verilog/raw/cpu0s.v is the
cpu0 design in Verilog. In Appendix A, we have downloaded and installed Icarus
Verilog tool both on iMac and Linux. The cpu0s.v is a simple design with only
280 lines of code. Alough it has not the pipeline features, we can assume the
cpu0 backend code run on the pipeline machine because the pipeline version
use the same machine instructions. Verilog is C like language in syntex and
this book is a compiler book, so we list the cpu0s.v as well as the building
command directly as below. We expect
readers can understand the Verilog code just with a little patient and no need
further explanation. There are two type of I/O. One is memory mapped I/O, the
other is instruction I/O. CPU0 use memory mapped I/O, we set the memory address
0x7000 as the output port. When meet the instruction <strong>&#8220;st $ra, cx($rb)&#8221;</strong>, where
cx($rb) is 0x7000 (28672), CPU0 display the content as follows,</p>
<div class="highlight-c++"><pre>ST :
  if (R[b]+c16 == 28672)
    $display("%4dns %8x : %8x OUTPUT=%-d", $stime, pc0, ir, R[a]);</pre>
</div>
<p class="rubric">LLVMBackendTutorialExampleCode/cpu0_verilog/raw/cpu0s.v</p>
<div class="highlight-c++"><pre>`define MEMSIZE 'h7000
`define MEMEMPTY 8'hFF
`define IOADDR  'h7000

// Operand width
`define INT32 2'b11     // 32 bits
`define INT24 2'b10     // 24 bits
`define INT16 2'b01     // 16 bits
`define BYTE  2'b00     // 8  bits

// Reference web: http://ccckmit.wikidot.com/ocs:cpu0
module cpu0(input clock, reset, output reg [2:0] tick, 
            output reg [31:0] ir, pc, mar, mdr, inout [31:0] dbus, 
            output reg m_en, m_rw, output reg [1:0] m_size);
  reg signed [31:0] R [0:15], HI, LO;
  // High and Low part of 64 bit result
  reg [7:0] op;
  reg [3:0] a, b, c;
  reg [4:0] c5;
  reg signed [31:0] c12, c16, uc16, c24, Ra, Rb, Rc, pc0; // pc0 : instruction pc

  // register name
  `define PC   R[15]   // Program Counter
  `define LR   R[14]   // Link Register
  `define SP   R[13]   // Stack Pointer
  `define SW   R[12]   // Status Word
  // SW Flage
  `define N    `SW[31] // Negative flag
  `define Z    `SW[30] // Zero
  `define C    `SW[29] // Carry
  `define V    `SW[28] // Overflow
  `define I    `SW[7]  // Hardware Interrupt Enable
  `define T    `SW[6]  // Software Interrupt Enable
  `define M    `SW[0]  // Mode bit
  // Instruction Opcode 
  parameter [7:0] LD=8'h01,ST=8'h02,LB=8'h03,LBu=8'h04,SB=8'h05,LH=8'h06,
  LHu=8'h07,SH=8'h08,ADDiu=8'h09,ANDi=8'h0C,ORi=8'h0D,
  XORi=8'h0E,
  CMP=8'h10,
  ADDu=8'h11,SUBu=8'h12,ADD=8'h13,SUB=8'h14,MUL=8'h15,SDIV=8'h16,
  AND=8'h18,OR=8'h19,XOR=8'h1A,
  SRA=8'h1B,ROL=8'h1C,ROR=8'h1D,SHL=8'h1E,SHR=8'h1F,
  JEQ=8'h20,JNE=8'h21,JLT=8'h22,JGT=8'h23,JLE=8'h24,JGE=8'h25,
  JMP=8'h26,
  SWI=8'h2A,JSUB=8'h2B,RET=8'h2C,IRET=8'h2D,JALR=8'h2E,
  MFHI=8'h40,MFLO=8'h41,MTHI=8'h42,MTLO=8'h43,
  MULT=8'h50;
  
  reg [2:0] state, next_state;
  parameter Reset=3'h0, Fetch=3'h1, Decode=3'h2, Execute=3'h3, WriteBack=3'h4;

  task memReadStart(input [31:0] addr, input [1:0] size); begin // Read Memory Word
    mar = addr;     // read(m[addr])
    m_rw = 1;     // Access Mode: read 
    m_en = 1;     // Enable read
    m_size = size;
  end endtask

  task memReadEnd(output [31:0] data); begin // Read Memory Finish, get data
    mdr = dbus; // get momory, dbus = m[addr]
    data = mdr; // return to data
    m_en = 0; // read complete
  end endtask

  // Write memory -- addr: address to write, data: date to write
  task memWriteStart(input [31:0] addr, input [31:0] data, input [1:0] size); begin 
    mar = addr;    // write(m[addr], data)
    mdr = data;
    m_rw = 0;    // access mode: write
    m_en = 1;     // Enable write
    m_size  = size;
  end endtask

  task memWriteEnd; begin // Write Memory Finish
    m_en = 0; // write complete
  end endtask

  task regSet(input [3:0] i, input [31:0] data); begin
    if (i!=0) R[i] = data;
  end endtask

  task regHILOSet(input [31:0] data1, input [31:0] data2); begin
    HI = data1;
    LO = data2;
  end endtask

  always @(posedge clock or posedge reset) begin
    if (reset) state &lt;= Reset; 
    else state &lt;= next_state;
  end
  
  always @(state or reset) begin
    m_en = 0;
    case (state)    
    Reset: begin 
      `PC = 0; tick = 0; R[0] = 0; `SW = 0; `LR = -1; 
      next_state = reset?Reset:Fetch;
    end
    Fetch: begin  // Tick 1 : instruction fetch, throw PC to address bus, 
                  // memory.read(m[PC])
      memReadStart(`PC, `INT32);
      pc0  = `PC;
      `PC = `PC+4;
      next_state = Decode;
    end
    Decode: begin  // Tick 2 : instruction decode, ir = m[PC]
      memReadEnd(ir); // IR = dbus = m[PC]
      {op,a,b,c} = ir[31:12];
      c24 = $signed(ir[23:0]);
      c16 = $signed(ir[15:0]);
      uc16 = ir[15:0];
      c12 = $signed(ir[11:0]);
      c5  = ir[4:0];
      Ra = R[a];
      Rb = R[b];
      Rc = R[c];
      next_state = Execute;
    end
    Execute: begin // Tick 3 : instruction execution
      case (op)
      // load and store instructions
      LD:  memReadStart(Rb+c16, `INT32);      // LD Ra,[Rb+Cx]; Ra&lt;=[Rb+Cx]
      ST:  memWriteStart(Rb+c16, Ra, `INT32); // ST Ra,[Rb+Cx]; Ra=&gt;[Rb+Cx]
      LB:  memReadStart(Rb+c16, `BYTE);     // LB Ra,[Rb+Cx]; Ra&lt;=(byte)[Rb+Cx]
      LBu: memReadStart(Rb+c16, `BYTE);     // LBu Ra,[Rb+Cx]; Ra&lt;=(byte)[Rb+Cx]
      SB:  memWriteStart(Rb+c16, Ra, `BYTE);// SB Ra,[Rb+Cx]; Ra=&gt;(byte)[Rb+Cx]
      LH:  memReadStart(Rb+c16, `INT16);     // LH Ra,[Rb+Cx]; Ra&lt;=(2bytes)[Rb+Cx]
      LHu: memReadStart(Rb+c16, `INT16);     // LHu Ra,[Rb+Cx]; Ra&lt;=(2bytes)[Rb+Cx]
      SH:  memWriteStart(Rb+c16, Ra, `INT16);// SH Ra,[Rb+Cx]; Ra=&gt;(2bytes)[Rb+Cx]
      // Mathematic 
      ADDiu: R[a] = Rb+c16;                   // ADDiu Ra, Rb+Cx; Ra&lt;=Rb+Cx
      CMP:   begin `N=(Ra-Rb&lt;0);`Z=(Ra-Rb==0); end // CMP Ra, Rb; SW=(Ra &gt;=&lt; Rb)
      ADDu:  regSet(a, Rb+Rc);               // ADDu Ra,Rb,Rc; Ra&lt;=Rb+Rc
      ADD:   begin regSet(a, Rb+Rc); if (a &lt; Rb) `V = 1; else `V =0; end
                                             // ADD Ra,Rb,Rc; Ra&lt;=Rb+Rc
      SUBu:  regSet(a, Rb-Rc);               // SUBu Ra,Rb,Rc; Ra&lt;=Rb-Rc
      SUB:   begin regSet(a, Rb-Rc); if (Rb &lt; 0 &amp;&amp; Rc &gt; 0 &amp;&amp; a &gt;= 0) 
             `V = 1; else `V =0; end         // SUB Ra,Rb,Rc; Ra&lt;=Rb-Rc
      MUL:   regSet(a, Rb*Rc);               // MUL Ra,Rb,Rc;     Ra&lt;=Rb*Rc
      SDIV:  regHILOSet(Ra%Rb, Ra/Rb);          // SDIV Ra,Rb; HI&lt;=Ra%Rb; LO&lt;=Ra/Rb
                                           // with exception overflow
      AND:   regSet(a, Rb&amp;Rc);               // AND Ra,Rb,Rc; Ra&lt;=(Rb and Rc)
      ANDi:  regSet(a, Rb&amp;uc16);             // ANDi Ra,Rb,c16; Ra&lt;=(Rb and c16)
      OR:    regSet(a, Rb|Rc);               // OR Ra,Rb,Rc; Ra&lt;=(Rb or Rc)
      ORi:   regSet(a, Rb|uc16);             // ORi Ra,Rb,c16; Ra&lt;=(Rb or c16)
      XOR:   regSet(a, Rb^Rc);               // XOR Ra,Rb,Rc; Ra&lt;=(Rb xor Rc)
      XORi:  regSet(a, Rb^uc16);             // XORi Ra,Rb,c16; Ra&lt;=(Rb xor c16)
      SHL:   regSet(a, Rb&lt;&lt;c5);     // Shift Left; SHL Ra,Rb,Cx; Ra&lt;=(Rb &lt;&lt; Cx)
      SRA:   regSet(a, (Rb&amp;'h80000000)|(Rb&gt;&gt;c5)); 
                                  // Shift Right with signed bit fill;
                                  // SHR Ra,Rb,Cx; Ra&lt;=(Rb&amp;0x80000000)|(Rb&gt;&gt;Cx)
      SHR:   regSet(a, Rb&gt;&gt;c5);     // Shift Right with 0 fill; 
                                  // SHR Ra,Rb,Cx; Ra&lt;=(Rb &gt;&gt; Cx)
      ROL:   regSet(a, (Rb&lt;&lt;c5)|(Rb&gt;&gt;(32-c5)));     // Rotate Left;
      ROR:   regSet(a, (Rb&gt;&gt;c5)|(Rb&lt;&lt;(32-c5)));     // Rotate Right;
      MFLO: regSet(a, LO);            // MFLO Ra; Ra&lt;=LO
      MFHI: regSet(a, HI);            // MFHI Ra; Ra&lt;=HI
      MTLO: LO = Ra;             // MTLO Ra; LO&lt;=Ra
      MTHI: HI = Ra;             // MTHI Ra; HI&lt;=Ra
      MULT: {HI, LO}=Ra*Rb; // MULT Ra,Rb; HI&lt;=((Ra*Rb)&gt;&gt;32); 
                            // LO&lt;=((Ra*Rb) and 0x00000000ffffffff);
                            // with exception overflow
      // Jump Instructions
      JEQ: if (`Z) `PC=`PC+c24;            // JEQ Cx; if SW(=) PC  PC+Cx
      JNE: if (!`Z) `PC=`PC+c24;           // JNE Cx; if SW(!=) PC PC+Cx
      JLT: if (`N)`PC=`PC+c24;             // JLT Cx; if SW(&lt;) PC  PC+Cx
      JGT: if (!`N&amp;&amp;!`Z) `PC=`PC+c24;      // JGT Cx; if SW(&gt;) PC  PC+Cx
      JLE: if (`N || `Z) `PC=`PC+c24;      // JLE Cx; if SW(&lt;=) PC PC+Cx    
      JGE: if (!`N || `Z) `PC=`PC+c24;     // JGE Cx; if SW(&gt;=) PC PC+Cx
      JMP: `PC = `PC+c24;                  // JMP Cx; PC &lt;= PC+Cx
      SWI: begin 
        `LR=`PC;`PC= c24; `I = 1'b1; 
      end // Software Interrupt; SWI Cx; LR &lt;= PC; PC &lt;= Cx; INT&lt;=1
      JSUB:begin `LR=`PC;`PC=`PC + c24; end // JSUB Cx; LR&lt;=PC; PC&lt;=PC+Cx
      JALR:begin `LR=`PC;`PC=Ra; end // JALR Ra,Rb; Ra&lt;=PC; PC&lt;=Rb
      RET: begin `PC=`LR; end               // RET; PC &lt;= LR
      IRET:begin 
        `PC=`LR;`I = 1'b0; 
      end // Interrupt Return; IRET; PC &lt;= LR; INT&lt;=0
      endcase
      next_state = WriteBack;
    end
    WriteBack: begin // Read/Write finish, close memory
      case (op)
        LD, LB, LBu, LH, LHu  : memReadEnd(R[a]); 
                                          //read memory complete
        ST, SB, SH: memWriteEnd(); 
                                          // write memory complete
      endcase
      case (op)
      MULT, SDIV, MTHI, MTLO :
        $display("%4dns %8x : %8x HI=%8x LO=%8x SW=%8x", $stime, pc0, ir, HI, 
        LO, `SW);
      ST :
        if (R[b]+c16 == `IOADDR)
          $display("%4dns %8x : %8x OUTPUT=%-d", $stime, pc0, ir, R[a]);
        else
          $display("%4dns %8x : %8x m[%-04d+%-04d]=%-d  SW=%8x", $stime, pc0, ir, 
          R[b], c16, R[a], `SW);
      default : 
        $display("%4dns %8x : %8x R[%02d]=%-8x=%-d SW=%8x", $stime, pc0, ir, a, 
        R[a], R[a], `SW);
      endcase
      if (op==RET &amp;&amp; `PC &lt; 0) begin
        $display("RET to PC &lt; 0, finished!");
        $finish;
      end
      next_state = Fetch;
    end                
    endcase
    pc = `PC;
  end

endmodule

module memory0(input clock, reset, en, rw, input [1:0] m_size, 
                input [31:0] abus, dbus_in, output [31:0] dbus_out);
  reg [7:0] m [0:`MEMSIZE-1];
  reg [31:0] data;

  integer i;
  initial begin
  // erase memory
    for (i=0; i &lt; `MEMSIZE; i=i+1) begin
       m[i] = `MEMEMPTY;
    end
  // display memory contents
    $readmemh("cpu0s.hex", m);
    for (i=0; i &lt; `MEMSIZE &amp;&amp; m[i] != `MEMEMPTY; i=i+4) begin
       $display("%8x: %8x", i, {m[i], m[i+1], m[i+2], m[i+3]});
    end
  end

  always @(clock or abus or en or rw or dbus_in) 
  begin
    if (abus &gt;=0 &amp;&amp; abus &lt;= `MEMSIZE-4) begin
      if (en == 1 &amp;&amp; rw == 0) begin // r_w==0:write
        data = dbus_in;
        case (m_size)
        `BYTE:  {m[abus]} = dbus_in[7:0];
        `INT16: {m[abus], m[abus+1] } = dbus_in[15:0];
        `INT24: {m[abus], m[abus+1], m[abus+2]} = dbus_in[24:0];
        `INT32: {m[abus], m[abus+1], m[abus+2], m[abus+3]} = dbus_in;
        endcase
      end else if (en == 1 &amp;&amp; rw == 1) begin// r_w==1:read
        case (m_size)
        `BYTE:  data = {8'h00  , 8'h00,   8'h00,   m[abus]      };
        `INT16: data = {8'h00  , 8'h00,   m[abus], m[abus+1]    };
        `INT24: data = {8'h00  , m[abus], m[abus+1], m[abus+2]  };
        `INT32: data = {m[abus], m[abus+1], m[abus+2], m[abus+3]};
        endcase
      end else
        data = 32'hZZZZZZZZ;
    end else
      data = 32'hZZZZZZZZ;
  end
  assign dbus_out = data;
endmodule

module main;
  reg clock, reset;
  wire [2:0] tick;
  wire [31:0] pc, ir, mar, mdr, dbus;
  wire m_en, m_rw;
  wire [1:0] m_size;

  cpu0 cpu(.clock(clock), .reset(reset), .pc(pc), .tick(tick), .ir(ir),
  .mar(mar), .mdr(mdr), .dbus(dbus), .m_en(m_en), .m_rw(m_rw), .m_size(m_size));

  memory0 mem(.clock(clock), .reset(reset), .en(m_en), .rw(m_rw), .m_size(m_size), 
  .abus(mar), .dbus_in(mdr), .dbus_out(dbus));

  initial
  begin
    clock = 0;
    reset = 1;
    #20 reset = 0;
    #300000 $finish;
  end

  always #10 clock=clock+1;
endmodule
</pre>
</div>
<div class="highlight-bash"><div class="highlight"><pre>JonathantekiiMac:raw Jonathan<span class="nv">$ </span><span class="nb">pwd</span>
/Users/Jonathan/test/2/lbd/LLVMBackendTutorialExampleCode/cpu0_verilog/raw
JonathantekiiMac:raw Jonathan<span class="nv">$ </span>iverilog -o cpu0s cpu0s.v
</pre></div>
</div>
</div>
<div class="section" id="run-program-on-cpu0-machine">
<h2>Run program on CPU0 machine<a class="headerlink" href="#run-program-on-cpu0-machine" title="Permalink to this headline">¶</a></h2>
<p>Now let&#8217;s compile ch_run_backend.cpp as below. Since code size grows up from low to high
address and stack grows up from high to low address. We set $sp at 0x6ffc because
cpu0s.v use 0x7000 bytes of memory.</p>
<p class="rubric">LLVMBackendTutorialExampleCode/InputFiles/InitRegs.h</p>
<div class="highlight-c++"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">asm</span><span class="p">(</span><span class="s">&quot;addiu $4,	$ZERO, 0&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;addiu $5,	$ZERO, 0&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;addiu $6,	$ZERO, 0&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;addiu $7,	$ZERO, 0&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;addiu $8,	$ZERO, 0&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;addiu $9,	$ZERO, 0&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;addiu $10, $ZERO, 0&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;addiu $11, $ZERO, 0&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;addiu $12, $ZERO, 0&quot;</span><span class="p">);</span>
<span class="k">asm</span><span class="p">(</span><span class="s">&quot;addiu $14, $ZERO, -1&quot;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<p class="rubric">LLVMBackendTutorialExampleCode/InputFiles/ch_run_backend.cpp</p>
<div class="highlight-c++"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127</pre></div></td><td class="code"><div class="highlight"><pre><span class="c1">// /Users/Jonathan/llvm/test/cmake_debug_build/bin/Debug/llvm-objdump -d ch_run_backend.cpu0.o | tail -n +6| awk &#39;{print &quot;/* &quot; $1 &quot; */\t&quot; $2 &quot; &quot; $3 &quot; &quot; $4 &quot; &quot; $5 &quot;\t/* &quot; $6&quot;\t&quot; $7&quot; &quot; $8&quot; &quot; $9&quot; &quot; $10 &quot;\t*/&quot;}&#39; &gt; ../cpu0_verilog/redesign/cpu0s.hex</span>

<span class="cp">#include &lt;stdarg.h&gt;</span>

<span class="cp">#include &quot;InitRegs.h&quot;</span>

<span class="cp">#define OUT_MEM 0x7000 </span><span class="c1">// 28672</span>

<span class="k">asm</span><span class="p">(</span><span class="s">&quot;addiu $sp, $zero, 0x6ffc&quot;</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">print_integer</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">test_operators</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">test_control</span><span class="p">();</span>
<span class="kt">int</span> <span class="n">sum_i</span><span class="p">(</span><span class="kt">int</span> <span class="n">amount</span><span class="p">,</span> <span class="p">...);</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">test_operators</span><span class="p">(</span><span class="mi">12</span><span class="p">);</span> <span class="c1">// a = 13</span>
  <span class="n">print_integer</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
  <span class="n">a</span> <span class="o">+=</span> <span class="n">test_control</span><span class="p">();</span>	<span class="c1">// a = (128+18) = 146</span>
  <span class="n">print_integer</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">sum_i</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
  <span class="n">print_integer</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>    <span class="c1">// a = 15</span>

  <span class="k">return</span> <span class="n">a</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// For memory IO</span>
<span class="kt">void</span> <span class="n">print_integer</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="n">OUT_MEM</span><span class="p">;</span>
  <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
 <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">print1_integer</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">asm</span><span class="p">(</span><span class="s">&quot;ld $at, 8($sp)&quot;</span><span class="p">);</span>
  <span class="k">asm</span><span class="p">(</span><span class="s">&quot;st $at, 28672($0)&quot;</span><span class="p">);</span>
 <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#if 0</span><span class="c"></span>
<span class="c">// For instruction IO</span>
<span class="c">void print2_integer(int x)</span>
<span class="c">{</span>
<span class="c">  asm(&quot;ld $at, 8($sp)&quot;);</span>
<span class="c">  asm(&quot;outw $tat&quot;);</span>
<span class="c">  return;</span>
<span class="c">}</span>
<span class="cp">#endif</span>

<span class="kt">int</span> <span class="n">test_operators</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">o</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">a1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">11</span><span class="p">,</span> <span class="n">k1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">);</span>
  <span class="n">print_integer</span><span class="p">(</span><span class="n">k</span><span class="p">);</span> <span class="c1">// 2</span>
  <span class="n">k1</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">);</span>
  <span class="n">print_integer</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">k1</span><span class="p">);</span> <span class="c1">// 0x3fffffd = 1073741821</span>
  <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
  <span class="n">d</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">;</span>
  <span class="n">e</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">;</span>
  <span class="n">f</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span><span class="p">;</span>
  <span class="n">g</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">&amp;</span> <span class="n">b</span><span class="p">);</span>
  <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">|</span> <span class="n">b</span><span class="p">);</span>
  <span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">^</span> <span class="n">b</span><span class="p">);</span>
  <span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
  <span class="n">l</span> <span class="o">=</span> <span class="n">a</span> <span class="o">%</span> <span class="n">x</span><span class="p">;</span>
  <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">12</span><span class="p">;</span>

  <span class="n">n</span> <span class="o">=</span> <span class="o">!</span><span class="n">a</span><span class="p">;</span>
  <span class="n">print_integer</span><span class="p">(</span><span class="n">n</span><span class="p">);</span> <span class="c1">// 0</span>
  <span class="kt">int</span><span class="o">*</span> <span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">;</span>
  <span class="n">o</span> <span class="o">=</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="n">d</span><span class="o">+</span><span class="n">e</span><span class="o">+</span><span class="n">f</span><span class="o">+</span><span class="n">g</span><span class="o">+</span><span class="n">h</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="n">l</span><span class="o">+</span><span class="n">m</span><span class="o">+</span><span class="n">o</span><span class="p">);</span> <span class="c1">// (13+9+22+5+2+11+9+44+11+0+2)=128</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">test_control</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">d</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">e</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">f</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="n">b</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">b</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">c</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">d</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">e</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">f</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">f</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="n">c</span><span class="o">+</span><span class="n">d</span><span class="o">+</span><span class="n">e</span><span class="o">+</span><span class="n">f</span><span class="p">);</span> <span class="c1">// (2+3+4+4+5)=18</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">sum_i</span><span class="p">(</span><span class="kt">int</span> <span class="n">amount</span><span class="p">,</span> <span class="p">...)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">val</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	
  <span class="n">va_list</span> <span class="n">vl</span><span class="p">;</span>
  <span class="n">va_start</span><span class="p">(</span><span class="n">vl</span><span class="p">,</span> <span class="n">amount</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">amount</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">va_arg</span><span class="p">(</span><span class="n">vl</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
    <span class="n">sum</span> <span class="o">+=</span> <span class="n">val</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">va_end</span><span class="p">(</span><span class="n">vl</span><span class="p">);</span>
  
  <span class="k">return</span> <span class="n">sum</span><span class="p">;</span> 
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-bash"><div class="highlight"><pre>JonathantekiiMac:InputFiles Jonathan<span class="nv">$ </span><span class="nb">pwd</span>
/Users/Jonathan/test/2/lbd/LLVMBackendTutorialExampleCode/InputFiles
JonathantekiiMac:InputFiles Jonathan<span class="nv">$ </span>clang -c ch_run_backend.cpp -emit-llvm -o
ch_run_backend.bc
JonathantekiiMac:InputFiles Jonathan<span class="nv">$ </span>/Users/Jonathan/llvm/test/cmake_debug_
build/bin/Debug/llc -march<span class="o">=</span>cpu0 -relocation-model<span class="o">=</span>static -filetype<span class="o">=</span>obj
ch_run_backend.bc -o ch_run_backend.cpu0.o
JonathantekiiMac:InputFiles Jonathan<span class="nv">$ </span>/Users/Jonathan/llvm/test/cmake_debug_
build/bin/Debug/llvm-objdump -d ch_run_backend.cpu0.o | tail -n +6| awk <span class="s1">&#39;{print &quot;/* &quot;</span>
<span class="s1">$1 &quot; */\t&quot; $2 &quot; &quot; $3 &quot; &quot; $4 &quot; &quot; $5 &quot;\t/* &quot; $6&quot;\t&quot; $7&quot; &quot; $8&quot; &quot; $9&quot; &quot; $10 &quot;\t*/&quot;}&#39;</span>
 &gt; ../cpu0_verilog/raw/cpu0s.hex

118-165-81-39:raw Jonathan<span class="nv">$ </span>cat cpu0s.hex
...
/* 4c: */ 2b 00 00 20 /* jsub 0    */
/* 50: */ 01 2d 00 04 /* st <span class="nv">$2</span>, 4<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>    */
/* 54: */ 2b 00 01 44 /* jsub 0    */
</pre></div>
</div>
<p>As above code the subroutine address for <strong>&#8220;jsub #offset&#8221;</strong> are 0.
This is correct since C language support separate compile and the subroutine
address is decided at link time for static address mode or at
load time for PIC address mode.
Since our backend didn&#8217;t implement the linker and loader, we change the
<strong>&#8220;jsub #offset&#8221;</strong> encode in Chapter10_2/ as follow,</p>
<p class="rubric">LLVMBackendTutorialExampleCode/Chapter10_2/MCTargetDesc/Cpu0MCCodeEmitter.cpp</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="kt">unsigned</span> <span class="n">Cpu0MCCodeEmitter</span><span class="o">::</span>
<span class="n">getJumpTargetOpValue</span><span class="p">(</span><span class="k">const</span> <span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">MI</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">OpNo</span><span class="p">,</span>
           <span class="n">SmallVectorImpl</span><span class="o">&lt;</span><span class="n">MCFixup</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">Fixups</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>

  <span class="kt">unsigned</span> <span class="n">Opcode</span> <span class="o">=</span> <span class="n">MI</span><span class="p">.</span><span class="n">getOpcode</span><span class="p">();</span>
  <span class="p">...</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Opcode</span> <span class="o">==</span> <span class="n">Cpu0</span><span class="o">::</span><span class="n">JSUB</span><span class="p">)</span>
    <span class="n">Fixups</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">MCFixup</span><span class="o">::</span><span class="n">Create</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Expr</span><span class="p">,</span>
                     <span class="n">MCFixupKind</span><span class="p">(</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">fixup_Cpu0_PC24</span><span class="p">)));</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">Opcode</span> <span class="o">==</span> <span class="n">Cpu0</span><span class="o">::</span><span class="n">JSUB</span><span class="p">)</span>
    <span class="n">Fixups</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">MCFixup</span><span class="o">::</span><span class="n">Create</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Expr</span><span class="p">,</span>
                     <span class="n">MCFixupKind</span><span class="p">(</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">fixup_Cpu0_24</span><span class="p">)));</span>
  <span class="k">else</span>
    <span class="n">llvm_unreachable</span><span class="p">(</span><span class="s">&quot;unexpect opcode in getJumpAbsoluteTargetOpValue()&quot;</span><span class="p">);</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We change JSUB from Relocation Records fixup_Cpu0_24 to Non-Relocaton Records
fixup_Cpu0_PC24 as the definition below. This change is fine since if call a
outside defined subroutine, it will add a Relocation Record for this
<strong>&#8220;jsub #offset&#8221;</strong>. At this point, we set it to Non-Relocaton Records for
run on CPU0 Verilog machine. If one day, the CPU0 linker is appeared and the
linker do the sections arrangement, we should adjust it back to Relocation
Records. A good linker will reorder the sections for optimization in
data/function access. In other word,
keep the global variable access as close as possible to reduce cache miss
possibility.</p>
<p class="rubric">LLVMBackendTutorialExampleCode/Chapter10_2/MCTargetDesc/Cpu0AsmBackend.cpp</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">const</span> <span class="n">MCFixupKindInfo</span> <span class="o">&amp;</span><span class="n">getFixupKindInfo</span><span class="p">(</span><span class="n">MCFixupKind</span> <span class="n">Kind</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
  <span class="k">const</span> <span class="k">static</span> <span class="n">MCFixupKindInfo</span> <span class="n">Infos</span><span class="p">[</span><span class="n">Cpu0</span><span class="o">::</span><span class="n">NumTargetFixupKinds</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1">// This table *must* be in same the order of fixup_* kinds in</span>
    <span class="c1">// Cpu0FixupKinds.h.</span>
    <span class="c1">//</span>
    <span class="c1">// name                    offset  bits  flags</span>
    <span class="p">...</span>
    <span class="p">{</span> <span class="s">&quot;fixup_Cpu0_24&quot;</span><span class="p">,</span>           <span class="mi">0</span><span class="p">,</span>     <span class="mi">24</span><span class="p">,</span>   <span class="mi">0</span> <span class="p">},</span>
    <span class="p">...</span>
    <span class="p">{</span> <span class="s">&quot;fixup_Cpu0_PC24&quot;</span><span class="p">,</span>         <span class="mi">0</span><span class="p">,</span>     <span class="mi">24</span><span class="p">,</span>  <span class="n">MCFixupKindInfo</span><span class="o">::</span><span class="n">FKF_IsPCRel</span> <span class="p">},</span>
    <span class="p">...</span>
  <span class="p">}</span>
  <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Let&#8217;s run the Chapter10_2/ with <tt class="docutils literal"><span class="pre">llvm-objdump</span> <span class="pre">-d</span></tt> again, will get the hex file
as follows,</p>
<div class="highlight-bash"><div class="highlight"><pre>JonathantekiiMac:InputFiles Jonathan<span class="nv">$ </span><span class="nb">pwd</span>
/Users/Jonathan/test/2/lbd/LLVMBackendTutorialExampleCode/InputFiles
JonathantekiiMac:InputFiles Jonathan<span class="nv">$ </span>clang -c ch_run_backend.cpp -emit-llvm -o
ch_run_backend.bc
JonathantekiiMac:InputFiles Jonathan<span class="nv">$ </span>/Users/Jonathan/llvm/test/cmake_debug_
build/bin/Debug/llc -march<span class="o">=</span>cpu0 -relocation-model<span class="o">=</span>static -filetype<span class="o">=</span>obj
ch_run_backend.bc -o ch_run_backend.cpu0.o
JonathantekiiMac:InputFiles Jonathan<span class="nv">$ </span>/Users/Jonathan/llvm/test/cmake_debug_
build/bin/Debug/llvm-objdump -d ch_run_backend.cpu0.o | tail -n +6| awk <span class="s1">&#39;{print &quot;/* &quot;</span>
<span class="s1">$1 &quot; */\t&quot; $2 &quot; &quot; $3 &quot; &quot; $4 &quot; &quot; $5 &quot;\t/* &quot; $6&quot;\t&quot; $7&quot; &quot; $8&quot; &quot; $9&quot; &quot; $10 &quot;\t*/&quot;}&#39;</span>
 &gt; ../cpu0_verilog/raw/cpu0s.hex
</pre></div>
</div>
<div class="highlight-c++"><pre>118-165-75-55:raw Jonathan$ cat cpu0s.hex
/* 0: */  09 10 00 00 /* addiu  $1, $zero, 0  */
/* 4: */  09 20 00 00 /* addiu  $2, $zero, 0  */
/* 8: */  09 30 00 00 /* addiu  $3, $zero, 0  */
/* c: */  09 40 00 00 /* addiu  $4, $zero, 0  */
/* 10: */ 09 50 00 00 /* addiu  $5, $zero, 0  */
/* 14: */ 09 60 00 00 /* addiu  $t9, $zero, 0   */
/* 18: */ 09 70 00 00 /* addiu  $7, $zero, 0  */
/* 1c: */ 09 80 00 00 /* addiu  $8, $zero, 0  */
/* 20: */ 09 90 00 00 /* addiu  $9, $zero, 0  */
/* 24: */ 09 a0 00 00 /* addiu  $gp, $zero, 0   */
/* 28: */ 09 b0 00 00 /* addiu  $fp, $zero, 0   */
/* 2c: */ 09 c0 00 00 /* addiu  $sw, $zero, 0   */
/* 30: */ 09 e0 ff ff /* addiu  $lr, $zero, -1  */
/* 34: */ 09 d0 6f fc /* addiu  $sp, $zero, 28668   */
/*  */      /*      */
/* main: */     /*      */
/* 38: */ 09 dd ff b0 /* addiu  $sp, $sp, -80   */
/* 3c: */ 02 ed 00 4c /* st $lr, 76($sp)    */
/* 40: */ 02 7d 00 48 /* st $7, 72($sp)   */
/* 44: */ 09 70 00 00 /* addiu  $7, $zero, 0  */
/* 48: */ 02 7d 00 44 /* st $7, 68($sp)   */
/* 4c: */ 02 7d 00 40 /* st $7, 64($sp)   */
/* 50: */ 09 20 00 0c /* addiu  $2, $zero, 12   */
/* 54: */ 02 2d 00 00 /* st $2, 0($sp)    */
/* 58: */ 2b 00 00 7c /* jsub 124     */
/* 5c: */ 02 2d 00 40 /* st $2, 64($sp)   */
/* 60: */ 02 2d 00 00 /* st $2, 0($sp)    */
/* 64: */ 2b 00 02 28 /* jsub 552     */
/* 68: */ 2b 00 02 48 /* jsub 584     */
/* 6c: */ 01 3d 00 40 /* ld $3, 64($sp)   */
/* 70: */ 11 23 20 00 /* addu $2, $3, $2  */
/* 74: */ 02 2d 00 40 /* st $2, 64($sp)   */
/* 78: */ 02 2d 00 00 /* st $2, 0($sp)    */
/* 7c: */ 2b 00 02 10 /* jsub 528     */
/* 80: */ 09 20 00 05 /* addiu  $2, $zero, 5  */
/* 84: */ 02 2d 00 18 /* st $2, 24($sp)   */
/* 88: */ 09 20 00 04 /* addiu  $2, $zero, 4  */
/* 8c: */ 02 2d 00 14 /* st $2, 20($sp)   */
/* 90: */ 09 20 00 03 /* addiu  $2, $zero, 3  */
/* 94: */ 02 2d 00 10 /* st $2, 16($sp)   */
/* 98: */ 09 20 00 02 /* addiu  $2, $zero, 2  */
/* 9c: */ 02 2d 00 0c /* st $2, 12($sp)   */
/* a0: */ 09 20 00 01 /* addiu  $2, $zero, 1  */
/* a4: */ 02 2d 00 08 /* st $2, 8($sp)    */
/* a8: */ 02 7d 00 04 /* st $7, 4($sp)    */
/* ac: */ 09 20 00 06 /* addiu  $2, $zero, 6  */
/* b0: */ 02 2d 00 00 /* st $2, 0($sp)    */
/* b4: */ 2b 00 02 d4 /* jsub 724     */
/* b8: */ 02 2d 00 40 /* st $2, 64($sp)   */
/* bc: */ 02 2d 00 00 /* st $2, 0($sp)    */
/* c0: */ 2b 00 01 cc /* jsub 460     */
/* c4: */ 01 2d 00 40 /* ld $2, 64($sp)   */
/* c8: */ 01 7d 00 48 /* ld $7, 72($sp)   */
/* cc: */ 01 ed 00 4c /* ld $lr, 76($sp)    */
/* d0: */ 09 dd 00 50 /* addiu  $sp, $sp, 80  */
/* d4: */ 2c e0 00 00 /* ret  $lr     */
/*  */      /*      */
/* _Z14test_operatorsi: */      /*      */
/* d8: */ 09 dd ff 98 /* addiu  $sp, $sp, -104  */
/* dc: */ 02 ed 00 64 /* st $lr, 100($sp)   */
/* e0: */ 02 7d 00 60 /* st $7, 96($sp)   */
/* e4: */ 01 2d 00 68 /* ld $2, 104($sp)    */
/* e8: */ 02 2d 00 5c /* st $2, 92($sp)   */
/* ec: */ 09 20 00 0b /* addiu  $2, $zero, 11   */
/* f0: */ 02 2d 00 58 /* st $2, 88($sp)   */
/* f4: */ 09 20 00 02 /* addiu  $2, $zero, 2  */
/* f8: */ 02 2d 00 54 /* st $2, 84($sp)   */
/* fc: */ 09 20 ff f5 /* addiu  $2, $zero, -11  */
/* 100: */  02 2d 00 1c /* st $2, 28($sp)   */
/* 104: */  09 70 00 00 /* addiu  $7, $zero, 0  */
/* 108: */  02 7d 00 18 /* st $7, 24($sp)   */
/* 10c: */  01 2d 00 58 /* ld $2, 88($sp)   */
/* 110: */  1b 22 00 02 /* sra  $2, $2, 2   */
/* 114: */  02 2d 00 30 /* st $2, 48($sp)   */
/* 118: */  02 2d 00 00 /* st $2, 0($sp)    */
/* 11c: */  2b 00 01 70 /* jsub 368     */
/* 120: */  01 2d 00 1c /* ld $2, 28($sp)   */
/* 124: */  1f 22 00 02 /* shr  $2, $2, 2   */
/* 128: */  02 2d 00 18 /* st $2, 24($sp)   */
/* 12c: */  02 2d 00 00 /* st $2, 0($sp)    */
/* 130: */  2b 00 01 5c /* jsub 348     */
/* 134: */  01 2d 00 54 /* ld $2, 84($sp)   */
/* 138: */  01 3d 00 58 /* ld $3, 88($sp)   */
/* 13c: */  11 23 20 00 /* addu $2, $3, $2  */
/* 140: */  02 2d 00 50 /* st $2, 80($sp)   */
/* 144: */  01 2d 00 54 /* ld $2, 84($sp)   */
/* 148: */  01 3d 00 58 /* ld $3, 88($sp)   */
/* 14c: */  14 23 20 00 /* sub  $2, $3, $2  */
/* 150: */  02 2d 00 4c /* st $2, 76($sp)   */
/* 154: */  01 2d 00 54 /* ld $2, 84($sp)   */
/* 158: */  01 3d 00 58 /* ld $3, 88($sp)   */
/* 15c: */  15 23 20 00 /* mul  $2, $3, $2  */
/* 160: */  02 2d 00 48 /* st $2, 72($sp)   */
/* 164: */  01 2d 00 54 /* ld $2, 84($sp)   */
/* 168: */  01 3d 00 58 /* ld $3, 88($sp)   */
/* 16c: */  16 32 00 00 /* div  $3, $2    */
/* 170: */  41 20 00 00 /* mflo $2    */
/* 174: */  02 2d 00 44 /* st $2, 68($sp)   */
/* 178: */  01 2d 00 54 /* ld $2, 84($sp)   */
/* 17c: */  01 3d 00 58 /* ld $3, 88($sp)   */
/* 180: */  18 23 20 00 /* and  $2, $3, $2  */
/* 184: */  02 2d 00 40 /* st $2, 64($sp)   */
/* 188: */  01 2d 00 54 /* ld $2, 84($sp)   */
/* 18c: */  01 3d 00 58 /* ld $3, 88($sp)   */
/* 190: */  19 23 20 00 /* or $2, $3, $2  */
/* 194: */  02 2d 00 3c /* st $2, 60($sp)   */
/* 198: */  01 2d 00 54 /* ld $2, 84($sp)   */
/* 19c: */  01 3d 00 58 /* ld $3, 88($sp)   */
/* 1a0: */  1a 23 20 00 /* xor  $2, $3, $2  */
/* 1a4: */  02 2d 00 38 /* st $2, 56($sp)   */
/* 1a8: */  01 2d 00 58 /* ld $2, 88($sp)   */
/* 1ac: */  1e 22 00 02 /* shl  $2, $2, 2   */
/* 1b0: */  02 2d 00 34 /* st $2, 52($sp)   */
/* 1b4: */  01 2d 00 5c /* ld $2, 92($sp)   */
/* 1b8: */  01 3d 00 58 /* ld $3, 88($sp)   */
/* 1bc: */  16 32 00 00 /* div  $3, $2    */
/* 1c0: */  40 20 00 00 /* mfhi $2    */
/* 1c4: */  02 2d 00 2c /* st $2, 44($sp)   */
/* 1c8: */  09 20 2a aa /* addiu  $2, $zero, 10922  */
/* 1cc: */  1e 22 00 10 /* shl  $2, $2, 16  */
/* 1d0: */  0d 32 aa ab /* ori  $3, $2, 43691   */
/* 1d4: */  01 2d 00 58 /* ld $2, 88($sp)   */
/* 1d8: */  09 22 00 01 /* addiu  $2, $2, 1   */
/* 1dc: */  50 23 00 00 /* mult $2, $3    */
/* 1e0: */  40 30 00 00 /* mfhi $3    */
/* 1e4: */  1f 43 00 1f /* shr  $4, $3, 31  */
/* 1e8: */  1b 33 00 01 /* sra  $3, $3, 1   */
/* 1ec: */  11 33 40 00 /* addu $3, $3, $4  */
/* 1f0: */  09 40 00 0c /* addiu  $4, $zero, 12   */
/* 1f4: */  15 33 40 00 /* mul  $3, $3, $4  */
/* 1f8: */  14 22 30 00 /* sub  $2, $2, $3  */
/* 1fc: */  02 2d 00 28 /* st $2, 40($sp)   */
/* 200: */  01 2d 00 58 /* ld $2, 88($sp)   */
/* 204: */  1a 22 70 00 /* xor  $2, $2, $7  */
/* 208: */  09 30 00 01 /* addiu  $3, $zero, 1  */
/* 20c: */  1a 22 30 00 /* xor  $2, $2, $3  */
/* 210: */  18 22 30 00 /* and  $2, $2, $3  */
/* 214: */  02 2d 00 24 /* st $2, 36($sp)   */
/* 218: */  02 2d 00 00 /* st $2, 0($sp)    */
/* 21c: */  2b 00 00 70 /* jsub 112     */
/* 220: */  09 2d 00 54 /* addiu  $2, $sp, 84   */
/* 224: */  02 2d 00 14 /* st $2, 20($sp)   */
/* 228: */  01 2d 00 54 /* ld $2, 84($sp)   */
/* 22c: */  02 2d 00 20 /* st $2, 32($sp)   */
/* 230: */  01 3d 00 4c /* ld $3, 76($sp)   */
/* 234: */  01 4d 00 50 /* ld $4, 80($sp)   */
/* 238: */  11 34 30 00 /* addu $3, $4, $3  */
/* 23c: */  01 4d 00 48 /* ld $4, 72($sp)   */
/* 240: */  11 33 40 00 /* addu $3, $3, $4  */
/* 244: */  01 4d 00 44 /* ld $4, 68($sp)   */
/* 248: */  11 33 40 00 /* addu $3, $3, $4  */
/* 24c: */  01 4d 00 40 /* ld $4, 64($sp)   */
/* 250: */  11 33 40 00 /* addu $3, $3, $4  */
/* 254: */  01 4d 00 3c /* ld $4, 60($sp)   */
/* 258: */  11 33 40 00 /* addu $3, $3, $4  */
/* 25c: */  01 4d 00 38 /* ld $4, 56($sp)   */
/* 260: */  11 33 40 00 /* addu $3, $3, $4  */
/* 264: */  01 4d 00 34 /* ld $4, 52($sp)   */
/* 268: */  11 33 40 00 /* addu $3, $3, $4  */
/* 26c: */  01 4d 00 2c /* ld $4, 44($sp)   */
/* 270: */  11 33 40 00 /* addu $3, $3, $4  */
/* 274: */  01 4d 00 28 /* ld $4, 40($sp)   */
/* 278: */  11 33 40 00 /* addu $3, $3, $4  */
/* 27c: */  11 23 20 00 /* addu $2, $3, $2  */
/* 280: */  01 7d 00 60 /* ld $7, 96($sp)   */
/* 284: */  01 ed 00 64 /* ld $lr, 100($sp)   */
/* 288: */  09 dd 00 68 /* addiu  $sp, $sp, 104   */
/* 28c: */  2c e0 00 00 /* ret  $lr     */
/*  */      /*      */
/* _Z13print_integeri: */     /*      */
/* 290: */  09 dd ff f8 /* addiu  $sp, $sp, -8  */
/* 294: */  01 2d 00 08 /* ld $2, 8($sp)    */
/* 298: */  02 2d 00 04 /* st $2, 4($sp)    */
/* 29c: */  09 20 70 00 /* addiu  $2, $zero, 28672  */
/* 2a0: */  02 2d 00 00 /* st $2, 0($sp)    */
/* 2a4: */  01 3d 00 04 /* ld $3, 4($sp)    */
/* 2a8: */  02 32 00 00 /* st $3, 0($2)   */
/* 2ac: */  09 dd 00 08 /* addiu  $sp, $sp, 8   */
/* 2b0: */  2c e0 00 00 /* ret  $lr     */
/*  */      /*      */
/* _Z12test_controlv: */      /*      */
/* 2b4: */  09 dd ff e8 /* addiu  $sp, $sp, -24   */
/* 2b8: */  09 30 00 01 /* addiu  $3, $zero, 1  */
/* 2bc: */  02 3d 00 14 /* st $3, 20($sp)   */
/* 2c0: */  09 20 00 02 /* addiu  $2, $zero, 2  */
/* 2c4: */  02 2d 00 10 /* st $2, 16($sp)   */
/* 2c8: */  09 20 00 03 /* addiu  $2, $zero, 3  */
/* 2cc: */  02 2d 00 0c /* st $2, 12($sp)   */
/* 2d0: */  09 20 00 04 /* addiu  $2, $zero, 4  */
/* 2d4: */  02 2d 00 08 /* st $2, 8($sp)    */
/* 2d8: */  09 20 00 05 /* addiu  $2, $zero, 5  */
/* 2dc: */  02 2d 00 04 /* st $2, 4($sp)    */
/* 2e0: */  09 20 00 00 /* addiu  $2, $zero, 0  */
/* 2e4: */  01 4d 00 14 /* ld $4, 20($sp)   */
/* 2e8: */  10 42 00 00 /* cmp  $zero, $4, $2   */
/* 2ec: */  20 00 00 0c /* jeq  $zero, 12   */
/* 2f0: */  01 4d 00 14 /* ld $4, 20($sp)   */
/* 2f4: */  09 44 00 01 /* addiu  $4, $4, 1   */
/* 2f8: */  02 4d 00 14 /* st $4, 20($sp)   */
/* 2fc: */  01 4d 00 10 /* ld $4, 16($sp)   */
/* 300: */  10 43 00 00 /* cmp  $zero, $4, $3   */
/* 304: */  22 00 00 0c /* jlt  $zero, 12   */
/* 308: */  01 3d 00 10 /* ld $3, 16($sp)   */
/* 30c: */  09 33 00 01 /* addiu  $3, $3, 1   */
/* 310: */  02 3d 00 10 /* st $3, 16($sp)   */
/* 314: */  01 3d 00 0c /* ld $3, 12($sp)   */
/* 318: */  10 32 00 00 /* cmp  $zero, $3, $2   */
/* 31c: */  22 00 00 0c /* jlt  $zero, 12   */
/* 320: */  01 3d 00 0c /* ld $3, 12($sp)   */
/* 324: */  09 33 00 01 /* addiu  $3, $3, 1   */
/* 328: */  02 3d 00 0c /* st $3, 12($sp)   */
/* 32c: */  09 30 ff ff /* addiu  $3, $zero, -1   */
/* 330: */  01 4d 00 08 /* ld $4, 8($sp)    */
/* 334: */  10 43 00 00 /* cmp  $zero, $4, $3   */
/* 338: */  23 00 00 0c /* jgt  $zero, 12   */
/* 33c: */  01 3d 00 08 /* ld $3, 8($sp)    */
/* 340: */  09 33 00 01 /* addiu  $3, $3, 1   */
/* 344: */  02 3d 00 08 /* st $3, 8($sp)    */
/* 348: */  01 3d 00 04 /* ld $3, 4($sp)    */
/* 34c: */  10 32 00 00 /* cmp  $zero, $3, $2   */
/* 350: */  23 00 00 0c /* jgt  $zero, 12   */
/* 354: */  01 2d 00 04 /* ld $2, 4($sp)    */
/* 358: */  09 22 00 01 /* addiu  $2, $2, 1   */
/* 35c: */  02 2d 00 04 /* st $2, 4($sp)    */
/* 360: */  01 2d 00 10 /* ld $2, 16($sp)   */
/* 364: */  01 3d 00 14 /* ld $3, 20($sp)   */
/* 368: */  11 23 20 00 /* addu $2, $3, $2  */
/* 36c: */  01 3d 00 0c /* ld $3, 12($sp)   */
/* 370: */  11 22 30 00 /* addu $2, $2, $3  */
/* 374: */  01 3d 00 08 /* ld $3, 8($sp)    */
/* 378: */  11 22 30 00 /* addu $2, $2, $3  */
/* 37c: */  01 3d 00 04 /* ld $3, 4($sp)    */
/* 380: */  11 22 30 00 /* addu $2, $2, $3  */
/* 384: */  09 dd 00 18 /* addiu  $sp, $sp, 24  */
/* 388: */  2c e0 00 00 /* ret  $lr     */
/*  */      /*      */
/* _Z5sum_iiz: */     /*      */
/* 38c: */  09 dd ff e8 /* addiu  $sp, $sp, -24   */
/* 390: */  01 2d 00 18 /* ld $2, 24($sp)   */
/* 394: */  02 2d 00 14 /* st $2, 20($sp)   */
/* 398: */  09 20 00 00 /* addiu  $2, $zero, 0  */
/* 39c: */  02 2d 00 10 /* st $2, 16($sp)   */
/* 3a0: */  02 2d 00 0c /* st $2, 12($sp)   */
/* 3a4: */  02 2d 00 08 /* st $2, 8($sp)    */
/* 3a8: */  09 3d 00 1c /* addiu  $3, $sp, 28   */
/* 3ac: */  02 3d 00 04 /* st $3, 4($sp)    */
/* 3b0: */  02 2d 00 10 /* st $2, 16($sp)   */
/* 3b4: */  01 2d 00 14 /* ld $2, 20($sp)   */
/* 3b8: */  01 3d 00 10 /* ld $3, 16($sp)   */
/* 3bc: */  10 32 00 00 /* cmp  $zero, $3, $2   */
/* 3c0: */  25 00 00 30 /* jge  $zero, 48   */
/* 3c4: */  01 2d 00 04 /* ld $2, 4($sp)    */
/* 3c8: */  09 32 00 04 /* addiu  $3, $2, 4   */
/* 3cc: */  02 3d 00 04 /* st $3, 4($sp)    */
/* 3d0: */  01 22 00 00 /* ld $2, 0($2)   */
/* 3d4: */  02 2d 00 0c /* st $2, 12($sp)   */
/* 3d8: */  01 3d 00 08 /* ld $3, 8($sp)    */
/* 3dc: */  11 23 20 00 /* addu $2, $3, $2  */
/* 3e0: */  02 2d 00 08 /* st $2, 8($sp)    */
/* 3e4: */  01 2d 00 10 /* ld $2, 16($sp)   */
/* 3e8: */  09 22 00 01 /* addiu  $2, $2, 1   */
/* 3ec: */  02 2d 00 10 /* st $2, 16($sp)   */
/* 3f0: */  26 ff ff c0 /* jmp  -64     */
/* 3f4: */  01 2d 00 08 /* ld $2, 8($sp)    */
/* 3f8: */  09 dd 00 18 /* addiu  $sp, $sp, 24  */
/* 3fc: */  2c e0 00 00 /* ret  $lr     */
/*  */      /*      */
/* _Z14print1_integeri: */      /*      */
/* 400: */  09 dd ff f8 /* addiu  $sp, $sp, -8  */
/* 404: */  01 2d 00 08 /* ld $2, 8($sp)    */
/* 408: */  02 2d 00 04 /* st $2, 4($sp)    */
/* 40c: */  01 1d 00 08 /* ld $1, 8($sp)    */
/* 410: */  02 10 70 00 /* st $1, 28672($zero)    */
/* 414: */  09 dd 00 08 /* addiu  $sp, $sp, 8   */
/* 418: */  2c e0 00 00 /* ret  $lr     */</pre>
</div>
<p>From above result, you can find the print_integer() which implemented by C
language has 8 instructions while the print1_integer() which implemented by
assembly has 6 instructions. But the C version is better in portability since
the assembly is binding with machine assembly language and make the
assumption that the stack size of print1_integer() is 8.
Now, run the cpu0 backend to get the result as follows,</p>
<div class="highlight-bash"><div class="highlight"><pre>118-165-75-55:raw Jonathan<span class="nv">$ </span>./cpu0s
WARNING: cpu0s.v:224: <span class="nv">$readmemh</span><span class="o">(</span>cpu0s.hex<span class="o">)</span>: Not enough words in the file <span class="k">for </span>the requested range <span class="o">[</span>0:28671<span class="o">]</span>.
00000000: 09100000
00000004: 09200000
...
00000418: 2ce00000
  90ns 00000000 : 09100000 R<span class="o">[</span>01<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
 170ns 00000004 : 09200000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
 250ns 00000008 : 09300000 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
 330ns 0000000c : 09400000 R<span class="o">[</span>04<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
 410ns 00000010 : 09500000 R<span class="o">[</span>05<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
 490ns 00000014 : 09600000 R<span class="o">[</span>06<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
 570ns 00000018 : 09700000 R<span class="o">[</span>07<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
 650ns 0000001c : 09800000 R<span class="o">[</span>08<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
 730ns 00000020 : 09900000 R<span class="o">[</span>09<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
 810ns 00000024 : 09a00000 R<span class="o">[</span>10<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
 890ns 00000028 : 09b00000 R<span class="o">[</span>11<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
 970ns 0000002c : 09c00000 R<span class="o">[</span>12<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
1050ns 00000030 : 09e0ffff R<span class="o">[</span>14<span class="o">]=</span><span class="nv">ffffffff</span><span class="o">=</span>-1         <span class="nv">SW</span><span class="o">=</span>00000000
1130ns 00000034 : 09d06ffc R<span class="o">[</span>13<span class="o">]=</span><span class="nv">00006ffc</span><span class="o">=</span>28668      <span class="nv">SW</span><span class="o">=</span>00000000
1210ns 00000038 : 09ddffb0 R<span class="o">[</span>13<span class="o">]=</span><span class="nv">00006fac</span><span class="o">=</span>28588      <span class="nv">SW</span><span class="o">=</span>00000000
1290ns 0000003c : 02ed004c m<span class="o">[</span>28588+76  <span class="o">]=</span>-1          <span class="nv">SW</span><span class="o">=</span>00000000
1370ns 00000040 : 027d0048 m<span class="o">[</span>28588+72  <span class="o">]=</span>0           <span class="nv">SW</span><span class="o">=</span>00000000
1450ns 00000044 : 09700000 R<span class="o">[</span>07<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
1530ns 00000048 : 027d0044 m<span class="o">[</span>28588+68  <span class="o">]=</span>0           <span class="nv">SW</span><span class="o">=</span>00000000
1610ns 0000004c : 027d0040 m<span class="o">[</span>28588+64  <span class="o">]=</span>0           <span class="nv">SW</span><span class="o">=</span>00000000
1690ns 00000050 : 0920000c R<span class="o">[</span>02<span class="o">]=</span><span class="nv">0000000c</span><span class="o">=</span>12         <span class="nv">SW</span><span class="o">=</span>00000000
1770ns 00000054 : 022d0000 m<span class="o">[</span>28588+0   <span class="o">]=</span>12          <span class="nv">SW</span><span class="o">=</span>00000000
1850ns 00000058 : 2b00007c R<span class="o">[</span>00<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
1930ns 000000d8 : 09ddff98 R<span class="o">[</span>13<span class="o">]=</span><span class="nv">00006f44</span><span class="o">=</span>28484      <span class="nv">SW</span><span class="o">=</span>00000000
2010ns 000000dc : 02ed0064 m<span class="o">[</span>28484+100 <span class="o">]=</span>92          <span class="nv">SW</span><span class="o">=</span>00000000
2090ns 000000e0 : 027d0060 m<span class="o">[</span>28484+96  <span class="o">]=</span>0           <span class="nv">SW</span><span class="o">=</span>00000000
2170ns 000000e4 : 012d0068 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">0000000c</span><span class="o">=</span>12         <span class="nv">SW</span><span class="o">=</span>00000000
2250ns 000000e8 : 022d005c m<span class="o">[</span>28484+92  <span class="o">]=</span>12          <span class="nv">SW</span><span class="o">=</span>00000000
2330ns 000000ec : 0920000b R<span class="o">[</span>02<span class="o">]=</span><span class="nv">0000000b</span><span class="o">=</span>11         <span class="nv">SW</span><span class="o">=</span>00000000
2410ns 000000f0 : 022d0058 m<span class="o">[</span>28484+88  <span class="o">]=</span>11          <span class="nv">SW</span><span class="o">=</span>00000000
2490ns 000000f4 : 09200002 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000002</span><span class="o">=</span>2          <span class="nv">SW</span><span class="o">=</span>00000000
2570ns 000000f8 : 022d0054 m<span class="o">[</span>28484+84  <span class="o">]=</span>2           <span class="nv">SW</span><span class="o">=</span>00000000
2650ns 000000fc : 0920fff5 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">fffffff5</span><span class="o">=</span>-11        <span class="nv">SW</span><span class="o">=</span>00000000
2730ns 00000100 : 022d001c m<span class="o">[</span>28484+28  <span class="o">]=</span>-11         <span class="nv">SW</span><span class="o">=</span>00000000
2810ns 00000104 : 09700000 R<span class="o">[</span>07<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
2890ns 00000108 : 027d0018 m<span class="o">[</span>28484+24  <span class="o">]=</span>0           <span class="nv">SW</span><span class="o">=</span>00000000
2970ns 0000010c : 012d0058 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">0000000b</span><span class="o">=</span>11         <span class="nv">SW</span><span class="o">=</span>00000000
3050ns 00000110 : 1b220002 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000002</span><span class="o">=</span>2          <span class="nv">SW</span><span class="o">=</span>00000000
3130ns 00000114 : 022d0030 m<span class="o">[</span>28484+48  <span class="o">]=</span>2           <span class="nv">SW</span><span class="o">=</span>00000000
3210ns 00000118 : 022d0000 m<span class="o">[</span>28484+0   <span class="o">]=</span>2           <span class="nv">SW</span><span class="o">=</span>00000000
3290ns 0000011c : 2b000170 R<span class="o">[</span>00<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
3370ns 00000290 : 09ddfff8 R<span class="o">[</span>13<span class="o">]=</span><span class="nv">00006f3c</span><span class="o">=</span>28476      <span class="nv">SW</span><span class="o">=</span>00000000
3450ns 00000294 : 012d0008 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000002</span><span class="o">=</span>2          <span class="nv">SW</span><span class="o">=</span>00000000
3530ns 00000298 : 022d0004 m<span class="o">[</span>28476+4   <span class="o">]=</span>2           <span class="nv">SW</span><span class="o">=</span>00000000
3610ns 0000029c : 09207000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00007000</span><span class="o">=</span>28672      <span class="nv">SW</span><span class="o">=</span>00000000
3690ns 000002a0 : 022d0000 m<span class="o">[</span>28476+0   <span class="o">]=</span>28672       <span class="nv">SW</span><span class="o">=</span>00000000
3770ns 000002a4 : 013d0004 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000002</span><span class="o">=</span>2          <span class="nv">SW</span><span class="o">=</span>00000000
3850ns 000002a8 : 02320000 <span class="nv">OUTPUT</span><span class="o">=</span>2
3930ns 000002ac : 09dd0008 R<span class="o">[</span>13<span class="o">]=</span><span class="nv">00006f44</span><span class="o">=</span>28484      <span class="nv">SW</span><span class="o">=</span>00000000
4010ns 000002b0 : 2ce00000 R<span class="o">[</span>14<span class="o">]=</span><span class="nv">00000120</span><span class="o">=</span>288        <span class="nv">SW</span><span class="o">=</span>00000000
4090ns 00000120 : 012d001c R<span class="o">[</span>02<span class="o">]=</span><span class="nv">fffffff5</span><span class="o">=</span>-11        <span class="nv">SW</span><span class="o">=</span>00000000
4170ns 00000124 : 1f220002 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">3ffffffd</span><span class="o">=</span>1073741821 <span class="nv">SW</span><span class="o">=</span>00000000
4250ns 00000128 : 022d0018 m<span class="o">[</span>28484+24  <span class="o">]=</span>1073741821  <span class="nv">SW</span><span class="o">=</span>00000000
4330ns 0000012c : 022d0000 m<span class="o">[</span>28484+0   <span class="o">]=</span>1073741821  <span class="nv">SW</span><span class="o">=</span>00000000
4410ns 00000130 : 2b00015c R<span class="o">[</span>00<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
4490ns 00000290 : 09ddfff8 R<span class="o">[</span>13<span class="o">]=</span><span class="nv">00006f3c</span><span class="o">=</span>28476      <span class="nv">SW</span><span class="o">=</span>00000000
4570ns 00000294 : 012d0008 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">3ffffffd</span><span class="o">=</span>1073741821 <span class="nv">SW</span><span class="o">=</span>00000000
4650ns 00000298 : 022d0004 m<span class="o">[</span>28476+4   <span class="o">]=</span>1073741821  <span class="nv">SW</span><span class="o">=</span>00000000
4730ns 0000029c : 09207000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00007000</span><span class="o">=</span>28672      <span class="nv">SW</span><span class="o">=</span>00000000
4810ns 000002a0 : 022d0000 m<span class="o">[</span>28476+0   <span class="o">]=</span>28672       <span class="nv">SW</span><span class="o">=</span>00000000
4890ns 000002a4 : 013d0004 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">3ffffffd</span><span class="o">=</span>1073741821 <span class="nv">SW</span><span class="o">=</span>00000000
4970ns 000002a8 : 02320000 <span class="nv">OUTPUT</span><span class="o">=</span>1073741821
5050ns 000002ac : 09dd0008 R<span class="o">[</span>13<span class="o">]=</span><span class="nv">00006f44</span><span class="o">=</span>28484      <span class="nv">SW</span><span class="o">=</span>00000000
5130ns 000002b0 : 2ce00000 R<span class="o">[</span>14<span class="o">]=</span><span class="nv">00000134</span><span class="o">=</span>308        <span class="nv">SW</span><span class="o">=</span>00000000
5210ns 00000134 : 012d0054 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000002</span><span class="o">=</span>2          <span class="nv">SW</span><span class="o">=</span>00000000
5290ns 00000138 : 013d0058 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">0000000b</span><span class="o">=</span>11         <span class="nv">SW</span><span class="o">=</span>00000000
5370ns 0000013c : 11232000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">0000000d</span><span class="o">=</span>13         <span class="nv">SW</span><span class="o">=</span>00000000
5450ns 00000140 : 022d0050 m<span class="o">[</span>28484+80  <span class="o">]=</span>13          <span class="nv">SW</span><span class="o">=</span>00000000
5530ns 00000144 : 012d0054 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000002</span><span class="o">=</span>2          <span class="nv">SW</span><span class="o">=</span>00000000
5610ns 00000148 : 013d0058 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">0000000b</span><span class="o">=</span>11         <span class="nv">SW</span><span class="o">=</span>00000000
5690ns 0000014c : 14232000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000009</span><span class="o">=</span>9          <span class="nv">SW</span><span class="o">=</span>00000000
5770ns 00000150 : 022d004c m<span class="o">[</span>28484+76  <span class="o">]=</span>9           <span class="nv">SW</span><span class="o">=</span>00000000
5850ns 00000154 : 012d0054 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000002</span><span class="o">=</span>2          <span class="nv">SW</span><span class="o">=</span>00000000
5930ns 00000158 : 013d0058 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">0000000b</span><span class="o">=</span>11         <span class="nv">SW</span><span class="o">=</span>00000000
6010ns 0000015c : 15232000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000016</span><span class="o">=</span>22         <span class="nv">SW</span><span class="o">=</span>00000000
6090ns 00000160 : 022d0048 m<span class="o">[</span>28484+72  <span class="o">]=</span>22          <span class="nv">SW</span><span class="o">=</span>00000000
6170ns 00000164 : 012d0054 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000002</span><span class="o">=</span>2          <span class="nv">SW</span><span class="o">=</span>00000000
6250ns 00000168 : 013d0058 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">0000000b</span><span class="o">=</span>11         <span class="nv">SW</span><span class="o">=</span>00000000
6330ns 0000016c : 16320000 <span class="nv">HI</span><span class="o">=</span>00000001 <span class="nv">LO</span><span class="o">=</span>00000005 <span class="nv">SW</span><span class="o">=</span>00000000
6410ns 00000170 : 41200000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000005</span><span class="o">=</span>5          <span class="nv">SW</span><span class="o">=</span>00000000
6490ns 00000174 : 022d0044 m<span class="o">[</span>28484+68  <span class="o">]=</span>5           <span class="nv">SW</span><span class="o">=</span>00000000
6570ns 00000178 : 012d0054 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000002</span><span class="o">=</span>2          <span class="nv">SW</span><span class="o">=</span>00000000
6650ns 0000017c : 013d0058 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">0000000b</span><span class="o">=</span>11         <span class="nv">SW</span><span class="o">=</span>00000000
6730ns 00000180 : 18232000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000002</span><span class="o">=</span>2          <span class="nv">SW</span><span class="o">=</span>00000000
6810ns 00000184 : 022d0040 m<span class="o">[</span>28484+64  <span class="o">]=</span>2           <span class="nv">SW</span><span class="o">=</span>00000000
6890ns 00000188 : 012d0054 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000002</span><span class="o">=</span>2          <span class="nv">SW</span><span class="o">=</span>00000000
6970ns 0000018c : 013d0058 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">0000000b</span><span class="o">=</span>11         <span class="nv">SW</span><span class="o">=</span>00000000
7050ns 00000190 : 19232000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">0000000b</span><span class="o">=</span>11         <span class="nv">SW</span><span class="o">=</span>00000000
7130ns 00000194 : 022d003c m<span class="o">[</span>28484+60  <span class="o">]=</span>11          <span class="nv">SW</span><span class="o">=</span>00000000
7210ns 00000198 : 012d0054 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000002</span><span class="o">=</span>2          <span class="nv">SW</span><span class="o">=</span>00000000
7290ns 0000019c : 013d0058 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">0000000b</span><span class="o">=</span>11         <span class="nv">SW</span><span class="o">=</span>00000000
7370ns 000001a0 : 1a232000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000009</span><span class="o">=</span>9          <span class="nv">SW</span><span class="o">=</span>00000000
7450ns 000001a4 : 022d0038 m<span class="o">[</span>28484+56  <span class="o">]=</span>9           <span class="nv">SW</span><span class="o">=</span>00000000
7530ns 000001a8 : 012d0058 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">0000000b</span><span class="o">=</span>11         <span class="nv">SW</span><span class="o">=</span>00000000
7610ns 000001ac : 1e220002 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">0000002c</span><span class="o">=</span>44         <span class="nv">SW</span><span class="o">=</span>00000000
7690ns 000001b0 : 022d0034 m<span class="o">[</span>28484+52  <span class="o">]=</span>44          <span class="nv">SW</span><span class="o">=</span>00000000
7770ns 000001b4 : 012d005c R<span class="o">[</span>02<span class="o">]=</span><span class="nv">0000000c</span><span class="o">=</span>12         <span class="nv">SW</span><span class="o">=</span>00000000
7850ns 000001b8 : 013d0058 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">0000000b</span><span class="o">=</span>11         <span class="nv">SW</span><span class="o">=</span>00000000
7930ns 000001bc : 16320000 <span class="nv">HI</span><span class="o">=</span>0000000b <span class="nv">LO</span><span class="o">=</span>00000000 <span class="nv">SW</span><span class="o">=</span>00000000
8010ns 000001c0 : 40200000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">0000000b</span><span class="o">=</span>11         <span class="nv">SW</span><span class="o">=</span>00000000
8090ns 000001c4 : 022d002c m<span class="o">[</span>28484+44  <span class="o">]=</span>11          <span class="nv">SW</span><span class="o">=</span>00000000
8170ns 000001c8 : 09202aaa R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00002aaa</span><span class="o">=</span>10922      <span class="nv">SW</span><span class="o">=</span>00000000
8250ns 000001cc : 1e220010 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">2aaa0000</span><span class="o">=</span>715784192  <span class="nv">SW</span><span class="o">=</span>00000000
8330ns 000001d0 : 0d32aaab R<span class="o">[</span>03<span class="o">]=</span><span class="nv">2aaaaaab</span><span class="o">=</span>715827883  <span class="nv">SW</span><span class="o">=</span>00000000
8410ns 000001d4 : 012d0058 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">0000000b</span><span class="o">=</span>11         <span class="nv">SW</span><span class="o">=</span>00000000
8490ns 000001d8 : 09220001 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">0000000c</span><span class="o">=</span>12         <span class="nv">SW</span><span class="o">=</span>00000000
8570ns 000001dc : 50230000 <span class="nv">HI</span><span class="o">=</span>00000002 <span class="nv">LO</span><span class="o">=</span>00000004 <span class="nv">SW</span><span class="o">=</span>00000000
8650ns 000001e0 : 40300000 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000002</span><span class="o">=</span>2          <span class="nv">SW</span><span class="o">=</span>00000000
8730ns 000001e4 : 1f43001f R<span class="o">[</span>04<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
8810ns 000001e8 : 1b330001 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000001</span><span class="o">=</span>1          <span class="nv">SW</span><span class="o">=</span>00000000
8890ns 000001ec : 11334000 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000001</span><span class="o">=</span>1          <span class="nv">SW</span><span class="o">=</span>00000000
8970ns 000001f0 : 0940000c R<span class="o">[</span>04<span class="o">]=</span><span class="nv">0000000c</span><span class="o">=</span>12         <span class="nv">SW</span><span class="o">=</span>00000000
9050ns 000001f4 : 15334000 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">0000000c</span><span class="o">=</span>12         <span class="nv">SW</span><span class="o">=</span>00000000
9130ns 000001f8 : 14223000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
9210ns 000001fc : 022d0028 m<span class="o">[</span>28484+40  <span class="o">]=</span>0           <span class="nv">SW</span><span class="o">=</span>00000000
9290ns 00000200 : 012d0058 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">0000000b</span><span class="o">=</span>11         <span class="nv">SW</span><span class="o">=</span>00000000
9370ns 00000204 : 1a227000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">0000000b</span><span class="o">=</span>11         <span class="nv">SW</span><span class="o">=</span>00000000
9450ns 00000208 : 09300001 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000001</span><span class="o">=</span>1          <span class="nv">SW</span><span class="o">=</span>00000000
9530ns 0000020c : 1a223000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">0000000a</span><span class="o">=</span>10         <span class="nv">SW</span><span class="o">=</span>00000000
9610ns 00000210 : 18223000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
9690ns 00000214 : 022d0024 m<span class="o">[</span>28484+36  <span class="o">]=</span>0           <span class="nv">SW</span><span class="o">=</span>00000000
9770ns 00000218 : 022d0000 m<span class="o">[</span>28484+0   <span class="o">]=</span>0           <span class="nv">SW</span><span class="o">=</span>00000000
9850ns 0000021c : 2b000070 R<span class="o">[</span>00<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
9930ns 00000290 : 09ddfff8 R<span class="o">[</span>13<span class="o">]=</span><span class="nv">00006f3c</span><span class="o">=</span>28476      <span class="nv">SW</span><span class="o">=</span>00000000
10010ns 00000294 : 012d0008 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
10090ns 00000298 : 022d0004 m<span class="o">[</span>28476+4   <span class="o">]=</span>0           <span class="nv">SW</span><span class="o">=</span>00000000
10170ns 0000029c : 09207000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00007000</span><span class="o">=</span>28672      <span class="nv">SW</span><span class="o">=</span>00000000
10250ns 000002a0 : 022d0000 m<span class="o">[</span>28476+0   <span class="o">]=</span>28672       <span class="nv">SW</span><span class="o">=</span>00000000
10330ns 000002a4 : 013d0004 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
10410ns 000002a8 : 02320000 <span class="nv">OUTPUT</span><span class="o">=</span>0
10490ns 000002ac : 09dd0008 R<span class="o">[</span>13<span class="o">]=</span><span class="nv">00006f44</span><span class="o">=</span>28484      <span class="nv">SW</span><span class="o">=</span>00000000
10570ns 000002b0 : 2ce00000 R<span class="o">[</span>14<span class="o">]=</span><span class="nv">00000220</span><span class="o">=</span>544        <span class="nv">SW</span><span class="o">=</span>00000000
10650ns 00000220 : 092d0054 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00006f98</span><span class="o">=</span>28568      <span class="nv">SW</span><span class="o">=</span>00000000
10730ns 00000224 : 022d0014 m<span class="o">[</span>28484+20  <span class="o">]=</span>28568       <span class="nv">SW</span><span class="o">=</span>00000000
10810ns 00000228 : 012d0054 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000002</span><span class="o">=</span>2          <span class="nv">SW</span><span class="o">=</span>00000000
10890ns 0000022c : 022d0020 m<span class="o">[</span>28484+32  <span class="o">]=</span>2           <span class="nv">SW</span><span class="o">=</span>00000000
10970ns 00000230 : 013d004c R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000009</span><span class="o">=</span>9          <span class="nv">SW</span><span class="o">=</span>00000000
11050ns 00000234 : 014d0050 R<span class="o">[</span>04<span class="o">]=</span><span class="nv">0000000d</span><span class="o">=</span>13         <span class="nv">SW</span><span class="o">=</span>00000000
11130ns 00000238 : 11343000 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000016</span><span class="o">=</span>22         <span class="nv">SW</span><span class="o">=</span>00000000
11210ns 0000023c : 014d0048 R<span class="o">[</span>04<span class="o">]=</span><span class="nv">00000016</span><span class="o">=</span>22         <span class="nv">SW</span><span class="o">=</span>00000000
11290ns 00000240 : 11334000 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">0000002c</span><span class="o">=</span>44         <span class="nv">SW</span><span class="o">=</span>00000000
11370ns 00000244 : 014d0044 R<span class="o">[</span>04<span class="o">]=</span><span class="nv">00000005</span><span class="o">=</span>5          <span class="nv">SW</span><span class="o">=</span>00000000
11450ns 00000248 : 11334000 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000031</span><span class="o">=</span>49         <span class="nv">SW</span><span class="o">=</span>00000000
11530ns 0000024c : 014d0040 R<span class="o">[</span>04<span class="o">]=</span><span class="nv">00000002</span><span class="o">=</span>2          <span class="nv">SW</span><span class="o">=</span>00000000
11610ns 00000250 : 11334000 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000033</span><span class="o">=</span>51         <span class="nv">SW</span><span class="o">=</span>00000000
11690ns 00000254 : 014d003c R<span class="o">[</span>04<span class="o">]=</span><span class="nv">0000000b</span><span class="o">=</span>11         <span class="nv">SW</span><span class="o">=</span>00000000
11770ns 00000258 : 11334000 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">0000003e</span><span class="o">=</span>62         <span class="nv">SW</span><span class="o">=</span>00000000
11850ns 0000025c : 014d0038 R<span class="o">[</span>04<span class="o">]=</span><span class="nv">00000009</span><span class="o">=</span>9          <span class="nv">SW</span><span class="o">=</span>00000000
11930ns 00000260 : 11334000 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000047</span><span class="o">=</span>71         <span class="nv">SW</span><span class="o">=</span>00000000
12010ns 00000264 : 014d0034 R<span class="o">[</span>04<span class="o">]=</span><span class="nv">0000002c</span><span class="o">=</span>44         <span class="nv">SW</span><span class="o">=</span>00000000
12090ns 00000268 : 11334000 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000073</span><span class="o">=</span>115        <span class="nv">SW</span><span class="o">=</span>00000000
12170ns 0000026c : 014d002c R<span class="o">[</span>04<span class="o">]=</span><span class="nv">0000000b</span><span class="o">=</span>11         <span class="nv">SW</span><span class="o">=</span>00000000
12250ns 00000270 : 11334000 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">0000007e</span><span class="o">=</span>126        <span class="nv">SW</span><span class="o">=</span>00000000
12330ns 00000274 : 014d0028 R<span class="o">[</span>04<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
12410ns 00000278 : 11334000 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">0000007e</span><span class="o">=</span>126        <span class="nv">SW</span><span class="o">=</span>00000000
12490ns 0000027c : 11232000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000080</span><span class="o">=</span>128        <span class="nv">SW</span><span class="o">=</span>00000000
12570ns 00000280 : 017d0060 R<span class="o">[</span>07<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
12650ns 00000284 : 01ed0064 R<span class="o">[</span>14<span class="o">]=</span><span class="nv">0000005c</span><span class="o">=</span>92         <span class="nv">SW</span><span class="o">=</span>00000000
12730ns 00000288 : 09dd0068 R<span class="o">[</span>13<span class="o">]=</span><span class="nv">00006fac</span><span class="o">=</span>28588      <span class="nv">SW</span><span class="o">=</span>00000000
12810ns 0000028c : 2ce00000 R<span class="o">[</span>14<span class="o">]=</span><span class="nv">0000005c</span><span class="o">=</span>92         <span class="nv">SW</span><span class="o">=</span>00000000
12890ns 0000005c : 022d0040 m<span class="o">[</span>28588+64  <span class="o">]=</span>128         <span class="nv">SW</span><span class="o">=</span>00000000
12970ns 00000060 : 022d0000 m<span class="o">[</span>28588+0   <span class="o">]=</span>128         <span class="nv">SW</span><span class="o">=</span>00000000
13050ns 00000064 : 2b000228 R<span class="o">[</span>00<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
13130ns 00000290 : 09ddfff8 R<span class="o">[</span>13<span class="o">]=</span><span class="nv">00006fa4</span><span class="o">=</span>28580      <span class="nv">SW</span><span class="o">=</span>00000000
13210ns 00000294 : 012d0008 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000080</span><span class="o">=</span>128        <span class="nv">SW</span><span class="o">=</span>00000000
13290ns 00000298 : 022d0004 m<span class="o">[</span>28580+4   <span class="o">]=</span>128         <span class="nv">SW</span><span class="o">=</span>00000000
13370ns 0000029c : 09207000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00007000</span><span class="o">=</span>28672      <span class="nv">SW</span><span class="o">=</span>00000000
13450ns 000002a0 : 022d0000 m<span class="o">[</span>28580+0   <span class="o">]=</span>28672       <span class="nv">SW</span><span class="o">=</span>00000000
13530ns 000002a4 : 013d0004 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000080</span><span class="o">=</span>128        <span class="nv">SW</span><span class="o">=</span>00000000
13610ns 000002a8 : 02320000 <span class="nv">OUTPUT</span><span class="o">=</span>128
13690ns 000002ac : 09dd0008 R<span class="o">[</span>13<span class="o">]=</span><span class="nv">00006fac</span><span class="o">=</span>28588      <span class="nv">SW</span><span class="o">=</span>00000000
13770ns 000002b0 : 2ce00000 R<span class="o">[</span>14<span class="o">]=</span><span class="nv">00000068</span><span class="o">=</span>104        <span class="nv">SW</span><span class="o">=</span>00000000
13850ns 00000068 : 2b000248 R<span class="o">[</span>00<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
13930ns 000002b4 : 09ddffe8 R<span class="o">[</span>13<span class="o">]=</span><span class="nv">00006f94</span><span class="o">=</span>28564      <span class="nv">SW</span><span class="o">=</span>00000000
14010ns 000002b8 : 09300001 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000001</span><span class="o">=</span>1          <span class="nv">SW</span><span class="o">=</span>00000000
14090ns 000002bc : 023d0014 m<span class="o">[</span>28564+20  <span class="o">]=</span>1           <span class="nv">SW</span><span class="o">=</span>00000000
14170ns 000002c0 : 09200002 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000002</span><span class="o">=</span>2          <span class="nv">SW</span><span class="o">=</span>00000000
14250ns 000002c4 : 022d0010 m<span class="o">[</span>28564+16  <span class="o">]=</span>2           <span class="nv">SW</span><span class="o">=</span>00000000
14330ns 000002c8 : 09200003 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000003</span><span class="o">=</span>3          <span class="nv">SW</span><span class="o">=</span>00000000
14410ns 000002cc : 022d000c m<span class="o">[</span>28564+12  <span class="o">]=</span>3           <span class="nv">SW</span><span class="o">=</span>00000000
14490ns 000002d0 : 09200004 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000004</span><span class="o">=</span>4          <span class="nv">SW</span><span class="o">=</span>00000000
14570ns 000002d4 : 022d0008 m<span class="o">[</span>28564+8   <span class="o">]=</span>4           <span class="nv">SW</span><span class="o">=</span>00000000
14650ns 000002d8 : 09200005 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000005</span><span class="o">=</span>5          <span class="nv">SW</span><span class="o">=</span>00000000
14730ns 000002dc : 022d0004 m<span class="o">[</span>28564+4   <span class="o">]=</span>5           <span class="nv">SW</span><span class="o">=</span>00000000
14810ns 000002e0 : 09200000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
14890ns 000002e4 : 014d0014 R<span class="o">[</span>04<span class="o">]=</span><span class="nv">00000001</span><span class="o">=</span>1          <span class="nv">SW</span><span class="o">=</span>00000000
14970ns 000002e8 : 10420000 R<span class="o">[</span>04<span class="o">]=</span><span class="nv">00000001</span><span class="o">=</span>1          <span class="nv">SW</span><span class="o">=</span>00000000
15050ns 000002ec : 2000000c R<span class="o">[</span>00<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
15130ns 000002f0 : 014d0014 R<span class="o">[</span>04<span class="o">]=</span><span class="nv">00000001</span><span class="o">=</span>1          <span class="nv">SW</span><span class="o">=</span>00000000
15210ns 000002f4 : 09440001 R<span class="o">[</span>04<span class="o">]=</span><span class="nv">00000002</span><span class="o">=</span>2          <span class="nv">SW</span><span class="o">=</span>00000000
15290ns 000002f8 : 024d0014 m<span class="o">[</span>28564+20  <span class="o">]=</span>2           <span class="nv">SW</span><span class="o">=</span>00000000
15370ns 000002fc : 014d0010 R<span class="o">[</span>04<span class="o">]=</span><span class="nv">00000002</span><span class="o">=</span>2          <span class="nv">SW</span><span class="o">=</span>00000000
15450ns 00000300 : 10430000 R<span class="o">[</span>04<span class="o">]=</span><span class="nv">00000002</span><span class="o">=</span>2          <span class="nv">SW</span><span class="o">=</span>00000000
15530ns 00000304 : 2200000c R<span class="o">[</span>00<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
15610ns 00000308 : 013d0010 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000002</span><span class="o">=</span>2          <span class="nv">SW</span><span class="o">=</span>00000000
15690ns 0000030c : 09330001 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000003</span><span class="o">=</span>3          <span class="nv">SW</span><span class="o">=</span>00000000
15770ns 00000310 : 023d0010 m<span class="o">[</span>28564+16  <span class="o">]=</span>3           <span class="nv">SW</span><span class="o">=</span>00000000
15850ns 00000314 : 013d000c R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000003</span><span class="o">=</span>3          <span class="nv">SW</span><span class="o">=</span>00000000
15930ns 00000318 : 10320000 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000003</span><span class="o">=</span>3          <span class="nv">SW</span><span class="o">=</span>00000000
16010ns 0000031c : 2200000c R<span class="o">[</span>00<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
16090ns 00000320 : 013d000c R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000003</span><span class="o">=</span>3          <span class="nv">SW</span><span class="o">=</span>00000000
16170ns 00000324 : 09330001 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000004</span><span class="o">=</span>4          <span class="nv">SW</span><span class="o">=</span>00000000
16250ns 00000328 : 023d000c m<span class="o">[</span>28564+12  <span class="o">]=</span>4           <span class="nv">SW</span><span class="o">=</span>00000000
16330ns 0000032c : 0930ffff R<span class="o">[</span>03<span class="o">]=</span><span class="nv">ffffffff</span><span class="o">=</span>-1         <span class="nv">SW</span><span class="o">=</span>00000000
16410ns 00000330 : 014d0008 R<span class="o">[</span>04<span class="o">]=</span><span class="nv">00000004</span><span class="o">=</span>4          <span class="nv">SW</span><span class="o">=</span>00000000
16490ns 00000334 : 10430000 R<span class="o">[</span>04<span class="o">]=</span><span class="nv">00000004</span><span class="o">=</span>4          <span class="nv">SW</span><span class="o">=</span>00000000
16570ns 00000338 : 2300000c R<span class="o">[</span>00<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
16650ns 00000348 : 013d0004 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000005</span><span class="o">=</span>5          <span class="nv">SW</span><span class="o">=</span>00000000
16730ns 0000034c : 10320000 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000005</span><span class="o">=</span>5          <span class="nv">SW</span><span class="o">=</span>00000000
16810ns 00000350 : 2300000c R<span class="o">[</span>00<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
16890ns 00000360 : 012d0010 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000003</span><span class="o">=</span>3          <span class="nv">SW</span><span class="o">=</span>00000000
16970ns 00000364 : 013d0014 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000002</span><span class="o">=</span>2          <span class="nv">SW</span><span class="o">=</span>00000000
17050ns 00000368 : 11232000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000005</span><span class="o">=</span>5          <span class="nv">SW</span><span class="o">=</span>00000000
17130ns 0000036c : 013d000c R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000004</span><span class="o">=</span>4          <span class="nv">SW</span><span class="o">=</span>00000000
17210ns 00000370 : 11223000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000009</span><span class="o">=</span>9          <span class="nv">SW</span><span class="o">=</span>00000000
17290ns 00000374 : 013d0008 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000004</span><span class="o">=</span>4          <span class="nv">SW</span><span class="o">=</span>00000000
17370ns 00000378 : 11223000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">0000000d</span><span class="o">=</span>13         <span class="nv">SW</span><span class="o">=</span>00000000
17450ns 0000037c : 013d0004 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000005</span><span class="o">=</span>5          <span class="nv">SW</span><span class="o">=</span>00000000
17530ns 00000380 : 11223000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000012</span><span class="o">=</span>18         <span class="nv">SW</span><span class="o">=</span>00000000
17610ns 00000384 : 09dd0018 R<span class="o">[</span>13<span class="o">]=</span><span class="nv">00006fac</span><span class="o">=</span>28588      <span class="nv">SW</span><span class="o">=</span>00000000
17690ns 00000388 : 2ce00000 R<span class="o">[</span>14<span class="o">]=</span><span class="nv">0000006c</span><span class="o">=</span>108        <span class="nv">SW</span><span class="o">=</span>00000000
17770ns 0000006c : 013d0040 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000080</span><span class="o">=</span>128        <span class="nv">SW</span><span class="o">=</span>00000000
17850ns 00000070 : 11232000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000092</span><span class="o">=</span>146        <span class="nv">SW</span><span class="o">=</span>00000000
17930ns 00000074 : 022d0040 m<span class="o">[</span>28588+64  <span class="o">]=</span>146         <span class="nv">SW</span><span class="o">=</span>00000000
18010ns 00000078 : 022d0000 m<span class="o">[</span>28588+0   <span class="o">]=</span>146         <span class="nv">SW</span><span class="o">=</span>00000000
18090ns 0000007c : 2b000210 R<span class="o">[</span>00<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
18170ns 00000290 : 09ddfff8 R<span class="o">[</span>13<span class="o">]=</span><span class="nv">00006fa4</span><span class="o">=</span>28580      <span class="nv">SW</span><span class="o">=</span>00000000
18250ns 00000294 : 012d0008 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000092</span><span class="o">=</span>146        <span class="nv">SW</span><span class="o">=</span>00000000
18330ns 00000298 : 022d0004 m<span class="o">[</span>28580+4   <span class="o">]=</span>146         <span class="nv">SW</span><span class="o">=</span>00000000
18410ns 0000029c : 09207000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00007000</span><span class="o">=</span>28672      <span class="nv">SW</span><span class="o">=</span>00000000
18490ns 000002a0 : 022d0000 m<span class="o">[</span>28580+0   <span class="o">]=</span>28672       <span class="nv">SW</span><span class="o">=</span>00000000
18570ns 000002a4 : 013d0004 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000092</span><span class="o">=</span>146        <span class="nv">SW</span><span class="o">=</span>00000000
18650ns 000002a8 : 02320000 <span class="nv">OUTPUT</span><span class="o">=</span>146
18730ns 000002ac : 09dd0008 R<span class="o">[</span>13<span class="o">]=</span><span class="nv">00006fac</span><span class="o">=</span>28588      <span class="nv">SW</span><span class="o">=</span>00000000
18810ns 000002b0 : 2ce00000 R<span class="o">[</span>14<span class="o">]=</span><span class="nv">00000080</span><span class="o">=</span>128        <span class="nv">SW</span><span class="o">=</span>00000000
18890ns 00000080 : 09200005 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000005</span><span class="o">=</span>5          <span class="nv">SW</span><span class="o">=</span>00000000
18970ns 00000084 : 022d0018 m<span class="o">[</span>28588+24  <span class="o">]=</span>5           <span class="nv">SW</span><span class="o">=</span>00000000
19050ns 00000088 : 09200004 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000004</span><span class="o">=</span>4          <span class="nv">SW</span><span class="o">=</span>00000000
19130ns 0000008c : 022d0014 m<span class="o">[</span>28588+20  <span class="o">]=</span>4           <span class="nv">SW</span><span class="o">=</span>00000000
19210ns 00000090 : 09200003 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000003</span><span class="o">=</span>3          <span class="nv">SW</span><span class="o">=</span>00000000
19290ns 00000094 : 022d0010 m<span class="o">[</span>28588+16  <span class="o">]=</span>3           <span class="nv">SW</span><span class="o">=</span>00000000
19370ns 00000098 : 09200002 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000002</span><span class="o">=</span>2          <span class="nv">SW</span><span class="o">=</span>00000000
19450ns 0000009c : 022d000c m<span class="o">[</span>28588+12  <span class="o">]=</span>2           <span class="nv">SW</span><span class="o">=</span>00000000
19530ns 000000a0 : 09200001 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000001</span><span class="o">=</span>1          <span class="nv">SW</span><span class="o">=</span>00000000
19610ns 000000a4 : 022d0008 m<span class="o">[</span>28588+8   <span class="o">]=</span>1           <span class="nv">SW</span><span class="o">=</span>00000000
19690ns 000000a8 : 027d0004 m<span class="o">[</span>28588+4   <span class="o">]=</span>0           <span class="nv">SW</span><span class="o">=</span>00000000
19770ns 000000ac : 09200006 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000006</span><span class="o">=</span>6          <span class="nv">SW</span><span class="o">=</span>00000000
19850ns 000000b0 : 022d0000 m<span class="o">[</span>28588+0   <span class="o">]=</span>6           <span class="nv">SW</span><span class="o">=</span>00000000
19930ns 000000b4 : 2b0002d4 R<span class="o">[</span>00<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
20010ns 0000038c : 09ddffe8 R<span class="o">[</span>13<span class="o">]=</span><span class="nv">00006f94</span><span class="o">=</span>28564      <span class="nv">SW</span><span class="o">=</span>00000000
20090ns 00000390 : 012d0018 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000006</span><span class="o">=</span>6          <span class="nv">SW</span><span class="o">=</span>00000000
20170ns 00000394 : 022d0014 m<span class="o">[</span>28564+20  <span class="o">]=</span>6           <span class="nv">SW</span><span class="o">=</span>00000000
20250ns 00000398 : 09200000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
20330ns 0000039c : 022d0010 m<span class="o">[</span>28564+16  <span class="o">]=</span>0           <span class="nv">SW</span><span class="o">=</span>00000000
20410ns 000003a0 : 022d000c m<span class="o">[</span>28564+12  <span class="o">]=</span>0           <span class="nv">SW</span><span class="o">=</span>00000000
20490ns 000003a4 : 022d0008 m<span class="o">[</span>28564+8   <span class="o">]=</span>0           <span class="nv">SW</span><span class="o">=</span>00000000
20570ns 000003a8 : 093d001c R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00006fb0</span><span class="o">=</span>28592      <span class="nv">SW</span><span class="o">=</span>00000000
20650ns 000003ac : 023d0004 m<span class="o">[</span>28564+4   <span class="o">]=</span>28592       <span class="nv">SW</span><span class="o">=</span>00000000
20730ns 000003b0 : 022d0010 m<span class="o">[</span>28564+16  <span class="o">]=</span>0           <span class="nv">SW</span><span class="o">=</span>00000000
20810ns 000003b4 : 012d0014 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000006</span><span class="o">=</span>6          <span class="nv">SW</span><span class="o">=</span>00000000
20890ns 000003b8 : 013d0010 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>00000000
20970ns 000003bc : 10320000 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>80000000
21050ns 000003c0 : 25000030 R<span class="o">[</span>00<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>80000000
21130ns 000003c4 : 012d0004 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00006fb0</span><span class="o">=</span>28592      <span class="nv">SW</span><span class="o">=</span>80000000
21210ns 000003c8 : 09320004 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00006fb4</span><span class="o">=</span>28596      <span class="nv">SW</span><span class="o">=</span>80000000
21290ns 000003cc : 023d0004 m<span class="o">[</span>28564+4   <span class="o">]=</span>28596       <span class="nv">SW</span><span class="o">=</span>80000000
21370ns 000003d0 : 01220000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>80000000
21450ns 000003d4 : 022d000c m<span class="o">[</span>28564+12  <span class="o">]=</span>0           <span class="nv">SW</span><span class="o">=</span>80000000
21530ns 000003d8 : 013d0008 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>80000000
21610ns 000003dc : 11232000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>80000000
21690ns 000003e0 : 022d0008 m<span class="o">[</span>28564+8   <span class="o">]=</span>0           <span class="nv">SW</span><span class="o">=</span>80000000
21770ns 000003e4 : 012d0010 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>80000000
21850ns 000003e8 : 09220001 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000001</span><span class="o">=</span>1          <span class="nv">SW</span><span class="o">=</span>80000000
21930ns 000003ec : 022d0010 m<span class="o">[</span>28564+16  <span class="o">]=</span>1           <span class="nv">SW</span><span class="o">=</span>80000000
22010ns 000003f0 : 26ffffc0 R<span class="o">[</span>15<span class="o">]=</span><span class="nv">000003b4</span><span class="o">=</span>948        <span class="nv">SW</span><span class="o">=</span>80000000
22090ns 000003b4 : 012d0014 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000006</span><span class="o">=</span>6          <span class="nv">SW</span><span class="o">=</span>80000000
22170ns 000003b8 : 013d0010 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000001</span><span class="o">=</span>1          <span class="nv">SW</span><span class="o">=</span>80000000
22250ns 000003bc : 10320000 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000001</span><span class="o">=</span>1          <span class="nv">SW</span><span class="o">=</span>80000000
22330ns 000003c0 : 25000030 R<span class="o">[</span>00<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>80000000
22410ns 000003c4 : 012d0004 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00006fb4</span><span class="o">=</span>28596      <span class="nv">SW</span><span class="o">=</span>80000000
22490ns 000003c8 : 09320004 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00006fb8</span><span class="o">=</span>28600      <span class="nv">SW</span><span class="o">=</span>80000000
22570ns 000003cc : 023d0004 m<span class="o">[</span>28564+4   <span class="o">]=</span>28600       <span class="nv">SW</span><span class="o">=</span>80000000
22650ns 000003d0 : 01220000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000001</span><span class="o">=</span>1          <span class="nv">SW</span><span class="o">=</span>80000000
22730ns 000003d4 : 022d000c m<span class="o">[</span>28564+12  <span class="o">]=</span>1           <span class="nv">SW</span><span class="o">=</span>80000000
22810ns 000003d8 : 013d0008 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>80000000
22890ns 000003dc : 11232000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000001</span><span class="o">=</span>1          <span class="nv">SW</span><span class="o">=</span>80000000
22970ns 000003e0 : 022d0008 m<span class="o">[</span>28564+8   <span class="o">]=</span>1           <span class="nv">SW</span><span class="o">=</span>80000000
23050ns 000003e4 : 012d0010 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000001</span><span class="o">=</span>1          <span class="nv">SW</span><span class="o">=</span>80000000
23130ns 000003e8 : 09220001 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000002</span><span class="o">=</span>2          <span class="nv">SW</span><span class="o">=</span>80000000
23210ns 000003ec : 022d0010 m<span class="o">[</span>28564+16  <span class="o">]=</span>2           <span class="nv">SW</span><span class="o">=</span>80000000
23290ns 000003f0 : 26ffffc0 R<span class="o">[</span>15<span class="o">]=</span><span class="nv">000003b4</span><span class="o">=</span>948        <span class="nv">SW</span><span class="o">=</span>80000000
23370ns 000003b4 : 012d0014 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000006</span><span class="o">=</span>6          <span class="nv">SW</span><span class="o">=</span>80000000
23450ns 000003b8 : 013d0010 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000002</span><span class="o">=</span>2          <span class="nv">SW</span><span class="o">=</span>80000000
23530ns 000003bc : 10320000 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000002</span><span class="o">=</span>2          <span class="nv">SW</span><span class="o">=</span>80000000
23610ns 000003c0 : 25000030 R<span class="o">[</span>00<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>80000000
23690ns 000003c4 : 012d0004 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00006fb8</span><span class="o">=</span>28600      <span class="nv">SW</span><span class="o">=</span>80000000
23770ns 000003c8 : 09320004 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00006fbc</span><span class="o">=</span>28604      <span class="nv">SW</span><span class="o">=</span>80000000
23850ns 000003cc : 023d0004 m<span class="o">[</span>28564+4   <span class="o">]=</span>28604       <span class="nv">SW</span><span class="o">=</span>80000000
23930ns 000003d0 : 01220000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000002</span><span class="o">=</span>2          <span class="nv">SW</span><span class="o">=</span>80000000
24010ns 000003d4 : 022d000c m<span class="o">[</span>28564+12  <span class="o">]=</span>2           <span class="nv">SW</span><span class="o">=</span>80000000
24090ns 000003d8 : 013d0008 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000001</span><span class="o">=</span>1          <span class="nv">SW</span><span class="o">=</span>80000000
24170ns 000003dc : 11232000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000003</span><span class="o">=</span>3          <span class="nv">SW</span><span class="o">=</span>80000000
24250ns 000003e0 : 022d0008 m<span class="o">[</span>28564+8   <span class="o">]=</span>3           <span class="nv">SW</span><span class="o">=</span>80000000
24330ns 000003e4 : 012d0010 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000002</span><span class="o">=</span>2          <span class="nv">SW</span><span class="o">=</span>80000000
24410ns 000003e8 : 09220001 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000003</span><span class="o">=</span>3          <span class="nv">SW</span><span class="o">=</span>80000000
24490ns 000003ec : 022d0010 m<span class="o">[</span>28564+16  <span class="o">]=</span>3           <span class="nv">SW</span><span class="o">=</span>80000000
24570ns 000003f0 : 26ffffc0 R<span class="o">[</span>15<span class="o">]=</span><span class="nv">000003b4</span><span class="o">=</span>948        <span class="nv">SW</span><span class="o">=</span>80000000
24650ns 000003b4 : 012d0014 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000006</span><span class="o">=</span>6          <span class="nv">SW</span><span class="o">=</span>80000000
24730ns 000003b8 : 013d0010 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000003</span><span class="o">=</span>3          <span class="nv">SW</span><span class="o">=</span>80000000
24810ns 000003bc : 10320000 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000003</span><span class="o">=</span>3          <span class="nv">SW</span><span class="o">=</span>80000000
24890ns 000003c0 : 25000030 R<span class="o">[</span>00<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>80000000
24970ns 000003c4 : 012d0004 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00006fbc</span><span class="o">=</span>28604      <span class="nv">SW</span><span class="o">=</span>80000000
25050ns 000003c8 : 09320004 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00006fc0</span><span class="o">=</span>28608      <span class="nv">SW</span><span class="o">=</span>80000000
25130ns 000003cc : 023d0004 m<span class="o">[</span>28564+4   <span class="o">]=</span>28608       <span class="nv">SW</span><span class="o">=</span>80000000
25210ns 000003d0 : 01220000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000003</span><span class="o">=</span>3          <span class="nv">SW</span><span class="o">=</span>80000000
25290ns 000003d4 : 022d000c m<span class="o">[</span>28564+12  <span class="o">]=</span>3           <span class="nv">SW</span><span class="o">=</span>80000000
25370ns 000003d8 : 013d0008 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000003</span><span class="o">=</span>3          <span class="nv">SW</span><span class="o">=</span>80000000
25450ns 000003dc : 11232000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000006</span><span class="o">=</span>6          <span class="nv">SW</span><span class="o">=</span>80000000
25530ns 000003e0 : 022d0008 m<span class="o">[</span>28564+8   <span class="o">]=</span>6           <span class="nv">SW</span><span class="o">=</span>80000000
25610ns 000003e4 : 012d0010 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000003</span><span class="o">=</span>3          <span class="nv">SW</span><span class="o">=</span>80000000
25690ns 000003e8 : 09220001 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000004</span><span class="o">=</span>4          <span class="nv">SW</span><span class="o">=</span>80000000
25770ns 000003ec : 022d0010 m<span class="o">[</span>28564+16  <span class="o">]=</span>4           <span class="nv">SW</span><span class="o">=</span>80000000
25850ns 000003f0 : 26ffffc0 R<span class="o">[</span>15<span class="o">]=</span><span class="nv">000003b4</span><span class="o">=</span>948        <span class="nv">SW</span><span class="o">=</span>80000000
25930ns 000003b4 : 012d0014 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000006</span><span class="o">=</span>6          <span class="nv">SW</span><span class="o">=</span>80000000
26010ns 000003b8 : 013d0010 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000004</span><span class="o">=</span>4          <span class="nv">SW</span><span class="o">=</span>80000000
26090ns 000003bc : 10320000 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000004</span><span class="o">=</span>4          <span class="nv">SW</span><span class="o">=</span>80000000
26170ns 000003c0 : 25000030 R<span class="o">[</span>00<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>80000000
26250ns 000003c4 : 012d0004 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00006fc0</span><span class="o">=</span>28608      <span class="nv">SW</span><span class="o">=</span>80000000
26330ns 000003c8 : 09320004 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00006fc4</span><span class="o">=</span>28612      <span class="nv">SW</span><span class="o">=</span>80000000
26410ns 000003cc : 023d0004 m<span class="o">[</span>28564+4   <span class="o">]=</span>28612       <span class="nv">SW</span><span class="o">=</span>80000000
26490ns 000003d0 : 01220000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000004</span><span class="o">=</span>4          <span class="nv">SW</span><span class="o">=</span>80000000
26570ns 000003d4 : 022d000c m<span class="o">[</span>28564+12  <span class="o">]=</span>4           <span class="nv">SW</span><span class="o">=</span>80000000
26650ns 000003d8 : 013d0008 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000006</span><span class="o">=</span>6          <span class="nv">SW</span><span class="o">=</span>80000000
26730ns 000003dc : 11232000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">0000000a</span><span class="o">=</span>10         <span class="nv">SW</span><span class="o">=</span>80000000
26810ns 000003e0 : 022d0008 m<span class="o">[</span>28564+8   <span class="o">]=</span>10          <span class="nv">SW</span><span class="o">=</span>80000000
26890ns 000003e4 : 012d0010 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000004</span><span class="o">=</span>4          <span class="nv">SW</span><span class="o">=</span>80000000
26970ns 000003e8 : 09220001 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000005</span><span class="o">=</span>5          <span class="nv">SW</span><span class="o">=</span>80000000
27050ns 000003ec : 022d0010 m<span class="o">[</span>28564+16  <span class="o">]=</span>5           <span class="nv">SW</span><span class="o">=</span>80000000
27130ns 000003f0 : 26ffffc0 R<span class="o">[</span>15<span class="o">]=</span><span class="nv">000003b4</span><span class="o">=</span>948        <span class="nv">SW</span><span class="o">=</span>80000000
27210ns 000003b4 : 012d0014 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000006</span><span class="o">=</span>6          <span class="nv">SW</span><span class="o">=</span>80000000
27290ns 000003b8 : 013d0010 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000005</span><span class="o">=</span>5          <span class="nv">SW</span><span class="o">=</span>80000000
27370ns 000003bc : 10320000 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000005</span><span class="o">=</span>5          <span class="nv">SW</span><span class="o">=</span>80000000
27450ns 000003c0 : 25000030 R<span class="o">[</span>00<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>80000000
27530ns 000003c4 : 012d0004 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00006fc4</span><span class="o">=</span>28612      <span class="nv">SW</span><span class="o">=</span>80000000
27610ns 000003c8 : 09320004 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00006fc8</span><span class="o">=</span>28616      <span class="nv">SW</span><span class="o">=</span>80000000
27690ns 000003cc : 023d0004 m<span class="o">[</span>28564+4   <span class="o">]=</span>28616       <span class="nv">SW</span><span class="o">=</span>80000000
27770ns 000003d0 : 01220000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000005</span><span class="o">=</span>5          <span class="nv">SW</span><span class="o">=</span>80000000
27850ns 000003d4 : 022d000c m<span class="o">[</span>28564+12  <span class="o">]=</span>5           <span class="nv">SW</span><span class="o">=</span>80000000
27930ns 000003d8 : 013d0008 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">0000000a</span><span class="o">=</span>10         <span class="nv">SW</span><span class="o">=</span>80000000
28010ns 000003dc : 11232000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">0000000f</span><span class="o">=</span>15         <span class="nv">SW</span><span class="o">=</span>80000000
28090ns 000003e0 : 022d0008 m<span class="o">[</span>28564+8   <span class="o">]=</span>15          <span class="nv">SW</span><span class="o">=</span>80000000
28170ns 000003e4 : 012d0010 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000005</span><span class="o">=</span>5          <span class="nv">SW</span><span class="o">=</span>80000000
28250ns 000003e8 : 09220001 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000006</span><span class="o">=</span>6          <span class="nv">SW</span><span class="o">=</span>80000000
28330ns 000003ec : 022d0010 m<span class="o">[</span>28564+16  <span class="o">]=</span>6           <span class="nv">SW</span><span class="o">=</span>80000000
28410ns 000003f0 : 26ffffc0 R<span class="o">[</span>15<span class="o">]=</span><span class="nv">000003b4</span><span class="o">=</span>948        <span class="nv">SW</span><span class="o">=</span>80000000
28490ns 000003b4 : 012d0014 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00000006</span><span class="o">=</span>6          <span class="nv">SW</span><span class="o">=</span>80000000
28570ns 000003b8 : 013d0010 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000006</span><span class="o">=</span>6          <span class="nv">SW</span><span class="o">=</span>80000000
28650ns 000003bc : 10320000 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">00000006</span><span class="o">=</span>6          <span class="nv">SW</span><span class="o">=</span>40000000
28730ns 000003c0 : 25000030 R<span class="o">[</span>00<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>40000000
28810ns 000003f4 : 012d0008 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">0000000f</span><span class="o">=</span>15         <span class="nv">SW</span><span class="o">=</span>40000000
28890ns 000003f8 : 09dd0018 R<span class="o">[</span>13<span class="o">]=</span><span class="nv">00006fac</span><span class="o">=</span>28588      <span class="nv">SW</span><span class="o">=</span>40000000
28970ns 000003fc : 2ce00000 R<span class="o">[</span>14<span class="o">]=</span><span class="nv">000000b8</span><span class="o">=</span>184        <span class="nv">SW</span><span class="o">=</span>40000000
29050ns 000000b8 : 022d0040 m<span class="o">[</span>28588+64  <span class="o">]=</span>15          <span class="nv">SW</span><span class="o">=</span>40000000
29130ns 000000bc : 022d0000 m<span class="o">[</span>28588+0   <span class="o">]=</span>15          <span class="nv">SW</span><span class="o">=</span>40000000
29210ns 000000c0 : 2b0001cc R<span class="o">[</span>00<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>40000000
29290ns 00000290 : 09ddfff8 R<span class="o">[</span>13<span class="o">]=</span><span class="nv">00006fa4</span><span class="o">=</span>28580      <span class="nv">SW</span><span class="o">=</span>40000000
29370ns 00000294 : 012d0008 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">0000000f</span><span class="o">=</span>15         <span class="nv">SW</span><span class="o">=</span>40000000
29450ns 00000298 : 022d0004 m<span class="o">[</span>28580+4   <span class="o">]=</span>15          <span class="nv">SW</span><span class="o">=</span>40000000
29530ns 0000029c : 09207000 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">00007000</span><span class="o">=</span>28672      <span class="nv">SW</span><span class="o">=</span>40000000
29610ns 000002a0 : 022d0000 m<span class="o">[</span>28580+0   <span class="o">]=</span>28672       <span class="nv">SW</span><span class="o">=</span>40000000
29690ns 000002a4 : 013d0004 R<span class="o">[</span>03<span class="o">]=</span><span class="nv">0000000f</span><span class="o">=</span>15         <span class="nv">SW</span><span class="o">=</span>40000000
29770ns 000002a8 : 02320000 <span class="nv">OUTPUT</span><span class="o">=</span>15
29850ns 000002ac : 09dd0008 R<span class="o">[</span>13<span class="o">]=</span><span class="nv">00006fac</span><span class="o">=</span>28588      <span class="nv">SW</span><span class="o">=</span>40000000
29930ns 000002b0 : 2ce00000 R<span class="o">[</span>14<span class="o">]=</span><span class="nv">000000c4</span><span class="o">=</span>196        <span class="nv">SW</span><span class="o">=</span>40000000
30010ns 000000c4 : 012d0040 R<span class="o">[</span>02<span class="o">]=</span><span class="nv">0000000f</span><span class="o">=</span>15         <span class="nv">SW</span><span class="o">=</span>40000000
30090ns 000000c8 : 017d0048 R<span class="o">[</span>07<span class="o">]=</span><span class="nv">00000000</span><span class="o">=</span>0          <span class="nv">SW</span><span class="o">=</span>40000000
30170ns 000000cc : 01ed004c R<span class="o">[</span>14<span class="o">]=</span><span class="nv">ffffffff</span><span class="o">=</span>-1         <span class="nv">SW</span><span class="o">=</span>40000000
30250ns 000000d0 : 09dd0050 R<span class="o">[</span>13<span class="o">]=</span><span class="nv">00006ffc</span><span class="o">=</span>28668      <span class="nv">SW</span><span class="o">=</span>40000000
30330ns 000000d4 : 2ce00000 R<span class="o">[</span>14<span class="o">]=</span><span class="nv">ffffffff</span><span class="o">=</span>-1         <span class="nv">SW</span><span class="o">=</span>40000000
RET to PC &lt; 0, finished!
</pre></div>
</div>
<p>As above result, cpu0s.v dump the memory first after read input cpu0s.hex.
Next, it run instructions from address 0 and print each destination
register value in the fourth column.
The first column is the nano seconds of timing. The second
is instruction address. The third is instruction content.
We have checked the <strong>&#8220;&gt;&gt;&#8221;</strong> is correct on both signed and unsigned int type
, and tracking the variable <strong>a</strong> value by print_integer(). You can verify it
with the <strong>OUTPUT=xxx</strong> in Verilog output.</p>
<p>We show Verilog PC output by display the I/O memory mapped address but
didn&#8217;t implementing the output hardware interface or port. The output hardware
interface/port is hardware output device dependent, such as RS232, speaker,
LED, .... You should implement the I/O interface/port when you want to program
FPGA and wire I/O device to the I/O port.</p>
<table class="docutils footnote" frame="void" id="id3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="http://www.ece.umd.edu/courses/enee359a/">http://www.ece.umd.edu/courses/enee359a/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><a class="reference external" href="http://www.ece.umd.edu/courses/enee359a/verilog_tutorial.pdf">http://www.ece.umd.edu/courses/enee359a/verilog_tutorial.pdf</a></td></tr>
</tbody>
</table>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="elf.html">ELF Support</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="optimize.html">Backend Optimization</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2012, LLVM.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>